<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>pytest - ğŸğŸ’ suda-morris ä¸ªäººåšå®¢ ğŸ‡</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Personal Blog">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../about-me.html">å…³äºæˆ‘</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">ä½“ç³»ç»“æ„</li><li class="chapter-item expanded "><a href="../cs/riscv.html"><strong aria-hidden="true">1.</strong> RISC-V</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">ç¼–è¯‘ç³»ç»Ÿ</li><li class="chapter-item expanded "><a href="../cs/gcc-toolchains.html"><strong aria-hidden="true">2.</strong> GCC</a></li><li class="chapter-item expanded "><a href="../cs/cmake.html"><strong aria-hidden="true">3.</strong> CMake</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">æ“ä½œç³»ç»Ÿ</li><li class="chapter-item expanded "><a href="../cs/openwrt.html"><strong aria-hidden="true">4.</strong> OpenWRT</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">ç¼–ç¨‹è¯­è¨€</li><li class="chapter-item expanded "><a href="../cs/rust.html"><strong aria-hidden="true">5.</strong> Rust</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">æ§åˆ¶ç³»ç»Ÿ</li><li class="chapter-item expanded "><a href="../ee/control-system.html"><strong aria-hidden="true">6.</strong> æ§åˆ¶ç³»ç»ŸåŸºç¡€</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">æµ‹è¯•æ¡†æ¶</li><li class="chapter-item expanded "><a href="../cs/pytest.html" class="active"><strong aria-hidden="true">7.</strong> pytest</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">å¤šåª’ä½“</li><li class="chapter-item expanded "><a href="../cs/video-process.html"><strong aria-hidden="true">8.</strong> è§†é¢‘å¤„ç†</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">é€šä¿¡åè®®</li><li class="chapter-item expanded "><a href="../ee/usb.html"><strong aria-hidden="true">9.</strong> USB åè®®åŸºç¡€</a></li><li class="chapter-item expanded "><a href="../ee/can.html"><strong aria-hidden="true">10.</strong> CAN åè®®åŸºç¡€</a></li><li class="chapter-item expanded "><a href="../ee/mipi-dsi.html"><strong aria-hidden="true">11.</strong> MIPI DSI åè®®åŸºç¡€</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">ç”µè·¯è®¾è®¡</li><li class="chapter-item expanded "><a href="../ee/yosys.html"><strong aria-hidden="true">12.</strong> Yosys</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">å‰ç«¯</li><li class="chapter-item expanded "><a href="../cs/tauri.html"><strong aria-hidden="true">13.</strong> Tauri</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">ç®¡ç†</li><li class="chapter-item expanded "><a href="../cs/git.html"><strong aria-hidden="true">14.</strong> git</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">æ¼”ç¤º</li><li class="chapter-item expanded "><a href="../ux/slides-tool.html"><strong aria-hidden="true">15.</strong> slides å·¥å…·</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ğŸğŸ’ suda-morris ä¸ªäººåšå®¢ ğŸ‡</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/suda-morris/blog" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/suda-morris/blog/edit/master/src/cs/pytest.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="pytest-åŸºç¡€"><a class="header" href="#pytest-åŸºç¡€">pytest åŸºç¡€</a></h1>
<h2 id="å¸¸ç”¨å‘½ä»¤è¡Œé€‰é¡¹"><a class="header" href="#å¸¸ç”¨å‘½ä»¤è¡Œé€‰é¡¹">å¸¸ç”¨å‘½ä»¤è¡Œé€‰é¡¹</a></h2>
<ul>
<li>
<p><code>--collect-only</code>ï¼šå±•ç¤ºåœ¨ç»™å®šçš„é…ç½®ä¸‹å“ªäº›æµ‹è¯•ç”¨ä¾‹ä¼šè¢«è¿è¡Œ</p>
</li>
<li>
<p><code>-k</code>ï¼šä½¿ç”¨è¡¨è¾¾å¼æŒ‡å®šè¦è¿è¡Œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¡¨è¾¾å¼å¯ä»¥åŒ¹é…æµ‹è¯•åï¼Œä¸”è¡¨è¾¾å¼ä¸­å¯ä»¥åŒ…å« <code>and</code>,<code>or</code>,<code>not</code> å…³é”®å­—</p>
<pre><code class="language-text">â¤ pytest -v --collect-only -k "replace or asdict"

&lt;Package tests&gt;
  &lt;Module test_named_tuple.py&gt;
    &lt;Function test_asdict&gt;
      _asdict() should return a dictionary.
    &lt;Function test_replace&gt;
      replace() should change passed in fields.
</code></pre>
</li>
<li>
<p><code>-m</code>ï¼šæ ‡è®°æµ‹è¯•å¹¶åˆ†ç»„ï¼Œä»¥ä¾¿å¿«é€Ÿé€‰ä¸­å¹¶è¿è¡Œï¼Œå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæ ‡è®°ï¼Œæ ‡è®°ä¹‹é—´å¯ä»¥ä½¿ç”¨ <code>and</code>,<code>or</code>,<code>not</code> å…³é”®å­—</p>
</li>
<li>
<p><code>-s</code>ï¼šå…è®¸ç»ˆç«¯åœ¨æµ‹è¯•è¿è¡Œæ—¶è¾“å‡ºæŸäº›ç»“æœï¼ŒåŒ…æ‹¬ä»»ä½•ç¬¦åˆæ ‡å‡†çš„è¾“å‡ºæµä¿¡æ¯ï¼Œç­‰ä»·äº <code>--capture=no</code></p>
</li>
<li>
<p><code>--markers</code>ï¼šåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ marker</p>
</li>
<li>
<p><code>--fixtures</code>ï¼šåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ fixture</p>
</li>
<li>
<p><code>--setup-show</code>ï¼šæ˜¾ç¤ºæµ‹è¯•ç”¨ä¾‹çš„ setup å’Œ teardown è¿‡ç¨‹</p>
</li>
<li>
<p><code>--durations=0</code>ï¼šå°†æ‰€æœ‰é˜¶æ®µçš„è€—æ—¶ä»é•¿åˆ°çŸ­æ’åº</p>
</li>
<li>
<p><code>-l</code>ï¼šæ˜¾ç¤ºå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹çš„å±€éƒ¨å˜é‡</p>
</li>
<li>
<p><code>-x</code>ï¼šé‡åˆ°å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹æ—¶åœæ­¢è¿è¡Œ</p>
</li>
<li>
<p><code>--lf, --last-failed</code>ï¼šåªè¿è¡Œä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåˆ™è¿è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹</p>
</li>
<li>
<p><code>--ff, --failed-first</code>ï¼šå…ˆè¿è¡Œä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åå†è¿è¡Œå…¶ä»–æµ‹è¯•ç”¨ä¾‹</p>
</li>
<li>
<p><code>--cache-show</code>ï¼šæ˜¾ç¤ºç¼“å­˜çš„å†…å®¹ï¼ˆå¯ç”¨äºå¤šä¸ªæµ‹è¯•ä¼šè¯ä¹‹é—´å…±äº«ï¼‰</p>
</li>
<li>
<p><code>--cache-clear</code>ï¼šæ¸…é™¤ç¼“å­˜</p>
</li>
<li>
<p><code>--pdb</code>ï¼šé‡åˆ°å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹æ—¶è¿›å…¥è°ƒè¯•æ¨¡å¼</p>
</li>
<li>
<p><code>--tb=[auto/long/short/line/native/no]</code>ï¼šæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶å †æ ˆå›æº¯ä¿¡æ¯çš„ç²’åº¦</p>
</li>
<li>
<p><code>--junit-xml</code>ï¼šå°†æµ‹è¯•ç»“æœè¾“å‡ºä¸º junit æ ¼å¼çš„ xml æ–‡ä»¶</p>
</li>
</ul>
<h2 id="æµ‹è¯•æœç´¢"><a class="header" href="#æµ‹è¯•æœç´¢">æµ‹è¯•æœç´¢</a></h2>
<p>pytest èƒ½è‡ªåŠ¨æœç´¢æ‰€æœ‰å¾…æ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œä½ éœ€è¦éµå®ˆä»¥ä¸‹å‡ æ¡å‘½åè§„åˆ™ï¼š</p>
<ul>
<li>æµ‹è¯•æ–‡ä»¶åº”è¯¥å‘½åä¸º <code>test_*.py</code> æˆ–è€… <code>*_test.py</code></li>
<li>æµ‹è¯•å‡½æ•°ã€æµ‹è¯•ç±»æ–¹æ³•åº”å½“å‘½åä¸º <code>test_&lt;something&gt;</code></li>
<li>æµ‹è¯•ç±»è¦å‘½åä¸º <code>Test&lt;Something&gt;</code></li>
<li>é»˜è®¤çš„æµ‹è¯•æœç´¢è§„åˆ™å¯ä»¥åœ¨ <code>pytest.ini</code> ä¸­è¿›è¡Œä¿®æ”¹</li>
</ul>
<h2 id="ç¼–å†™æµ‹è¯•å‡½æ•°"><a class="header" href="#ç¼–å†™æµ‹è¯•å‡½æ•°">ç¼–å†™æµ‹è¯•å‡½æ•°</a></h2>
<ul>
<li>
<p>pytest ä¼šæˆªæ–­å¯¹åŸç”Ÿ <code>assert</code> çš„è°ƒç”¨ï¼Œæ›¿æ¢ä¸º pytest å®šä¹‰çš„ <code>assert</code></p>
</li>
<li>
<p>ä½¿ç”¨ <code>with pytest.raises(Exception):</code> æ¥æ–­è¨€å¼‚å¸¸</p>
<pre><code class="language-python">def test_start_tasks_db_raises():
  """Make sure unsupported db raises an exception."""
  with pytest.raises(ValueError) as exc_info:
      tasks.start_tasks_db("some/great/path", "mysql")
  exception_msg = exc_info.value.args[0]
  assert exc_info.type == ValueError
  assert exception_msg == "db_type must be a 'tiny' or 'mongo'"
</code></pre>
</li>
<li>
<p>ä½¿ç”¨ <code>pytest.approx</code> æ¥æ–­è¨€æµ®ç‚¹æ•°</p>
<pre><code class="language-python">def test_approx():
  """Using pytest.approx."""
  v1 = 0.1 + 0.2
  v2 = 0.3
  assert v1 != v2
  assert v1 == pytest.approx(v2)
</code></pre>
</li>
<li>
<p>ä½¿ç”¨ <code>@pytest.mark.skip</code> å’Œ <code>@pytest.mark.skipif</code> è£…æ—¶æœŸæ¥è·³è¿‡ä¸å¸Œæœ›è¿è¡Œçš„æµ‹è¯•</p>
</li>
<li>
<p>ä½¿ç”¨ <code>@pytest.mark.xfail</code> è£…é¥°å™¨æ¥æ ‡è®°é¢„æœŸå¤±è´¥çš„æµ‹è¯•</p>
<pre><code class="language-python">@pytest.mark.xfail(
    sys.platform == "win32",
    reason="can't run on Windows"
)
def test_unique_id_is_a_duck():
    """Demonstrate xfail"""
    uid = tasks.unique_id()
    assert uid == "a duck"
</code></pre>
</li>
<li>
<p>ä½¿ç”¨ <code>@pytest.mark.parametrize(argnames, argvalues)</code> è£…é¥°å™¨æ¥è¿è¡Œç›¸åŒæµ‹è¯•ç”¨ä¾‹çš„ä¸åŒå‚æ•°ç»„åˆ, <code>parametrize()</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<strong>ç”¨é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨</strong>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯<strong>å€¼åˆ—è¡¨</strong></p>
<pre><code class="language-python">@pytest.mark.parametrize(
    "summary, owner, done",
    [
        ("sleep", None, False),
        ("wake", "brian", False),
        ("breath", "iris", True),
        ("eat", "bob", True),
    ],
)
def test_add_variety(summary, owner, done):
    """Demonstrate parameterize with 3 parameters."""
    new_task = Task(summary, owner, done)
    task_id = tasks.add(new_task)
    task_from_db = tasks.get(task_id)
    assert equivalent(new_task, task_from_db)
</code></pre>
</li>
<li>
<p><code>parametrize()</code> è¿˜å¯ä»¥é€šè¿‡ <code>ids</code> å‚æ•°æ¥æŒ‡å®šæ¯ä¸ªå‚æ•°ç»„åˆçš„åå­—, <code>ids</code> å‚æ•°çš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œé•¿åº¦å¿…é¡»å’Œ <code>argvalues</code> å‚æ•°çš„é•¿åº¦ä¸€è‡´</p>
<pre><code class="language-python">tasks_to_try = (
  Task("sleep", None, True),
  Task("wake", "brian", False),
  Task("breathe", "bob", True),
  Task("exercise", "iris", False),
)
task_ids = [f"Task({t.summary},{t.owner},{t.done})" for t in tasks_to_try]


@pytest.mark.parametrize("task", tasks_to_try, ids=task_ids)
def test_add_variety(task):
    """Demonstrate parameterize with 3 parameters."""
    task_id = tasks.add(task)
    task_from_db = tasks.get(task_id)
    assert equivalent(task, task_from_db)
</code></pre>
</li>
<li>
<p>å½“ <code>ids</code> ä¸èƒ½è¢«å‚æ•°åŒ–æ‰¹é‡ç”Ÿæˆæ—¶ï¼Œéœ€è¦è‡ªå®šä¹‰çš„æ—¶å€™ï¼Œå¯ä»¥ç»™æ¯ä¸ªå‚æ•°å€¼å®šä¹‰ä¸€ä¸ª <code>id</code> æ¥åšæ ‡è¯†: <code>pytest.param(&lt;value&gt;, id="something")</code></p>
<pre><code class="language-python">@pytest.mark.parametrize(
    "task",
    [
        pytest.param(Task("sleep")),
        pytest.param(Task("wake", "brian"), id="summary/owner"),
        pytest.param(Task("breathe", "BRIAN", True), id="summary/owner/done"),
    ],
)
def test_add_variety(task):
    """Demonstrate parameterize with 3 parameters."""
    task_id = tasks.add(task)
    task_from_db = tasks.get(task_id)
    assert equivalent(task, task_from_db)
</code></pre>
<p>è¿è¡Œç»“æœ:</p>
<pre><code class="language-bash">test_add.py::test_add_variety[task0] PASSED # å› ä¸ºæ²¡æœ‰æ·»åŠ idæ ‡è¯†ï¼Œæ‰€ä»¥å¯è¯»æ€§ä¸å¥½
test_add.py::test_add_variety[summary/owner] PASSED
test_add.py::test_add_variety[summary/owner/done] PASSED
</code></pre>
</li>
</ul>
<h2 id="fixture"><a class="header" href="#fixture">Fixture</a></h2>
<ul>
<li>
<p>Fixture æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œåœ¨æµ‹è¯•å‡½æ•°è¿è¡Œå‰åï¼Œç”± pytest æ‰§è¡Œçš„å¤–å£³å‡½æ•°ï¼Œé€šå¸¸ç”¨æ¥åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼Œåˆ›å»ºä¸´æ—¶æ–‡ä»¶ç­‰ã€‚</p>
<pre><code class="language-python">@pytest.fixture()
def some_data():
    return 42


def test_some_data(some_data):
    assert some_data == 42
</code></pre>
</li>
<li>
<p>å¤šä¸ª fixture ä¹‹é—´å¯ä»¥ç›¸äº’ä¾èµ–ï¼Œæ¯”å¦‚ä¸€ä¸ª fixture ä¾èµ–å¦ä¸€ä¸ª fixtureï¼Œè¿™æ—¶å¯ä»¥åœ¨ fixture å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­æ·»åŠ ä¾èµ–çš„ fixture å‡½æ•°</p>
<pre><code class="language-python">@pytest.fixture()
def db_with_3_tasks(tasks_db, tasks_just_a_few):
    """Connected db with 3 tasks, all unique"""
    for t in tasks_just_a_few:
        tasks.add(t)

def test_add_increases_count(db_with_3_tasks):
  tasks.add(Task("throw a party"))
  assert tasks.count() == 4
</code></pre>
</li>
<li>
<p>ä½¿ç”¨ <code>usefixtures</code> ä¸ºæµ‹è¯•ç±»æŒ‡å®š fixtureï¼Œè¿™ç§æ–¹æ³•<strong>ä¸èƒ½</strong>å¤Ÿä½¿ç”¨ fixture å‡½æ•°çš„è¿”å›å€¼</p>
<pre><code class="language-python">@pytest.mark.usefixtures("tasks_db")
class TestAdd:
    """Using a fixture for setup and teardown."""

    def test_add_increases_count(self):
        """tasks.add() affect tasks.count()."""
        tasks.add(Task("throw a party"))
        assert tasks.count() == 1
</code></pre>
</li>
<li>
<p>é€šè¿‡ <code>scope</code> å‚æ•°æŒ‡å®š fixture çš„ä½œç”¨èŒƒå›´ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºæ§åˆ¶ fixture æ‰§è¡Œ setup å’Œ teardown çš„é¢‘ç‡ï¼‰ï¼Œ<code>scope</code> å‚æ•°çš„å€¼å¯ä»¥æ˜¯ <code>function</code>ã€<code>class</code>ã€<code>module</code>ã€<code>session</code>ï¼Œé»˜è®¤å€¼æ˜¯ <code>function</code>ã€‚fixture åªèƒ½ä½¿ç”¨åŒçº§åˆ«çš„ fixture æˆ–è€…æ¯”è‡ªå·±çº§åˆ«æ›´é«˜çš„ fixtureã€‚</p>
<pre><code class="language-python">@pytest.fixture(scope="session")
def tasks_db(tmpdir_factory):
    """Connect to db before testing, disconnect after."""
    tmp_dir = tmpdir_factory.mktemp("temp")
    tasks.start_tasks_db(str(tmp_dir), "tiny")
    yield
    tasks.stop_tasks_db()
</code></pre>
</li>
<li>
<p>å¯ä»¥ä¸ºå¸¸ç”¨ fixture æ·»åŠ  <code>autouse=True</code> é€‰é¡¹ï¼Œä½¿å¾—ä½œç”¨åŸŸå†…çš„æµ‹è¯•å‡½æ•°è‡ªåŠ¨è¿è¡Œè¯¥ fixture</p>
</li>
<li>
<p>å¯ä»¥è®¾ç½® <code>name</code> å‚æ•°æ¥é‡å‘½å fixture</p>
</li>
<li>
<p>å¯¹æµ‹è¯•å‡½æ•°è¿›è¡Œå‚æ•°åŒ–ï¼Œå¯ä»¥å¤šæ¬¡è¿è¡Œçš„åªæ˜¯è¯¥æµ‹è¯•å‡½æ•°ã€‚è€Œä½¿ç”¨<strong>å‚æ•°åŒ–</strong> fixture,æ¯ä¸ªä½¿ç”¨è¯¥ fixture çš„æµ‹è¯•å‡½æ•°éƒ½å¯ä»¥è¢«è¿è¡Œå¤šæ¬¡</p>
<pre><code class="language-python">tasks_to_try = [
    pytest.param(Task("sleep")),
    pytest.param(Task("wake", "brian")),
    pytest.param(Task("breathe", "BRIAN", True)),
]


def id_func(task: Task):
    """Create a string representation for test report."""
    return f"({task.summary},{task.owner},{task.done})"


@pytest.fixture(params=tasks_to_try, ids=id_func)
def a_task(request):
    """Using a fixture to pass data to a test."""
    return request.param


def test_add_variety(a_task):
    """Demonstrate parameterize with 3 parameters."""
    task_id = tasks.add(a_task)
    task_from_db = tasks.get(task_id)
    assert equivalent(a_task, task_from_db)
</code></pre>
<p><code>ids</code> å‚æ•°å¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ªå‡½æ•°ï¼Œä¾› pytest é’ˆå¯¹æ¯ä¸ªå‚æ•°ç”Ÿæˆæ ‡è¯†</p>
</li>
</ul>
<h3 id="å†…ç½®-fixture"><a class="header" href="#å†…ç½®-fixture">å†…ç½® Fixture</a></h3>
<h4 id="tmpdir-å’Œ-tmpdir_factory"><a class="header" href="#tmpdir-å’Œ-tmpdir_factory">tmpdir å’Œ tmpdir_factory</a></h4>
<pre><code class="language-python">def test_tmpdir(tmpdir):
    print(tmpdir.realpath)
    # tmpdir already has a path name associated with it
    # join() extends the path to include a filename
    # the file is created when it's written to
    # tmpdir is a py.path.local object
    a_file = tmpdir.join("something.txt")

    # you can create directories
    a_sub_dir = tmpdir.mkdir("anything")

    # you can create files in the directory (created when written)
    another_file = a_sub_dir.join("something_else.txt")

    # this write creates "something.txt"
    a_file.write("contents may settle during shipping")

    # this write creates "anything/something_else.txt"
    another_file.write("something different")

    assert a_file.read() == "contents may settle during shipping"
    assert another_file.read() == "something different"
</code></pre>
<pre><code class="language-python">def test_tmpdir_factor(tmpdir_factory):
    print(tmpdir_factory.getbasetemp())

    # you should start with making a directory
    # a_dir acts like the object returned from the tmpdir fixture
    a_dir = tmpdir_factory.mktemp("mydir")
    a_file = a_dir.join("something.txt")

    # you can create directories
    a_sub_dir = a_dir.mkdir("anything")

    # you can create files in the directory (created when written)
    another_file = a_sub_dir.join("something_else.txt")

    # this write creates "something.txt"
    a_file.write("contents may settle during shipping")

    # this write creates "anything/something_else.txt"
    another_file.write("something different")

    assert a_file.read() == "contents may settle during shipping"
    assert another_file.read() == "something different"
</code></pre>
<p><code>tmpdir_factory</code> çš„ä½œç”¨èŒƒå›´æ˜¯ä¼šè¯çº§åˆ«ï¼Œ<code>tmpdir</code> çš„ä½œç”¨èŒƒå›´æ˜¯å‡½æ•°çº§åˆ«ã€‚å¦‚æœéœ€è¦æ¨¡å—æˆ–è€…ç±»çº§åˆ«ä½œç”¨èŒƒå›´çš„ç›®å½•ï¼Œå¯ä»¥åˆ©ç”¨ <code>tmpdir_factory</code> å†åˆ›å»ºä¸€ä¸ª fixtureã€‚</p>
<pre><code class="language-python">@pytest.fixture(scope="module")
def my_tmpdir(tmpdir_factory):
    pass
</code></pre>
<h4 id="pytestconfig"><a class="header" href="#pytestconfig">pytestconfig</a></h4>
<p><code>pytestconfig</code> æ˜¯ <code>request.config</code> çš„å¿«æ·æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡ <code>pytestconfig.getoption()</code> è·å–å‘½ä»¤è¡Œé€‰é¡¹ã€‚</p>
<pre><code class="language-python">def test_option(pytestconfig):
    print(f"args: {pytestconfig.args}")
    print(f"invocation_dir: {pytestconfig.invocation_dir}")
    print(f"rootdir: {pytestconfig.rootdir}")
    print(f"inifile: {pytestconfig.inifile}")
    print(f"basetemp: {pytestconfig.getoption('basetemp')}")
    print(f"-k EXPRESSION: {pytestconfig.getoption('keyword')}")
    print(f"-v, --verbose: {pytestconfig.getoption('verbose')}")
    print(f"--tb style: {pytestconfig.getoption('tbstyle')}")
</code></pre>
<p>ä¹Ÿå¯ä»¥åŸºäº <code>pytestconfig</code> åˆ›å»ºæ–°çš„ fixture</p>
<pre><code class="language-python">@pytest.fixture()
def foo(pytestconfig):
    return pytestconfig.option.foo


def test_option(foo):
    print("foo: {}".format(foo))
</code></pre>
<h4 id="cache"><a class="header" href="#cache">cache</a></h4>
<p>cache çš„ä½œç”¨æ˜¯å­˜å‚¨ä¸€æ®µæµ‹è¯•ä¼šè¯çš„ä¿¡æ¯ï¼Œåœ¨ä¸‹ä¸€æ®µæµ‹è¯•ä¼šè¯ä¸­ä½¿ç”¨ã€‚<code>cache</code>çš„æ¥å£ä¸»è¦æœ‰ä¸¤ä¸ªï¼š<code>cache.get(key, default)</code> å’Œ <code>cache.set(key, value)</code>ã€‚</p>
<p>ä¹ æƒ¯ä¸Šï¼Œé”®åä»¥åº”ç”¨åå­—æˆ–æ’ä»¶åå­—å¼€å§‹ï¼Œæ¥ç€æ˜¯<code>/</code>ï¼Œç„¶åæ˜¯åˆ†éš”å¼€çš„é”®å­—ç¬¦ä¸²ã€‚é”®å€¼å¯ä»¥æ˜¯ä»»ä½•å¯ä»¥è½¬æ¢æˆ JSON çš„å¯¹è±¡ã€‚</p>
<pre><code class="language-python">Duration = namedtuple("Duration", ["current", "last"])


@pytest.fixture(scope="session")
def duration_cache(request):
    key = "duration/test_durations"
    d = Duration({}, request.config.cache.get(key, {}))
    yield d
    request.config.cache.set(key, d.current)


@pytest.fixture(autouse=True)
def check_duration(request, duration_cache):
    d = duration_cache
    nodeid = request.node.nodeid  # nodeid is a unique identifier for the test
    start_time = datetime.datetime.now()
    yield
    duration = (datetime.datetime.now() - start_time).total_seconds()
    d.current[nodeid] = duration
    if d.last.get(nodeid, None) is not None:
        errorstring = "test duration over 2x last duration"
        assert duration &lt;= (d.last[nodeid] * 2), errorstring


@pytest.mark.parametrize("i", range(5))
def test_slow_stuff(i):
    time.sleep(random.random())
</code></pre>
<pre><code class="language-text">â¤ pytest --cache-show
================ test session starts ================
platform linux -- Python 3.10.7, pytest-7.1.2, pluggy-1.0.0
rootdir: /home/morris/tasks/tests
cachedir: /home/morris/tasks/tests/.pytest_cache
---------------- cache values for '*' ----------------
duration/test_durations contains:
  {'test_cache.py::test_slow_stuff[0]': 0.133439,
   'test_cache.py::test_slow_stuff[1]': 0.569769,
   'test_cache.py::test_slow_stuff[2]': 0.7625,
   'test_cache.py::test_slow_stuff[3]': 0.930151,
   'test_cache.py::test_slow_stuff[4]': 0.748842}
</code></pre>
<p>åŒæ—¶ä¹Ÿèƒ½çœ‹åˆ°è¢« <code>cache</code> çš„æ•°æ®ä¿å­˜åœ¨ <code>.pytest_cache</code> ç›®å½•ä¸‹ã€‚</p>
<h4 id="capsys"><a class="header" href="#capsys">capsys</a></h4>
<ul>
<li>
<p><code>capsys.readouterr()</code>ï¼šè¿”å›ä¸€ä¸ªåŒ…å« <code>out</code> å’Œ <code>err</code> çš„ <code>namedtuple</code>ï¼Œåˆ†åˆ«æ˜¯æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯çš„å†…å®¹</p>
<pre><code class="language-python">def test_capsys(capsys):
    print("hello")
    print("world", file=sys.stderr)
    out, err = capsys.readouterr()
    assert out == "hello\n"
    assert err == "world\n"
</code></pre>
</li>
<li>
<p>ä¸´æ—¶è®©è¾“å‡ºç»•è¿‡é»˜è®¤çš„è¾“å‡ºæ•è·æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>capsys.disabled()</code> ä¸Šä¸‹æ–‡ç®¡ç†å™¨</p>
<pre><code class="language-python">def test_capsys_disabled(capsys):
    with capsys.disabled():
        print("always print this")
    print("normal print, usually captured")
</code></pre>
</li>
</ul>
<h4 id="monkeypatch"><a class="header" href="#monkeypatch">monkeypatch</a></h4>
<p>monkeypatch å¯ä»¥åœ¨è¿è¡ŒæœŸé—´å¯¹ç±»æˆ–æ¨¡å—è¿›è¡ŒåŒæ€ä¿®æ”¹ï¼Œæ¯”å¦‚ä¿®æ”¹ç¯å¢ƒå˜é‡ã€ä¿®æ”¹ç±»å±æ€§ã€ä¿®æ”¹æ¨¡å—å±æ€§ç­‰ã€‚</p>
<ul>
<li>
<p>setattr(target, name, value, raising=True)ï¼šä¿®æ”¹å¯¹è±¡çš„å±æ€§å€¼</p>
<pre><code class="language-python">def test_setattr(monkeypatch):
    class A:
        a = 1

    monkeypatch.setattr(A, "a", 2)
    assert A.a == 2
</code></pre>
</li>
<li>
<p>delattr(target, name, raising=True)ï¼šåˆ é™¤å¯¹è±¡çš„å±æ€§</p>
<pre><code class="language-python">def test_delattr(monkeypatch):
    class A:
        a = 1

    monkeypatch.delattr(A, "a")
    assert not hasattr(A, "a")
</code></pre>
</li>
<li>
<p>setitem(mapping, name, value)ï¼šä¿®æ”¹å­—å…¸çš„å€¼</p>
<pre><code class="language-python">def test_setitem(monkeypatch):
    d = {"a": 1}
    monkeypatch.setitem(d, "a", 2)
    assert d["a"] == 2
</code></pre>
</li>
<li>
<p>delitem(obj, name, raising=True)ï¼šåˆ é™¤å­—å…¸çš„å€¼</p>
<pre><code class="language-python">def test_delitem(monkeypatch):
    d = {"a": 1}
    monkeypatch.delitem(d, "a")
    assert "a" not in d
</code></pre>
</li>
<li>
<p>setenv(name, value, prepend=False)ï¼šä¿®æ”¹ç¯å¢ƒå˜é‡</p>
<pre><code class="language-python">def test_setenv(monkeypatch):
    monkeypatch.setenv("foo", "bar")
    assert os.environ["foo"] == "bar"
</code></pre>
</li>
<li>
<p>delenv(name, raising=True)ï¼šåˆ é™¤ç¯å¢ƒå˜é‡</p>
<pre><code class="language-python">def test_delenv(monkeypatch):
    monkeypatch.setenv("foo", "bar")
    monkeypatch.delenv("foo")
    assert "foo" not in os.environ
</code></pre>
</li>
<li>
<p>syspath_prepend(path)ï¼šåœ¨ <code>sys.path</code> çš„å¼€å¤´æ·»åŠ è·¯å¾„ï¼Œ<code>sys.path</code> æ˜¯ Python æ¨¡å—çš„æœç´¢è·¯å¾„</p>
<pre><code class="language-python">def test_syspath_prepend(monkeypatch):
    monkeypatch.syspath_prepend("/foo")
    assert sys.path[0] == "/foo"
</code></pre>
</li>
<li>
<p>chdir(path)ï¼šä¿®æ”¹å½“å‰å·¥ä½œç›®å½•</p>
<pre><code class="language-python">def test_chdir(monkeypatch):
    monkeypatch.chdir("/tmp")
    assert os.getcwd() == "/tmp"
</code></pre>
</li>
</ul>
<h4 id="recwarn"><a class="header" href="#recwarn">recwarn</a></h4>
<p>recwarn ç”¨æ¥æ£€æŸ¥å¾…æµ‹ä»£ç äº§ç”Ÿçš„è­¦å‘Šä¿¡æ¯ã€‚</p>
<pre><code class="language-python">def test_recwarn(recwarn):
    warnings.warn("Please stop using this function", DeprecationWarning)
    assert len(recwarn) == 1
    w = recwarn.pop()
    assert w.category == DeprecationWarning
    assert str(w.message) == "Please stop using this function"
</code></pre>
<p>pytest è¿˜å¯ä»¥ä½¿ç”¨ <code>pytest.warns</code> æ¥æ£€æŸ¥è­¦å‘Šä¿¡æ¯ã€‚</p>
<pre><code class="language-python">def lame_function():
    warnings.warn("Please stop using this", DeprecationWarning)


def test_lame_function():
    with pytest.warns(DeprecationWarning) as warning_list:
        lame_function()

    assert len(warning_list) == 1
    w = warning_list.pop()
    assert w.category == DeprecationWarning
    assert str(w.message) == "Please stop using this"
</code></pre>
<h2 id="æ’ä»¶"><a class="header" href="#æ’ä»¶">æ’ä»¶</a></h2>
<h3 id="å¯»æ‰¾æ’ä»¶"><a class="header" href="#å¯»æ‰¾æ’ä»¶">å¯»æ‰¾æ’ä»¶</a></h3>
<ul>
<li><a href="https://docs.pytest.org/en/latest/reference/plugin_list.html#plugin-list">https://docs.pytest.org/en/latest/reference/plugin_list.html#plugin-list</a></li>
</ul>
<h3 id="ç¼–å†™æ’ä»¶"><a class="header" href="#ç¼–å†™æ’ä»¶">ç¼–å†™æ’ä»¶</a></h3>
<ul>
<li>
<p>ä½¿ç”¨ <code>pytest_addoption</code> å¯ä»¥ç»™ pytest æ·»åŠ é¢å¤–çš„å‘½ä»¤è¡Œé€‰é¡¹</p>
<pre><code class="language-python">def pytest_addoption(parser):
    parser.addoption(
        "--myopt",
        action="store_true",
        help="some boolean option",
    )
    parser.addoption(
        "--foo",
        action="store",
        default="bar",
        help="foo: bar or baz",
    )
</code></pre>
<p>æˆ–è€…ä¸é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ï¼Œä½¿ç”¨ <code>pytest.ini</code> æ–‡ä»¶åšè‡ªå®šä¹‰çš„é…ç½®</p>
<pre><code class="language-python">def pytest_addoption(parser):
    parser.addini(
        "myopt",
        type="bool",
        default=False,
        help="some boolean option",
    )
    parser.addini(
        "foo",
        type="string",
        default="bar",
        help="foo: bar or baz",
</code></pre>
</li>
<li>
<p>ä½¿ç”¨ <code>pytest_report_header</code> å¯ä»¥åœ¨æµ‹è¯•æŠ¥å‘Šçš„ header ä¸­æ·»åŠ é¢å¤–çš„ä¿¡æ¯</p>
<pre><code class="language-python">def pytest_report_header(config):
    return "ğŸğŸğŸğŸğŸğŸğŸğŸğŸ"
</code></pre>
</li>
<li>
<p>ä½¿ç”¨ <code>pytest_report_teststatus</code> å¯ä»¥ä¿®æ”¹æµ‹è¯•æŠ¥å‘Šä¸­çš„æµ‹è¯•çŠ¶æ€</p>
<pre><code class="language-python">def pytest_report_teststatus(report):
    if report.when == "call" and report.failed:
        return report.outcome, "ğŸ’¥", "ğŸ’¥"
</code></pre>
</li>
</ul>
<h3 id="æµ‹è¯•æ’ä»¶"><a class="header" href="#æµ‹è¯•æ’ä»¶">æµ‹è¯•æ’ä»¶</a></h3>
<ul>
<li>
<p>å¼€å¯ <code>pytester</code> æ’ä»¶ï¼Œåœ¨ conftest.py ä¸­æ·»åŠ  <code>pytest_plugins = ["pytester"]</code></p>
</li>
<li>
<p>ä½¿ç”¨ <code>pytester</code> æ¥æµ‹è¯•æ’ä»¶</p>
<pre><code class="language-python">@pytest.fixture()
def sample_test(testdir):
    testdir.makepyfile(
        """
        def test_sample():
            assert True
        """
    )
    return testdir


def test_verbose(sample_test):
    result = sample_test.runpytest("-v")
    result.stdout.fnmatch_lines(["*::test_sample PASSED*"])
    result.assert_outcomes(passed=1)
</code></pre>
<p><code>testdir</code> è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶ç›®å½•ç”¨æ¥å­˜æ”¾æµ‹è¯•æ–‡ä»¶</p>
</li>
</ul>
<h3 id="å¸¸ç”¨æ’ä»¶"><a class="header" href="#å¸¸ç”¨æ’ä»¶">å¸¸ç”¨æ’ä»¶</a></h3>
<h4 id="pytest-cov"><a class="header" href="#pytest-cov">pytest-cov</a></h4>
<p>æŠ¥å‘Šæµ‹è¯•è¦†ç›–ç‡</p>
<ul>
<li>å®‰è£…ï¼š<code>pip install pytest-cov</code></li>
<li>ä½¿ç”¨ï¼š<code>pytest --cov=src --cov-report=html tests</code></li>
</ul>
<h4 id="pytest-mock"><a class="header" href="#pytest-mock">pytest-mock</a></h4>
<p>æ›¿æ¢ç³»ç»Ÿçš„æŸä¸ªéƒ¨åˆ†ä»¥éš”ç¦»è¦æµ‹è¯•çš„ä»£ç </p>
<ul>
<li>
<p>å®‰è£…ï¼š<code>pip install pytest-mock</code></p>
</li>
<li>
<p>ä½¿ç”¨</p>
<pre><code class="language-python">def test_mock(mocker):
    mocker.patch("os.path.exists", return_value=True)
    assert os.path.exists("/tmp")
</code></pre>
</li>
</ul>
<h4 id="pytest-xdist"><a class="header" href="#pytest-xdist">pytest-xdist</a></h4>
<p>é€šå¸¸ï¼Œæµ‹è¯•éƒ½æ˜¯ä¾æ¬¡æ‰§è¡Œçš„ï¼Œå› ä¸ºæœ‰äº›èµ„æºä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹è®¿é—®ã€‚å¦‚æœä½ çš„æµ‹è¯•ä¸éœ€è¦è®¿é—®å…±äº«èµ„æºï¼Œå¯ä»¥é€šè¿‡å¹¶è¡Œè¿è¡Œæ¥æé€Ÿ</p>
<ul>
<li>å®‰è£…ï¼š<code>pip install pytest-xdist</code></li>
<li>ä½¿ç”¨ï¼š<code>pytest -n auto</code></li>
</ul>
<h4 id="pytest-benchmark"><a class="header" href="#pytest-benchmark">pytest-benchmark</a></h4>
<p>æµ‹è¯•ä»£ç çš„æ€§èƒ½</p>
<ul>
<li>
<p>å®‰è£…ï¼š<code>pip install pytest-benchmark</code></p>
</li>
<li>
<p>ä½¿ç”¨</p>
<pre><code class="language-python">def test_benchmark(benchmark):
    benchmark.pedantic(lambda: 1 + 1, iterations=100, rounds=100)
</code></pre>
</li>
</ul>
<h4 id="pytest-repeat"><a class="header" href="#pytest-repeat">pytest-repeat</a></h4>
<p>é‡å¤è¿è¡Œæµ‹è¯•</p>
<ul>
<li>å®‰è£…ï¼š<code>pip install pytest-repeat</code></li>
<li>ä½¿ç”¨ï¼š<code>pytest --count=3</code></li>
</ul>
<h4 id="pytest-rerunfailures"><a class="header" href="#pytest-rerunfailures">pytest-rerunfailures</a></h4>
<p>å¤±è´¥çš„æµ‹è¯•é‡è·‘</p>
<ul>
<li>å®‰è£…ï¼š<code>pip install pytest-rerunfailures</code></li>
<li>ä½¿ç”¨ï¼š<code>pytest --reruns=3</code></li>
</ul>
<h4 id="pytest-timeout"><a class="header" href="#pytest-timeout">pytest-timeout</a></h4>
<p>è®¾ç½®æµ‹è¯•çš„è¶…æ—¶æ—¶é—´ï¼ˆæ­£å¸¸æƒ…å†µä¸‹ï¼Œpytest é‡Œçš„æµ‹è¯•æ˜¯æ²¡æœ‰æ—¶é—´é™åˆ¶çš„ï¼‰</p>
<ul>
<li>å®‰è£…ï¼š<code>pip install pytest-timeout</code></li>
<li>ä½¿ç”¨ï¼š<code>pytest --timeout=10</code></li>
<li>æˆ–è€…åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>@pytest.mark.timeout(10)</code> æ¥è®¾ç½®å•ä¸ªæµ‹è¯•çš„è¶…æ—¶æ—¶é—´</li>
</ul>
<h4 id="pytest-instafail"><a class="header" href="#pytest-instafail">pytest-instafail</a></h4>
<p>æµ‹è¯•å¤±è´¥æ—¶ç«‹å³è¾“å‡ºå †æ ˆå›æº¯ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç­‰åˆ°æ‰€æœ‰æµ‹è¯•éƒ½æ‰§è¡Œå®Œæ¯•</p>
<ul>
<li>å®‰è£…ï¼š<code>pip install pytest-instafail</code></li>
<li>ä½¿ç”¨ï¼š<code>pytest --instafail</code></li>
</ul>
<h4 id="pytest-sugar"><a class="header" href="#pytest-sugar">pytest-sugar</a></h4>
<p>æ˜¾ç¤ºå½©è‰²å’Œè¿›åº¦æ¡</p>
<ul>
<li>å®‰è£…ï¼š<code>pip install pytest-sugar</code></li>
<li>ä½¿ç”¨ï¼š<code>pytest --sugar</code></li>
</ul>
<h4 id="pytest-emoji"><a class="header" href="#pytest-emoji">pytest-emoji</a></h4>
<p>æ˜¾ç¤º emoji</p>
<ul>
<li>å®‰è£…ï¼š<code>pip install pytest-emoji</code></li>
<li>ä½¿ç”¨ï¼š<code>pytest --emoji</code></li>
</ul>
<h4 id="pytest-html"><a class="header" href="#pytest-html">pytest-html</a></h4>
<p>ç”Ÿæˆ html æŠ¥å‘Š</p>
<ul>
<li>å®‰è£…ï¼š<code>pip install pytest-html</code></li>
<li>ä½¿ç”¨ï¼š<code>pytest --html=report.html</code></li>
</ul>
<h4 id="pytest-flake8"><a class="header" href="#pytest-flake8">pytest-flake8</a></h4>
<p>æ£€æŸ¥ä»£ç é£æ ¼</p>
<ul>
<li>å®‰è£…ï¼š<code>pip install pytest-flake8</code></li>
<li>ä½¿ç”¨ï¼š<code>pytest --flake8</code></li>
</ul>
<h4 id="pytest-selenium"><a class="header" href="#pytest-selenium">pytest-selenium</a></h4>
<p>å€ŸåŠ©æµè§ˆå™¨å®Œæˆè‡ªåŠ¨åŒ–æµ‹è¯•</p>
<ul>
<li>
<p>å®‰è£…ï¼š<code>pip install pytest-selenium</code></p>
</li>
<li>
<p>ä½¿ç”¨</p>
<pre><code class="language-python">def test_selenium(selenium):
    selenium.get("https://www.baidu.com")
    selenium.find_element_by_id("kw").send_keys("pytest")
    selenium.find_element_by_id("su").click()
    assert "pytest" in selenium.title
</code></pre>
</li>
</ul>
<h2 id="é…ç½®"><a class="header" href="#é…ç½®">é…ç½®</a></h2>
<h3 id="pytestini"><a class="header" href="#pytestini">pytest.ini</a></h3>
<p>å®ƒæ˜¯ pytest çš„ä¸»é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ <code>~/.config/pytest.ini</code> ä¸­åˆ›å»ºå…¨å±€é…ç½®æ–‡ä»¶</p>
<h4 id="ä¿®æ”¹é»˜è®¤å‘½ä»¤è¡Œé€‰é¡¹"><a class="header" href="#ä¿®æ”¹é»˜è®¤å‘½ä»¤è¡Œé€‰é¡¹">ä¿®æ”¹é»˜è®¤å‘½ä»¤è¡Œé€‰é¡¹</a></h4>
<pre><code class="language-ini">[pytest]
addopts = -s --tb=short --strict-markers
</code></pre>
<h4 id="æ³¨å†Œæ ‡è®°"><a class="header" href="#æ³¨å†Œæ ‡è®°">æ³¨å†Œæ ‡è®°</a></h4>
<pre><code class="language-ini">[pytest]
markers =
    smoke: smoke test
    regression: regression test
</code></pre>
<h4 id="å¿½ç•¥é‚£äº›ä¸éœ€è¦é€’å½’æœç´¢çš„ç›®å½•"><a class="header" href="#å¿½ç•¥é‚£äº›ä¸éœ€è¦é€’å½’æœç´¢çš„ç›®å½•">å¿½ç•¥é‚£äº›ä¸éœ€è¦é€’å½’æœç´¢çš„ç›®å½•</a></h4>
<pre><code class="language-ini">[pytest]
norecursedirs = .* venv *.egg dist build
</code></pre>
<h4 id="æŒ‡å®šæµ‹è¯•ç›®å½•"><a class="header" href="#æŒ‡å®šæµ‹è¯•ç›®å½•">æŒ‡å®šæµ‹è¯•ç›®å½•</a></h4>
<pre><code class="language-ini">[pytest]
testpaths = tests
</code></pre>
<h4 id="æ›´æ”¹æµ‹è¯•æœç´¢çš„è§„åˆ™"><a class="header" href="#æ›´æ”¹æµ‹è¯•æœç´¢çš„è§„åˆ™">æ›´æ”¹æµ‹è¯•æœç´¢çš„è§„åˆ™</a></h4>
<pre><code class="language-ini">[pytest]
python_files = test_*.py *_test.py pytest_*.py check_*.py
python_classes = Tests* *Test *Suite
python_functions = test_* check_*
</code></pre>
<h4 id="ç¦ç”¨-xpass"><a class="header" href="#ç¦ç”¨-xpass">ç¦ç”¨ xpass</a></h4>
<p>é‚£äº›è¢«æ ‡è®°ä¸º <code>@pytest.mark.xfail</code> ä½†å®é™…é€šè¿‡çš„æµ‹è¯•ç”¨ä¾‹ä¹Ÿè¢«æŠ¥å‘Šä¸ºå¤±è´¥</p>
<pre><code class="language-ini">[pytest]
xfail_strict = true
</code></pre>
<h3 id="conftestpy"><a class="header" href="#conftestpy">conftest.py</a></h3>
<p>å®ƒæ˜¯æœ¬åœ°æ’ä»¶åº“ï¼Œå…¶ä¸­çš„ hook å‡½æ•°å’Œ fixture å°†ä½œç”¨äºè¯¥æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä»¥åŠæ‰€æœ‰å­ç›®å½•</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../ee/control-system.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../cs/video-process.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../ee/control-system.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../cs/video-process.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>

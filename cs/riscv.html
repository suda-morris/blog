<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>RISC-V - ğŸ suda-morris ä¸ªäººåšå®¢ ğŸ‡</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Personal Blog">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../about-me.html">å…³äºæˆ‘</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">ä½“ç³»ç»“æ„</li><li class="chapter-item expanded "><a href="../cs/riscv.html" class="active"><strong aria-hidden="true">1.</strong> RISC-V</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">ç¼–è¯‘ç³»ç»Ÿ</li><li class="chapter-item expanded "><a href="../cs/gcc-toolchains.html"><strong aria-hidden="true">2.</strong> GCC</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">æ“ä½œç³»ç»Ÿ</li><li class="chapter-item expanded "><a href="../cs/openwrt.html"><strong aria-hidden="true">3.</strong> OpenWRT</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">æ§åˆ¶ç³»ç»Ÿ</li><li class="chapter-item expanded "><a href="../ee/control-system.html"><strong aria-hidden="true">4.</strong> æ§åˆ¶ç³»ç»ŸåŸºç¡€</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">æµ‹è¯•æ¡†æ¶</li><li class="chapter-item expanded "><a href="../cs/pytest.html"><strong aria-hidden="true">5.</strong> pytest</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">å¤šåª’ä½“</li><li class="chapter-item expanded "><a href="../cs/video-process.html"><strong aria-hidden="true">6.</strong> è§†é¢‘å¤„ç†</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">é€šä¿¡åè®®</li><li class="chapter-item expanded "><a href="../ee/usb.html"><strong aria-hidden="true">7.</strong> USB åè®®åŸºç¡€</a></li><li class="chapter-item expanded "><a href="../ee/can.html"><strong aria-hidden="true">8.</strong> CAN åè®®åŸºç¡€</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">ç”µè·¯è®¾è®¡</li><li class="chapter-item expanded "><a href="../ee/yosys.html"><strong aria-hidden="true">9.</strong> Yosys</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">å‰ç«¯</li><li class="chapter-item expanded "><a href="../cs/tauri.html"><strong aria-hidden="true">10.</strong> Tauri</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">ç®¡ç†</li><li class="chapter-item expanded "><a href="../cs/git.html"><strong aria-hidden="true">11.</strong> git</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">æ¼”ç¤º</li><li class="chapter-item expanded "><a href="../ux/slides-tool.html"><strong aria-hidden="true">12.</strong> slides å·¥å…·</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ğŸ suda-morris ä¸ªäººåšå®¢ ğŸ‡</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/suda-morris/blog" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/suda-morris/blog/edit/master/src/cs/riscv.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="risc-v-åŸºç¡€"><a class="header" href="#risc-v-åŸºç¡€">RISC-V åŸºç¡€</a></h1>
<h2 id="æŒ‡ä»¤é›†åˆ’åˆ†"><a class="header" href="#æŒ‡ä»¤é›†åˆ’åˆ†">æŒ‡ä»¤é›†åˆ’åˆ†</a></h2>
<div class="table-wrapper"><table><thead><tr><th>åç§°</th><th>ç±»åˆ«</th><th>è¯´æ˜</th></tr></thead><tbody>
<tr><td>RV32I</td><td>åŸºç¡€æŒ‡ä»¤</td><td>æ•´æ•°æŒ‡ä»¤ï¼ŒåŒ…å«ç®—æœ¯ã€åˆ†æ”¯ã€é€»è¾‘ã€è®¿å­˜æŒ‡ä»¤ï¼Œæœ‰32ä¸ª32ä½å¯„å­˜å™¨ï¼Œèƒ½å¯»å€32ä½åœ°å€ç©ºé—´</td></tr>
<tr><td>RV32E</td><td>åŸºç¡€æŒ‡ä»¤</td><td>ä¸RV32Iä¸€æ ·ï¼Œåªä¸è¿‡åªèƒ½ä½¿ç”¨å‰16ä¸ª32ä½å¯„å­˜å™¨</td></tr>
<tr><td>RV64I</td><td>åŸºç¡€æŒ‡ä»¤</td><td>æ•´æ•°æŒ‡ä»¤ï¼ŒåŒ…å«ç®—æœ¯ã€åˆ†æ”¯ã€é€»è¾‘ã€è®¿å­˜æŒ‡ä»¤ï¼Œæœ‰32ä¸ª64ä½å¯„å­˜å™¨ï¼Œèƒ½å¯»å€64ä½åœ°å€ç©ºé—´</td></tr>
<tr><td>RV128I</td><td>åŸºç¡€æŒ‡ä»¤</td><td>æ•´æ•°æŒ‡ä»¤ï¼ŒåŒ…å«ç®—æœ¯ã€åˆ†æ”¯ã€é€»è¾‘ã€è®¿å­˜æŒ‡ä»¤ï¼Œæœ‰32ä¸ª128ä½å¯„å­˜å™¨ï¼Œèƒ½å¯»å€128ä½åœ°å€ç©ºé—´</td></tr>
<tr><td>M</td><td>æ‰©å±•æŒ‡ä»¤</td><td>åŒ…å«ä¹˜æ³•ã€é™¤æ³•ã€æ±‚æ¨¡å–ä½™æŒ‡ä»¤</td></tr>
<tr><td>F</td><td>æ‰©å±•æŒ‡ä»¤</td><td>å•ç²¾åº¦(32bit)æµ®ç‚¹æŒ‡ä»¤</td></tr>
<tr><td>D</td><td>æ‰©å±•æŒ‡ä»¤</td><td>åŒç²¾åº¦(32bit)æµ®ç‚¹æŒ‡ä»¤,å¿…é¡»è¦åŒæ—¶æ”¯æŒFæ‰©å±•æŒ‡ä»¤</td></tr>
<tr><td>Q</td><td>æ‰©å±•æŒ‡ä»¤</td><td>å››å€ç²¾åº¦æµ®ç‚¹æŒ‡ä»¤</td></tr>
<tr><td>A</td><td>æ‰©å±•æŒ‡ä»¤</td><td>å­˜å‚¨å™¨åŸå­æ“ä½œæŒ‡ä»¤ï¼Œæ¯”å¦‚æ¯”è¾ƒå¹¶äº¤æ¢ï¼Œè¯»-æ”¹-å†™ç­‰æŒ‡ä»¤</td></tr>
<tr><td>C</td><td>æ‰©å±•æŒ‡ä»¤</td><td>å‹ç¼©æŒ‡ä»¤,æŒ‡ä»¤é•¿åº¦ä¸º16ä½ï¼Œä¸»è¦ç”¨äºæ”¹å–„ç¨‹åºå¤§å°</td></tr>
<tr><td>P</td><td>æ‰©å±•æŒ‡ä»¤</td><td>å•æŒ‡ä»¤å¤šæ•°æ®ï¼ˆPacked-SIMD)æŒ‡ä»¤</td></tr>
<tr><td>B</td><td>æ‰©å±•æŒ‡ä»¤</td><td>ä½æ“ä½œæŒ‡ä»¤</td></tr>
<tr><td>H</td><td>æ‰©å±•æŒ‡ä»¤</td><td>æ”¯æŒ Hypervisor ç®¡ç†æŒ‡ä»¤</td></tr>
<tr><td>J</td><td>æ‰©å±•æŒ‡ä»¤</td><td>åŠ¨æ€ç¿»è¯‘è¯­è¨€çš„æŒ‡ä»¤</td></tr>
<tr><td>L</td><td>æ‰©å±•æŒ‡ä»¤</td><td>åè¿›åˆ¶æµ®ç‚¹æŒ‡ä»¤</td></tr>
<tr><td>N</td><td>æ‰©å±•æŒ‡ä»¤</td><td>ç”¨æˆ·ä¸­æ–­æŒ‡ä»¤</td></tr>
<tr><td>G</td><td>é€šç”¨æŒ‡ä»¤</td><td>åŒ…å« Iã€Mã€Aã€Fã€DæŒ‡ä»¤</td></tr>
</tbody></table>
</div>
<h3 id="rv32i-åŸºç¡€æŒ‡ä»¤é›†"><a class="header" href="#rv32i-åŸºç¡€æŒ‡ä»¤é›†">RV32I åŸºç¡€æŒ‡ä»¤é›†</a></h3>
<p><img src="../images/risc-v/rv32i.png" alt="RV32I" /></p>
<h3 id="rv32i-é€šç”¨å¯„å­˜å™¨"><a class="header" href="#rv32i-é€šç”¨å¯„å­˜å™¨">RV32I é€šç”¨å¯„å­˜å™¨</a></h3>
<div class="table-wrapper"><table><thead><tr><th>å¯„å­˜å™¨</th><th>ABI åå­—</th><th>æè¿°</th><th>Saver</th></tr></thead><tbody>
<tr><td>x0</td><td>zero</td><td>0å€¼å¯„å­˜å™¨ï¼Œç¡¬ç¼–ç ä¸º0,å†™å…¥æ•°æ®å¿½ç•¥ï¼Œè¯»å–æ°¸è¿œä¸º0</td><td>-</td></tr>
<tr><td>x1</td><td>ra</td><td>è¿”å›åœ°å€</td><td>Caller</td></tr>
<tr><td>x2</td><td>sp</td><td>æ ˆæŒ‡é’ˆ</td><td>Callee</td></tr>
<tr><td>x3</td><td>gp</td><td>å…¨å±€æŒ‡é’ˆ</td><td>-</td></tr>
<tr><td>x4</td><td>tp</td><td>çº¿ç¨‹æŒ‡é’ˆ</td><td>-</td></tr>
<tr><td>x5</td><td>t0</td><td>ä¸´æ—¶å¯„å­˜å™¨æˆ–è€…å¤‡ç”¨çš„é“¾æ¥å¯„å­˜å™¨</td><td>Caller</td></tr>
<tr><td>x6-x7</td><td>t1-t2</td><td>ä¸´æ—¶å¯„å­˜å™¨</td><td>Caller</td></tr>
<tr><td>x8</td><td>s0/fp</td><td>éœ€è¦ä¿å­˜çš„å¯„å­˜å™¨æˆ–è€…å¸§æŒ‡é’ˆå¯„å­˜å™¨</td><td>Callee</td></tr>
<tr><td>x9</td><td>s1</td><td>éœ€è¦ä¿å­˜çš„å¯„å­˜å™¨ï¼Œä¿å­˜åŸè¿›ç¨‹ä¸­çš„å…³é”®æ•°æ®ï¼Œé¿å…åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­è¢«ç ´å</td><td>Callee</td></tr>
<tr><td>x10-x11</td><td>a0-a1</td><td>å‡½æ•°å‚æ•°/è¿”å›å€¼</td><td>Caller</td></tr>
<tr><td>x12-x17</td><td>a2-a7</td><td>å‡½æ•°å‚æ•°</td><td>Caller</td></tr>
<tr><td>x18-x27</td><td>s2-s11</td><td>éœ€è¦ä¿å­˜çš„å¯„å­˜å™¨</td><td>Callee</td></tr>
<tr><td>x28-x31</td><td>t3-t6</td><td>ä¸´æ—¶å¯„å­˜å™¨</td><td>Caller</td></tr>
</tbody></table>
</div>
<h4 id="å‡½æ•°è°ƒç”¨æ—¶ä¿ç•™çš„å¯„å­˜å™¨"><a class="header" href="#å‡½æ•°è°ƒç”¨æ—¶ä¿ç•™çš„å¯„å­˜å™¨">å‡½æ•°è°ƒç”¨æ—¶ä¿ç•™çš„å¯„å­˜å™¨</a></h4>
<p>è¢«è°ƒç”¨å‡½æ•°ä¸€èˆ¬ä¸ä¼šä½¿ç”¨è¿™äº›å¯„å­˜å™¨ï¼Œå³ä¾¿ä½¿ç”¨ä¹Ÿä¼šæå‰ä¿å­˜å¥½åŸå€¼ï¼Œå¯ä»¥ä¿¡ä»»ã€‚è¿™äº›å¯„å­˜å™¨æœ‰ï¼šsp, gp, tp å’Œ s0-s11 å¯„å­˜å™¨ã€‚</p>
<h4 id="å‡½æ•°è°ƒç”¨æ—¶ä¸ä¿å­˜çš„å¯„å­˜å™¨"><a class="header" href="#å‡½æ•°è°ƒç”¨æ—¶ä¸ä¿å­˜çš„å¯„å­˜å™¨">å‡½æ•°è°ƒç”¨æ—¶ä¸ä¿å­˜çš„å¯„å­˜å™¨</a></h4>
<p>æœ‰å¯èƒ½è¢«è°ƒç”¨å‡½æ•°ä½¿ç”¨æ›´æ”¹ï¼Œéœ€è¦calleråœ¨è°ƒç”¨å‰å¯¹è‡ªå·±ç”¨åˆ°çš„å¯„å­˜å™¨è¿›è¡Œä¿å­˜ã€‚è¿™äº›å¯„å­˜å™¨æœ‰ï¼šå‚æ•°ä¸è¿”å›åœ°å€å¯„å­˜å™¨ a0-a7ï¼Œè¿”å›åœ°å€å¯„å­˜å™¨ raï¼Œä¸´æ—¶å¯„å­˜å™¨ t0-t6</p>
<h2 id="rv32i-åŸºç¡€æŒ‡ä»¤æ ¼å¼"><a class="header" href="#rv32i-åŸºç¡€æŒ‡ä»¤æ ¼å¼">RV32I åŸºç¡€æŒ‡ä»¤æ ¼å¼</a></h2>
<p><img src="../images/risc-v/rv32i_instruction_format.webp" alt="RV32I æŒ‡ä»¤ç¼–ç æ ¼å¼" /></p>
<ul>
<li>æºå¯„å­˜å™¨å’Œç›®æ ‡å¯„å­˜å™¨éƒ½è®¾è®¡å›ºå®šåœ¨æ‰€æœ‰ RISC-V æŒ‡ä»¤åŒæ ·çš„ä½ç½®ä¸Šï¼ŒæŒ‡ä»¤è¯‘ç ç›¸å¯¹ç®€å•ï¼Œæ‰€ä»¥æŒ‡ä»¤åœ¨ CPU æµæ°´çº¿ä¸­æ‰§è¡Œæ—¶ï¼Œå¯ä»¥å…ˆå¼€å§‹è®¿é—®å¯„å­˜å™¨ï¼Œç„¶åå†å®ŒæˆæŒ‡ä»¤è§£ç ã€‚</li>
<li>æ‰€æœ‰ç«‹å³æ•°çš„<strong>ç¬¦å·ä½</strong>æ€»æ˜¯åœ¨æŒ‡ä»¤çš„<strong>æœ€é«˜ä½</strong>ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ï¼Œæœ‰å¯èƒ½æˆä¸ºå…³é”®è·¯å¾„çš„<strong>ç«‹å³æ•°ç¬¦å·æ‰©å±•</strong>å¯ä»¥åœ¨æŒ‡ä»¤è§£ç å‰è¿›è¡Œï¼Œæœ‰åˆ©äº CPU æµæ°´çº¿çš„æ—¶åºä¼˜åŒ–ã€‚</li>
</ul>
<h3 id="å¯„å­˜å™¨-å¯„å­˜å™¨çš„ç®—æœ¯æŒ‡ä»¤"><a class="header" href="#å¯„å­˜å™¨-å¯„å­˜å™¨çš„ç®—æœ¯æŒ‡ä»¤">å¯„å­˜å™¨-å¯„å­˜å™¨çš„ç®—æœ¯æŒ‡ä»¤</a></h3>
<p><img src="../images/risc-v/rv32i_instruction_arithmetic_reg2reg.webp" alt="RV32I å¯„å­˜å™¨-å¯„å­˜å™¨çš„ç®—æœ¯æŒ‡ä»¤" /></p>
<h4 id="æŒ‡ä»¤æ±‡ç¼–æ ¼å¼"><a class="header" href="#æŒ‡ä»¤æ±‡ç¼–æ ¼å¼">æŒ‡ä»¤æ±‡ç¼–æ ¼å¼</a></h4>
<h5 id="åŠ æ³•"><a class="header" href="#åŠ æ³•">åŠ æ³•</a></h5>
<pre><code class="language-assembly">add rd, rs1, rs2
</code></pre>
<h5 id="å‡æ³•"><a class="header" href="#å‡æ³•">å‡æ³•</a></h5>
<pre><code class="language-assembly">sub rd, rs1, rs2
</code></pre>
<h5 id="é€»è¾‘ä¸"><a class="header" href="#é€»è¾‘ä¸">é€»è¾‘ä¸</a></h5>
<pre><code class="language-assembly">and rd, rs1, rs2
</code></pre>
<h5 id="é€»è¾‘æˆ–"><a class="header" href="#é€»è¾‘æˆ–">é€»è¾‘æˆ–</a></h5>
<pre><code class="language-assembly">or rd, rs1, rs2
</code></pre>
<h5 id="é€»è¾‘å¼‚æˆ–"><a class="header" href="#é€»è¾‘å¼‚æˆ–">é€»è¾‘å¼‚æˆ–</a></h5>
<pre><code class="language-assembly">xor rd, rs1, rs2
</code></pre>
<h5 id="æœ‰ç¬¦å·å°äºæ¯”è¾ƒ"><a class="header" href="#æœ‰ç¬¦å·å°äºæ¯”è¾ƒ">æœ‰ç¬¦å·å°äºæ¯”è¾ƒ</a></h5>
<pre><code class="language-assembly">slt rd, rs1, rs2
</code></pre>
<h5 id="æ— ç¬¦å·å°äºæ¯”è¾ƒ"><a class="header" href="#æ— ç¬¦å·å°äºæ¯”è¾ƒ">æ— ç¬¦å·å°äºæ¯”è¾ƒ</a></h5>
<pre><code class="language-assembly">sltu rd, rs1, rs2
</code></pre>
<h5 id="é€»è¾‘å·¦ç§»"><a class="header" href="#é€»è¾‘å·¦ç§»">é€»è¾‘å·¦ç§»</a></h5>
<pre><code class="language-assembly">sll rd, rs1, rs2
</code></pre>
<h5 id="é€»è¾‘å³ç§»"><a class="header" href="#é€»è¾‘å³ç§»">é€»è¾‘å³ç§»</a></h5>
<pre><code class="language-assembly">srl rd, rs1, rs2
</code></pre>
<h5 id="ç®—æ•°å³ç§»"><a class="header" href="#ç®—æ•°å³ç§»">ç®—æ•°å³ç§»</a></h5>
<pre><code class="language-assembly">sra rd, rs1, rs2
</code></pre>
<h3 id="ç«‹å³æ•°çš„ç®—æœ¯æŒ‡ä»¤"><a class="header" href="#ç«‹å³æ•°çš„ç®—æœ¯æŒ‡ä»¤">ç«‹å³æ•°çš„ç®—æœ¯æŒ‡ä»¤</a></h3>
<p><img src="../images/risc-v/rv32i_instruction_arithmetic_immediate.webp" alt="RV32I ç«‹å³æ•°çš„ç®—æœ¯æŒ‡ä»¤" /></p>
<blockquote>
<p>æ³¨æ„ï¼Œåœ¨ç«‹å³æ•°ç®—æœ¯æŒ‡ä»¤ä¸­ï¼Œæ²¡æœ‰å‡æ³•è¿ç®—ã€‚</p>
</blockquote>
<h4 id="æŒ‡ä»¤æ±‡ç¼–æ ¼å¼-1"><a class="header" href="#æŒ‡ä»¤æ±‡ç¼–æ ¼å¼-1">æŒ‡ä»¤æ±‡ç¼–æ ¼å¼</a></h4>
<h5 id="ç«‹å³æ•°åŠ æ³•"><a class="header" href="#ç«‹å³æ•°åŠ æ³•">ç«‹å³æ•°åŠ æ³•</a></h5>
<pre><code class="language-assembly">addi rd, rs1, imm[11:0]
</code></pre>
<h5 id="ç«‹å³æ•°é€»è¾‘ä¸"><a class="header" href="#ç«‹å³æ•°é€»è¾‘ä¸">ç«‹å³æ•°é€»è¾‘ä¸</a></h5>
<pre><code class="language-assembly">andi rd, rs1, imm[11:0]
</code></pre>
<h5 id="ç«‹å³æ•°é€»è¾‘æˆ–"><a class="header" href="#ç«‹å³æ•°é€»è¾‘æˆ–">ç«‹å³æ•°é€»è¾‘æˆ–</a></h5>
<pre><code class="language-assembly">ori rd, rs1, imm[11:0]
</code></pre>
<h5 id="ç«‹å³æ•°é€»è¾‘å¼‚æˆ–"><a class="header" href="#ç«‹å³æ•°é€»è¾‘å¼‚æˆ–">ç«‹å³æ•°é€»è¾‘å¼‚æˆ–</a></h5>
<pre><code class="language-assembly">xori rd, rs1, imm[11:0]
</code></pre>
<h5 id="ç«‹å³æ•°æœ‰ç¬¦å·å°äºæ¯”è¾ƒ"><a class="header" href="#ç«‹å³æ•°æœ‰ç¬¦å·å°äºæ¯”è¾ƒ">ç«‹å³æ•°æœ‰ç¬¦å·å°äºæ¯”è¾ƒ</a></h5>
<pre><code class="language-assembly">slti rd, rs1, imm[11:0]
</code></pre>
<h5 id="ç«‹å³æ•°æ— ç¬¦å·å°äºæ¯”è¾ƒ"><a class="header" href="#ç«‹å³æ•°æ— ç¬¦å·å°äºæ¯”è¾ƒ">ç«‹å³æ•°æ— ç¬¦å·å°äºæ¯”è¾ƒ</a></h5>
<pre><code class="language-assembly">sltiu rd, rs1, imm[11:0]
</code></pre>
<h5 id="ç«‹å³æ•°é€»è¾‘å·¦ç§»"><a class="header" href="#ç«‹å³æ•°é€»è¾‘å·¦ç§»">ç«‹å³æ•°é€»è¾‘å·¦ç§»</a></h5>
<pre><code class="language-assembly">slli rd, rs1, shamt[4:0]
</code></pre>
<h5 id="ç«‹å³æ•°é€»è¾‘å³ç§»"><a class="header" href="#ç«‹å³æ•°é€»è¾‘å³ç§»">ç«‹å³æ•°é€»è¾‘å³ç§»</a></h5>
<pre><code class="language-assembly">srli rd, rs1, shamt[4:0]
</code></pre>
<h5 id="ç«‹å³æ•°ç®—æ•°å³ç§»"><a class="header" href="#ç«‹å³æ•°ç®—æ•°å³ç§»">ç«‹å³æ•°ç®—æ•°å³ç§»</a></h5>
<pre><code class="language-assembly">srai rd, rs1, shamt[4:0]
</code></pre>
<h3 id="loadstore-æŒ‡ä»¤"><a class="header" href="#loadstore-æŒ‡ä»¤">Load/Store æŒ‡ä»¤</a></h3>
<p><img src="../images/risc-v/rv32i_instruction_load_store.webp" alt="RV32I Load/Store æŒ‡ä»¤" /></p>
<p>Load å’Œ Store çš„å¯»å€æ¨¡å¼åªèƒ½æ˜¯ç¬¦å·æ‰©å±• 12 ä½çš„ç«‹å³æ•°ï¼ŒåŠ ä¸ŠåŸºåœ°å€å¯„å­˜å™¨å¾—åˆ°è®¿é—®çš„å­˜å‚¨å™¨åœ°å€ã€‚å› ä¸ºæ²¡æœ‰äº†å¤æ‚çš„å†…å­˜å¯»å€æ–¹å¼ï¼Œè¿™è®© CPU æµæ°´çº¿å¯ä»¥å¯¹æ•°æ®å†²çªæå‰åšå‡ºåˆ¤æ–­ï¼Œå¹¶é€šè¿‡æµæ°´çº¿å„çº§ä¹‹é—´çš„è½¬é€åŠ ä»¥å¤„ç†ï¼Œè€Œä¸éœ€è¦æ’å…¥ç©ºæ“ä½œï¼ˆNOPï¼‰ï¼Œæå¤§æé«˜äº†ä»£ç çš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼ŒLoadæŒ‡ä»¤å±äº <strong>I</strong> å‹æŒ‡ä»¤ï¼Œè€Œ Store æŒ‡ä»¤å±äº <strong>S</strong> å‹æŒ‡ä»¤ã€‚</p>
</blockquote>
<h4 id="æŒ‡ä»¤æ±‡ç¼–æ ¼å¼-2"><a class="header" href="#æŒ‡ä»¤æ±‡ç¼–æ ¼å¼-2">æŒ‡ä»¤æ±‡ç¼–æ ¼å¼</a></h4>
<h5 id="å­—åŠ è½½"><a class="header" href="#å­—åŠ è½½">å­—åŠ è½½</a></h5>
<pre><code class="language-assembly">lw rd, offset[11:0](rs1)
</code></pre>
<h5 id="åŠå­—åŠ è½½"><a class="header" href="#åŠå­—åŠ è½½">åŠå­—åŠ è½½</a></h5>
<pre><code class="language-assembly">lh rd, offset[11:0](rs1)
</code></pre>
<h5 id="æ— ç¬¦å·åŠå­—åŠ è½½"><a class="header" href="#æ— ç¬¦å·åŠå­—åŠ è½½">æ— ç¬¦å·åŠå­—åŠ è½½</a></h5>
<pre><code class="language-assembly">lhu rd, offset[11:0](rs1)
</code></pre>
<h5 id="å­—èŠ‚åŠ è½½"><a class="header" href="#å­—èŠ‚åŠ è½½">å­—èŠ‚åŠ è½½</a></h5>
<pre><code class="language-assembly">lb rd, offset[11:0](rs1)
</code></pre>
<h5 id="æ— ç¬¦å·å­—èŠ‚åŠ è½½"><a class="header" href="#æ— ç¬¦å·å­—èŠ‚åŠ è½½">æ— ç¬¦å·å­—èŠ‚åŠ è½½</a></h5>
<pre><code class="language-assembly">lbu rd, offset[11:0](rs1)
</code></pre>
<h5 id="å­—å­˜å‚¨"><a class="header" href="#å­—å­˜å‚¨">å­—å­˜å‚¨</a></h5>
<pre><code class="language-assembly">sw rs2, offset[11:0](rs1)
</code></pre>
<h5 id="åŠå­—å­˜å‚¨"><a class="header" href="#åŠå­—å­˜å‚¨">åŠå­—å­˜å‚¨</a></h5>
<pre><code class="language-assembly">sh rs2, offset[11:0](rs1)
</code></pre>
<h5 id="å­—èŠ‚å­˜å‚¨"><a class="header" href="#å­—èŠ‚å­˜å‚¨">å­—èŠ‚å­˜å‚¨</a></h5>
<pre><code class="language-assembly">sb rs2, offset[11:0](rs1)
</code></pre>
<h3 id="æœ‰æ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤"><a class="header" href="#æœ‰æ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤">æœ‰æ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤</a></h3>
<p><img src="../images/risc-v/rv32i_instruction_branch_condition.webp" alt="æœ‰æ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤" /></p>
<h4 id="æŒ‡ä»¤æ±‡ç¼–æ ¼å¼-3"><a class="header" href="#æŒ‡ä»¤æ±‡ç¼–æ ¼å¼-3">æŒ‡ä»¤æ±‡ç¼–æ ¼å¼</a></h4>
<h5 id="ç›¸ç­‰è·³è½¬"><a class="header" href="#ç›¸ç­‰è·³è½¬">ç›¸ç­‰è·³è½¬</a></h5>
<pre><code class="language-assembly">beq rs1, rs2, label
</code></pre>
<h5 id="ä¸ç­‰è·³è½¬"><a class="header" href="#ä¸ç­‰è·³è½¬">ä¸ç­‰è·³è½¬</a></h5>
<pre><code class="language-assembly">bne rs1, rs2, label
</code></pre>
<h5 id="å°äºè·³è½¬"><a class="header" href="#å°äºè·³è½¬">å°äºè·³è½¬</a></h5>
<pre><code class="language-assembly">blt rs1, rs2, label
</code></pre>
<h5 id="æ— ç¬¦å·å°äºè·³è½¬"><a class="header" href="#æ— ç¬¦å·å°äºè·³è½¬">æ— ç¬¦å·å°äºè·³è½¬</a></h5>
<pre><code class="language-assembly">bltu rs1, rs2, label
</code></pre>
<h5 id="å¤§äºç­‰äºè·³è½¬"><a class="header" href="#å¤§äºç­‰äºè·³è½¬">å¤§äºç­‰äºè·³è½¬</a></h5>
<pre><code class="language-assembly">bge rs1, rs2, label
</code></pre>
<h5 id="æ— ç¬¦å·å¤§äºç­‰äºè·³è½¬"><a class="header" href="#æ— ç¬¦å·å¤§äºç­‰äºè·³è½¬">æ— ç¬¦å·å¤§äºç­‰äºè·³è½¬</a></h5>
<pre><code class="language-assembly">bgeu rs1, rs2, label
</code></pre>
<h3 id="æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤"><a class="header" href="#æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤">æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤</a></h3>
<blockquote>
<p>æ³¨æ„ï¼Œç›´æ¥è·³è½¬æ˜¯ <strong>J</strong> å‹æŒ‡ä»¤ï¼Œè€Œç›¸å¯¹è·³è½¬æ˜¯ <strong>I</strong> å‹æŒ‡ä»¤ã€‚</p>
</blockquote>
<h4 id="ç›´æ¥è·³è½¬æŒ‡ä»¤"><a class="header" href="#ç›´æ¥è·³è½¬æŒ‡ä»¤">ç›´æ¥è·³è½¬æŒ‡ä»¤</a></h4>
<p><img src="../images/risc-v/rv32i_instruction_branch_direct.webp" alt="æ— æ¡ä»¶ç›´æ¥è·³è½¬" /></p>
<p>JAL æŒ‡ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li>é¦–å…ˆï¼ŒæŠŠ 20 ä½çš„ç«‹å³æ•°åšç¬¦å·æ‰©å±•ï¼Œå¹¶å·¦ç§»ä¸€ä½ï¼Œäº§ç”Ÿä¸€ä¸ª 32 ä½çš„ç¬¦å·æ•°</li>
<li>ç„¶åï¼Œå°†è¯¥ 32 ä½ç¬¦å·æ•°å’Œ PC ç›¸åŠ æ¥äº§ç”Ÿç›®æ ‡åœ°å€ï¼ˆè¿™æ · JAL å¯ä»¥ä½œä¸ºçŸ­è·³è½¬æŒ‡ä»¤ï¼Œè·³è½¬è‡³ PCÂ±1MB çš„åœ°å€èŒƒå›´å†…ï¼‰</li>
<li>åŒæ—¶ï¼ŒJAL ä¼šæŠŠç´§éšå…¶åçš„é‚£æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå­˜å…¥ç›®æ ‡å¯„å­˜å™¨ä¸­ã€‚è¿™æ ·ï¼Œå¦‚æœç›®æ ‡å¯„å­˜å™¨æ˜¯0,åˆ™ JAL å°±ç­‰åŒäº goto æŒ‡ä»¤ï¼›å¦‚æœç›®æ ‡å¯„å­˜å™¨ä¸ä¸ºé›¶ï¼ŒJAL å¯ä»¥å®ç°å‡½æ•°è°ƒç”¨çš„åŠŸèƒ½</li>
</ol>
<h4 id="ç›¸å¯¹è·³è½¬æŒ‡ä»¤"><a class="header" href="#ç›¸å¯¹è·³è½¬æŒ‡ä»¤">ç›¸å¯¹è·³è½¬æŒ‡ä»¤</a></h4>
<p><img src="../images/risc-v/rv32i_instruction_branch_relative.webp" alt="æ— æ¡ä»¶ç›¸å¯¹è·³è½¬" /></p>
<p>JALR æŒ‡ä»¤ä¼šæŠŠ 12 ä½ç«‹å³æ•°å’Œæºå¯„å­˜å™¨ç›¸åŠ ï¼Œå¹¶æŠŠç›¸åŠ çš„ç»“æœæœ«ä½æ¸…é›¶ï¼Œä½œä¸ºæ–°çš„è·³è½¬åœ°å€ã€‚å’Œ JAL æŒ‡ä»¤ä¸€æ ·ï¼ŒJALR ä¹Ÿä¼šæŠŠç´§éšå…¶åçš„é‚£æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå­˜å…¥ç›®æ ‡å¯„å­˜å™¨ä¸­ã€‚</p>
<h4 id="æŒ‡ä»¤æ±‡ç¼–æ ¼å¼-4"><a class="header" href="#æŒ‡ä»¤æ±‡ç¼–æ ¼å¼-4">æŒ‡ä»¤æ±‡ç¼–æ ¼å¼</a></h4>
<h5 id="æ— æ¡ä»¶ç›´æ¥è·³è½¬"><a class="header" href="#æ— æ¡ä»¶ç›´æ¥è·³è½¬">æ— æ¡ä»¶ç›´æ¥è·³è½¬</a></h5>
<pre><code class="language-assembly">jal rd, label # å°† PC+4 çš„å€¼ä¿å­˜åˆ° rd å¯„å­˜å™¨ä¸­ï¼Œç„¶åè®¾ç½® PC = PC + offset
</code></pre>
<p>ä¼ªæŒ‡ä»¤ <code>j</code> å®é™…ä¸Šå°±æ˜¯jalæŒ‡ä»¤çš„å˜ä½“ï¼Œæ­¤æ—¶ rd ä¼šè¢«è®¾ç½®ä¸º x0,è¡¨ç¤ºä¸¢å¼ƒè¿”å›åœ°å€</p>
<h5 id="æ— æ¡ä»¶ç›¸å¯¹è·³è½¬"><a class="header" href="#æ— æ¡ä»¶ç›¸å¯¹è·³è½¬">æ— æ¡ä»¶ç›¸å¯¹è·³è½¬</a></h5>
<pre><code class="language-assembly">jalr rd, rs1, imm # å°† PC+4 ä¿å­˜åˆ° rd å¯„å­˜å™¨ä¸­ï¼Œç„¶åè®¾ç½® PC = rs1  + imm
</code></pre>
<p>è·³è½¬åˆ°ä»»æ„ 32 ä½ç»å¯¹åœ°å€å¤„</p>
<pre><code class="language-assembly">lui x1, &lt;hi20bits&gt;
jalr ra, x1, &lt;lo12bits&gt;
</code></pre>
<p>ç›¸å¯¹PCåœ°å€32ä½åç§»é‡çš„ç›¸å¯¹è·³è½¬</p>
<pre><code class="language-assembly">auipc x1, &lt;hi20bits&gt;
jalr x0, x1, &lt;lo12bits&gt;
</code></pre>
<h3 id="uupper-immediateå‹æŒ‡ä»¤"><a class="header" href="#uupper-immediateå‹æŒ‡ä»¤">U(Upper immediate)å‹æŒ‡ä»¤</a></h3>
<p><img src="../images/risc-v/riscv_U_instruction.png" alt="Uå‹æŒ‡ä»¤" /></p>
<h4 id="æŒ‡ä»¤æ±‡ç¼–æ ¼å¼-5"><a class="header" href="#æŒ‡ä»¤æ±‡ç¼–æ ¼å¼-5">æŒ‡ä»¤æ±‡ç¼–æ ¼å¼</a></h4>
<h5 id="lui-æŒ‡ä»¤-load-upper-immediate"><a class="header" href="#lui-æŒ‡ä»¤-load-upper-immediate">lui æŒ‡ä»¤ (Load Upper Immediate)</a></h5>
<pre><code class="language-assembly">lui rd, imm # å°† 20 ä½çš„ç«‹å³æ•°å·¦ç§»12ä½ï¼Œä½ 12 ä½è¡¥é›¶ï¼Œå¹¶å†™å›å¯„å­˜å™¨ rd ä¸­
</code></pre>
<p>é…åˆ addi æŒ‡ä»¤ï¼ˆè®¾ç½®ä½ 12 æ¯”ç‰¹ï¼‰å¯å®ç°è®²å¯„å­˜å™¨è®¾ç½®ä¸ºä»»æ„ 32 æ¯”ç‰¹çš„ç«‹å³æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-assembly">lui x10, 0x87654     # x10 = 0x87654000
addi x10, x10, 0x321 # x10 = 0x87654321
</code></pre>
<p>ä½†æ˜¯ï¼Œå½“è¿™ä¸ª 12 ä½çš„ç«‹å³æ•°ä¸ºè´Ÿæ•°ï¼ˆå³æœ€é«˜æ¯”ç‰¹ä½æ˜¯1ï¼‰æ—¶ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯é«˜ 20 ä½å‡ 1 å†å’Œä½ 12 ä½æ‹¼æ¥ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-assembly">lui x10, 0xDEADB     # x10 = 0xDEADB000
addi x10, x10, 0xEEF # x10 = 0xDEADBEEF
</code></pre>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ï¼Œå¦‚æœä½ 12 ä½çš„ç«‹å³æ•°çš„ç¬¦å·ä½æ˜¯ 1 ,é‚£å°±é¢„å…ˆç»™é«˜ 20 ä½çš„æ•°åŠ  1ã€‚<code>li</code> ä¼ªæŒ‡ä»¤å¯ä»¥æ›¿æˆ‘ä»¬å¤„ç†å¥½è¿™ç§ç‰¹æ®Šæƒ…å†µã€‚</p>
<h5 id="auipc-æŒ‡ä»¤-add-upper-immediate-to-pc"><a class="header" href="#auipc-æŒ‡ä»¤-add-upper-immediate-to-pc">auipc æŒ‡ä»¤ (Add Upper Immediate to PC)</a></h5>
<pre><code class="language-assembly">auipc rd, imm # å°† 20 ä½çš„ç«‹å³æ•°å·¦ç§»12ä½ï¼Œä½ 12 ä½è¡¥é›¶ï¼Œå°†å¾—åˆ°çš„ 32 ä½æ•°ä¸ pc çš„å€¼ç›¸åŠ ï¼Œæœ€åå†™å›å¯„å­˜å™¨ rd ä¸­
</code></pre>
<p>å…·ä½“åº”ç”¨æœ‰ï¼š</p>
<pre><code class="language-assembly">Label: auipc x10, 0 # å°† Label çš„åœ°å€ä¿å­˜åœ¨ x10 å¯„å­˜å™¨ä¸­
</code></pre>
<h3 id="æŒ‡ä»¤ç¼–ç ç©ºé—´çš„å¯æ‰©å±•æ€§"><a class="header" href="#æŒ‡ä»¤ç¼–ç ç©ºé—´çš„å¯æ‰©å±•æ€§">æŒ‡ä»¤ç¼–ç ç©ºé—´çš„å¯æ‰©å±•æ€§</a></h3>
<p><img src="../images/risc-v/riscv_isa_custom_instruction.png" alt="æŒ‡ä»¤ç¼–ç ç©ºé—´çš„æ‰©å±•" /></p>
<ul>
<li>custom-0ã€custom-1 ç”¨äº RV32 çš„è‡ªå®šä¹‰æŒ‡ä»¤é›†æ‰©å±•</li>
<li>custom-2ã€custom-3 é¢„ç•™ç»™ RV128ï¼Œä¹Ÿå¯ä»¥ç”¨äº RV32ã€RV64 çš„ç”¨æˆ·è‡ªå®šä¹‰æŒ‡ä»¤é›†æ‰©å±•</li>
</ul>
<h2 id="csr-å¯„å­˜å™¨æŒ‡ä»¤"><a class="header" href="#csr-å¯„å­˜å™¨æŒ‡ä»¤">CSR å¯„å­˜å™¨æŒ‡ä»¤</a></h2>
<p>é™¤äº†å†…å­˜åœ°å€ç©ºé—´å’Œé€šç”¨å¯„å­˜å™¨åœ°å€ç©ºé—´å¤–ï¼ŒRISC-V ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ªç‹¬ç«‹çš„æ§åˆ¶ä¸çŠ¶æ€å¯„å­˜å™¨ï¼ˆCSRï¼‰åœ°å€ç©ºé—´ã€‚</p>
<h3 id="ç‹¬ç«‹çš„-12-ä½åœ°å€ç¼–ç ç©ºé—´"><a class="header" href="#ç‹¬ç«‹çš„-12-ä½åœ°å€ç¼–ç ç©ºé—´">ç‹¬ç«‹çš„ 12 ä½åœ°å€ç¼–ç ç©ºé—´</a></h3>
<p><img src="../images/risc-v/csr_register_encoding.png" alt="CSRå¯„å­˜å™¨è®¿é—®æŒ‡ä»¤çš„ç¼–ç " /></p>
<h3 id="ä¸“ç”¨çš„-csr-æŒ‡ä»¤"><a class="header" href="#ä¸“ç”¨çš„-csr-æŒ‡ä»¤">ä¸“ç”¨çš„ CSR æŒ‡ä»¤</a></h3>
<p><img src="../images/risc-v/rv32i_csr_instruction.webp" alt="CSR æŒ‡ä»¤" /></p>
<h2 id="å…¶ä»–æŒ‡ä»¤"><a class="header" href="#å…¶ä»–æŒ‡ä»¤">å…¶ä»–æŒ‡ä»¤</a></h2>
<ul>
<li>ç³»ç»Ÿè°ƒç”¨ <code>ecall</code> æŒ‡ä»¤</li>
<li>è°ƒè¯•æ—¶ç”¨äºå°†æ§åˆ¶è½¬ç§»åˆ°è°ƒè¯•ç¯å¢ƒçš„ <code>ebreak</code> æŒ‡ä»¤</li>
</ul>
<h3 id="å¸¸ç”¨æ±‡ç¼–ä¼ªæŒ‡ä»¤"><a class="header" href="#å¸¸ç”¨æ±‡ç¼–ä¼ªæŒ‡ä»¤">å¸¸ç”¨æ±‡ç¼–ä¼ªæŒ‡ä»¤</a></h3>
<h5 id="èµ‹å€¼æŒ‡ä»¤"><a class="header" href="#èµ‹å€¼æŒ‡ä»¤">èµ‹å€¼æŒ‡ä»¤</a></h5>
<pre><code class="language-assembly">mv rd, rs # ç­‰æ•ˆäº addi rd, rs, x0
</code></pre>
<h5 id="åŠ è½½ç«‹å³æ•°"><a class="header" href="#åŠ è½½ç«‹å³æ•°">åŠ è½½ç«‹å³æ•°</a></h5>
<pre><code class="language-assembly">li rd, 13 # ç­‰æ•ˆäº addi rd, x0, 13
</code></pre>
<h5 id="å‡½æ•°è°ƒç”¨å’Œè¿”å›"><a class="header" href="#å‡½æ•°è°ƒç”¨å’Œè¿”å›">å‡½æ•°è°ƒç”¨å’Œè¿”å›</a></h5>
<pre><code class="language-assembly">jal my_foo # å‡½æ•°è°ƒç”¨
ret # å‡½æ•°è¿”å›ï¼Œç­‰æ•ˆäº jr raï¼Œç­‰æ•ˆäº jalr x0, ra, 0
</code></pre>
<h2 id="å•æ ¸-cpu-ç»„æˆç»“æ„"><a class="header" href="#å•æ ¸-cpu-ç»„æˆç»“æ„">å•æ ¸ CPU ç»„æˆç»“æ„</a></h2>
<p><img src="../images/risc-v/riscv_alu.png" alt="ALU" /></p>
<p><strong>æ•°æ®é€šè·¯</strong>æ˜¯å¤„ç†å™¨ä¸­æ‰§è¡Œå¤„ç†å™¨æ‰€éœ€æ“ä½œçš„ç¡¬ä»¶éƒ¨åˆ†ï¼Œå°±åƒæ˜¯å¤„ç†å™¨çš„å››è‚¢ã€‚</p>
<p><strong>æ§åˆ¶å™¨</strong>æ˜¯å¯¹æ•°æ®é€šè·¯è¦åšä»€ä¹ˆæ“ä½œè¿›è¡Œè¡Œä¸ºè°ƒåº¦çš„ç¡¬ä»¶ç»“æ„ï¼Œå°±åƒæ˜¯å¤„ç†å™¨çš„å¤§è„‘ã€‚</p>
<h3 id="æµæ°´çº¿æŠ€æœ¯"><a class="header" href="#æµæ°´çº¿æŠ€æœ¯">æµæ°´çº¿æŠ€æœ¯</a></h3>
<h4 id="äº”çº§æµæ°´çº¿"><a class="header" href="#äº”çº§æµæ°´çº¿">äº”çº§æµæ°´çº¿</a></h4>
<p><img src="../images/risc-v/rv32i_5stage_pipelines.jpeg" alt="äº”çº§æµæ°´çº¿" /></p>
<h4 id="æµæ°´çº¿åœ¨ä¸åŒé˜¶æ®µä½¿ç”¨çš„èµ„æº"><a class="header" href="#æµæ°´çº¿åœ¨ä¸åŒé˜¶æ®µä½¿ç”¨çš„èµ„æº">æµæ°´çº¿åœ¨ä¸åŒé˜¶æ®µä½¿ç”¨çš„èµ„æº</a></h4>
<p><img src="../images/risc-v/riscv_pipeline_resource_usage.png" alt="æµæ°´çº¿èµ„æºä½¿ç”¨" /></p>
<blockquote>
<p>ä¸ºäº†ç¡®ä¿ç¡¬ä»¶å…±äº«çš„æ—¶å€™ï¼Œå‰ä¸€é˜¶æ®µçš„æ•°æ®ä¸è¢«ä¸¢å¤±ï¼Œéœ€è¦åœ¨æµæ°´çº¿ä¹‹é—´æ’å…¥â€œé˜¶æ®µå¯„å­˜å™¨â€æ¥ä¿å­˜ä¸­é—´å€¼å’Œæ§åˆ¶ä¿¡å·ã€‚</p>
</blockquote>
<h3 id="æ•°æ®é€šè·¯"><a class="header" href="#æ•°æ®é€šè·¯">æ•°æ®é€šè·¯</a></h3>
<p><img src="../images/risc-v/riscv_data_path.png" alt="æ•°æ®é€šè·¯" /></p>
<ol>
<li>å–æŒ‡é˜¶æ®µï¼ˆInstruction Fetchï¼‰ï¼šå°†æŒ‡ä»¤ä»å­˜å‚¨å™¨ä¸­è¯»å–å‡ºæ¥ï¼ŒPC å¯„å­˜å™¨å‘Šè¯‰å½“å‰æŒ‡ä»¤åœ¨å­˜å‚¨å™¨ä¸­çš„ä½ç½®ã€‚è¯»å–ä¸€æ¡æŒ‡ä»¤åï¼ŒPC å¯„å­˜å™¨ä¼šæ ¹æ®æŒ‡ä»¤çš„é•¿åº¦è‡ªåŠ¨é€’å¢ï¼Œæˆ–è€…æ”¹å†™æˆæŒ‡å®šçš„åœ°å€ã€‚</li>
<li>è¯‘ç é˜¶æ®µï¼ˆInstruction Decodeï¼‰ï¼šå°†å­˜å‚¨å™¨ä¸­å–å‡ºçš„æŒ‡ä»¤è¿›è¡Œç¿»è¯‘ï¼Œè¯†åˆ«å‡ºæŒ‡ä»¤çš„ç±»åˆ«ä»¥åŠæ‰€éœ€çš„å„ç§æ“ä½œæ•°ã€‚</li>
<li>æ‰§è¡Œé˜¶æ®µï¼ˆInstruction Executeï¼‰ï¼šå¯¹æŒ‡ä»¤è¿›è¡ŒçœŸæ­£çš„è¿ç®—ï¼ŒæœŸé—´æœ€å…³é”®çš„æ¨¡å—æ˜¯ç®—æœ¯é€»è¾‘å•å…ƒï¼ˆALUï¼‰ã€‚</li>
<li>è®¿å­˜é˜¶æ®µï¼ˆMemory Accessï¼‰ï¼šå­˜å‚¨å™¨è®¿é—®æŒ‡ä»¤å°†æ•°æ®ä»å­˜å‚¨å™¨ä¸­è¯»å‡ºï¼Œæˆ–å†™å…¥å­˜å‚¨å™¨ã€‚</li>
<li>å†™å›é˜¶æ®µï¼ˆWrite Backï¼‰ï¼šå°†æŒ‡ä»¤æ‰§è¡Œçš„ç»“æœå†™å›é€šç”¨å¯„å­˜å™¨ã€‚</li>
</ol>
<h3 id="ç®€æ˜“-cpu-å†…éƒ¨ç»„ä»¶æ¡†å›¾"><a class="header" href="#ç®€æ˜“-cpu-å†…éƒ¨ç»„ä»¶æ¡†å›¾">ç®€æ˜“ CPU å†…éƒ¨ç»„ä»¶æ¡†å›¾</a></h3>
<p><img src="../images/risc-v/rv32i_cpu_design.jpeg" alt="RV32I CPU 5çº§æµæ°´çº¿è®¾è®¡æ¡†å›¾" /></p>
<h3 id="pre_if-æ¨¡å—è®¾è®¡"><a class="header" href="#pre_if-æ¨¡å—è®¾è®¡">pre_if æ¨¡å—è®¾è®¡</a></h3>
<p>æ ¹æ®å½“å‰çš„æŒ‡ä»¤å’Œ PC å¯„å­˜å™¨ï¼Œé¢„æµ‹ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚ä¸ºäº†å®ç°ç¨‹åºåˆ†æ”¯è·³è½¬çš„åŠŸèƒ½ï¼Œå°±éœ€è¦è®¾è®¡ä¸€ä¸ª<strong>é¢„è¯»å–</strong>æ¨¡å—ï¼Œä¸ç®¡æŒ‡ä»¤æ˜¯å¦è·³è½¬ï¼ˆè¿™ä¸ªç»“æœä¼šåœ¨æŒ‡ä»¤æ‰§è¡Œé˜¶æ®µç»“æŸæ‰èƒ½çŸ¥é“ï¼‰ï¼Œéƒ½æå‰æŠŠè·³è½¬ä¹‹åçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ä»å­˜å‚¨å™¨ä¸­è¯»å–å‡ºæ¥ï¼Œä»¥å¤‡æµæ°´çº¿çš„ä¸‹ä¸€ä¸ªé˜¶æ®µä½¿ç”¨ï¼Œè¿™èƒ½æåˆ° CPU çš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<pre><code class="language-verilog">module pre_if (
    input [31:0] instr,
    input [31:0] pc,

    output [31:0] pre_pc
);

    wire is_bxx = (instr[6:0] == `OPCODE_BRANCH); // æ¡ä»¶è·³è½¬æŒ‡ä»¤çš„æ“ä½œç 
    wire is_jal = (instr[6:0] == `OPCODE_JAL) ;   // æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤çš„æ“ä½œç 

    // Bå‹æŒ‡ä»¤çš„ç«‹å³æ•°æ‹¼æ¥
    wire [31:0] bimm  = {{20{instr[31]}}, instr[7], instr[30:25], instr[11:8], 1'b0};
    // Jå‹æŒ‡ä»¤çš„ç«‹å³æ•°æ‹¼æ¥
    wire [31:0] jimm  = {{12{instr[31]}}, instr[19:12], instr[20], instr[30:21], 1'b0};

    // æŒ‡ä»¤åœ°å€çš„åç§»é‡
    // è¿™é‡Œå®é™…ä¸Šåšäº†ä¸€ä¸ªç®€å•çš„åˆ†æ”¯é¢„æµ‹
    wire [31:0] adder = is_jal ? jimm : (is_bxx &amp; bimm[31]) ? bimm : 4;
    // æ ¹æ®å½“å‰ PC å’ŒæŒ‡ä»¤çš„åç§»é‡ç›¸åŠ ï¼Œå¾—åˆ°é¢„æµ‹çš„ PC å€¼
    assign pre_pc = pc + adder;

endmodule
</code></pre>
<h3 id="if_id-æ¨¡å—è®¾è®¡"><a class="header" href="#if_id-æ¨¡å—è®¾è®¡">if_id æ¨¡å—è®¾è®¡</a></h3>
<p>é¢„è¯»å–æ¨¡å—è¯»å‡ºçš„æŒ‡ä»¤å¹¶ä¸æ˜¯å…¨éƒ¨éƒ½èƒ½å‘é€ç»™åç»­çš„æ¨¡å—æ‰§è¡Œçš„ï¼Œæ¯”å¦‚æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤åœ¨æ‰§è¡Œåå‘ç°è·³è½¬æ¡ä»¶ä¸æˆç«‹ï¼Œè¿™æ—¶é¢„è¯»å–çš„æŒ‡ä»¤å°±æ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦å¯¹æµæ°´çº¿è¿›è¡Œå†²åˆ·ï¼ˆflushï¼‰ï¼ŒæŠŠæ— æ•ˆçš„æŒ‡ä»¤éƒ½æ¸…é™¤æ‰ã€‚</p>
<pre><code class="language-verilog">module if_id (
  input         clk,
  input         reset,
  input  [31:0] in_instr,
  input  [31:0] in_pc,
  input         flush,
  input         valid,
  output [31:0] out_instr,
  output [31:0] out_pc,
  output        out_noflush
);

  reg [31:0] reg_instr;
  reg [31:0] reg_pc;
  reg        reg_noflush;

  assign out_instr = reg_instr;
  assign out_pc = reg_pc;
  assign out_noflush = reg_noflush;

  //æŒ‡ä»¤ä¼ é€’
  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_instr &lt;= 32'h0;
    end else if (flush) begin
      reg_instr &lt;= 32'h0;
    end else if (valid) begin
      reg_instr &lt;= in_instr;
    end
  end

  //PCå€¼è½¬é€’
  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_pc &lt;= 32'h0;
    end else if (flush) begin
      reg_pc &lt;= 32'h0;
    end else if (valid) begin
      reg_pc &lt;= in_pc;
    end
  end

  //æµæ°´çº¿å†²åˆ·æ ‡å¿—ä½
  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_noflush &lt;= 1'h0;
    end else if (flush) begin
      reg_noflush &lt;= 1'h0;
    end else if (valid) begin
      reg_noflush &lt;= 1'h1;
    end

  end

endmodule
</code></pre>
<h3 id="decode-æ¨¡å—è®¾è®¡"><a class="header" href="#decode-æ¨¡å—è®¾è®¡">decode æ¨¡å—è®¾è®¡</a></h3>
<p>å°½ç®¡æŒ‡ä»¤æ ¼å¼ä¸åŒï¼Œä½†æ˜¯æŒ‡ä»¤è¯‘ç æ¨¡å—ç¿»è¯‘æŒ‡ä»¤çš„å·¥ä½œæœºåˆ¶æ˜¯<strong>ç»Ÿä¸€</strong>çš„ã€‚é¦–å…ˆä¼šç¿»è¯‘å‡ºæŒ‡ä»¤ä¸­æºå¸¦çš„å¯„å­˜å™¨ç´¢å¼•ã€ç«‹å³æ•°ç­‰ä¿¡æ¯ï¼Œæ¥ç€å¤„ç†å¯èƒ½å­˜åœ¨çš„æ•°æ®å†’é™©ï¼Œå†ç”±è¯‘ç æ•°æ®é€šè·¯è´Ÿè´£æŠŠè¯‘ç åçš„æŒ‡ä»¤ä¿¡æ¯ï¼Œå‘é€ç»™å¯¹åº”çš„æ‰§è¡Œå•å…ƒå»æ‰§è¡Œã€‚</p>
<p>è¯‘ç çš„è¿‡ç¨‹ï¼šå…ˆè¯†åˆ«æŒ‡ä»¤çš„æ“ä½œç ï¼ˆæ°¸è¿œæ˜¯ä½7ä½ï¼‰ï¼Œæ ¹æ®æ“ä½œç å¯¹åº”çš„ä»£ç æ ‡è¯†ï¼Œäº§ç”Ÿåˆ†æ”¯ä¿¡å· branchã€è·³è½¬ä¿¡å· jumpã€è¯»å­˜å‚¨å™¨ä¿¡å· mem_read ......</p>
<pre><code class="language-verilog">module decode (
  input   [31:0] instr,

  output  [4:0] rs1_addr,
  output  [4:0] rs2_addr,
  output  [4:0] rd_addr,
  output  [2:0] funct3,
  output  [6:0] funct7,
  output        branch,
  output [1:0]  jump,
  output        mem_read,
  output        mem_write,
  output        reg_write,
  output        to_reg,
  output [1:0]  result_sel,
  output        alu_src,
  output        pc_add,
  output [6:0]  types,
  output [1:0]  alu_ctrlop,
  output        valid_inst,
  output [31:0] imm
);

localparam DEC_INVALID = 21'b0;

reg [20:0] dec_array;

//---------- decode rs1ã€rs2 -----------------
assign rs1_addr = instr[19:15];
assign rs2_addr = instr[24:20];

//---------- decode rd -----------------------
assign rd_addr = instr[11:7];

//---------- decode funct3ã€funct7 -----------
assign funct7 = instr[31:25];
assign funct3 = instr[14:12];

// ----------------------------- decode signals ---------------------------------

//                        20     19-18  17       16        15        14     13-12      11      10     9--------3  2---1      0
//                        branch jump   memRead  memWrite  regWrite  toReg  resultSel  aluSrc  pcAdd     RISBUJZ  aluctrlop  validInst
localparam DEC_LUI     = {1'b0,  2'b00, 1'b0,    1'b0,     1'b1,     1'b0,  2'b01,     1'b0,   1'b0,  7'b0000100, 2'b00,     1'b1};
localparam DEC_AUIPC   = {1'b0,  2'b00, 1'b0,    1'b0,     1'b1,     1'b0,  2'b00,     1'b1,   1'b1,  7'b0000100, 2'b00,     1'b1};
localparam DEC_JAL     = {1'b0,  2'b00, 1'b0,    1'b0,     1'b1,     1'b0,  2'b10,     1'b0,   1'b0,  7'b0000010, 2'b00,     1'b1};
localparam DEC_JALR    = {1'b0,  2'b11, 1'b0,    1'b0,     1'b1,     1'b0,  2'b10,     1'b1,   1'b0,  7'b0100000, 2'b00,     1'b1};
localparam DEC_BRANCH  = {1'b1,  2'b00, 1'b0,    1'b0,     1'b0,     1'b0,  2'b00,     1'b0,   1'b0,  7'b0001000, 2'b10,     1'b1};
localparam DEC_LOAD    = {1'b0,  2'b00, 1'b1,    1'b0,     1'b1,     1'b1,  2'b00,     1'b1,   1'b0,  7'b0100000, 2'b00,     1'b1};
localparam DEC_STORE   = {1'b0,  2'b00, 1'b0,    1'b1,     1'b0,     1'b0,  2'b00,     1'b1,   1'b0,  7'b0010000, 2'b00,     1'b1};
localparam DEC_ALUI    = {1'b0,  2'b00, 1'b0,    1'b0,     1'b1,     1'b0,  2'b00,     1'b1,   1'b0,  7'b0100000, 2'b01,     1'b1};
localparam DEC_ALUR    = {1'b0,  2'b00, 1'b0,    1'b0,     1'b1,     1'b0,  2'b00,     1'b0,   1'b0,  7'b1000000, 2'b01,     1'b1};

assign  {branch, jump, mem_read, mem_write, reg_write, to_reg, result_sel, alu_src, pc_add, types, alu_ctrlop, valid_inst} = dec_array;


always @(*) begin
  //$write(&quot;%x&quot;, instr);
  case(instr[6:0])
    `OPCODE_LUI    :   dec_array &lt;= DEC_LUI;
    `OPCODE_AUIPC  :   dec_array &lt;= DEC_AUIPC;
    `OPCODE_JAL    :   dec_array &lt;= DEC_JAL;
    `OPCODE_JALR   :   dec_array &lt;= DEC_JALR;
    `OPCODE_BRANCH :   dec_array &lt;= DEC_BRANCH;
    `OPCODE_LOAD   :   dec_array &lt;= DEC_LOAD;
    `OPCODE_STORE  :   dec_array &lt;= DEC_STORE;
    `OPCODE_ALUI   :   dec_array &lt;= DEC_ALUI;
    `OPCODE_ALUR   :   dec_array &lt;= DEC_ALUR;
    default        :  begin
                 dec_array &lt;= DEC_INVALID;
               //  $display(&quot;~~~decode error~~~%x&quot;, instr);
    end
  endcase
end

// -------------------- IMM -------------------------

wire [31:0] Iimm = {{21{instr[31]}}, instr[30:20]};
wire [31:0] Simm = {{21{instr[31]}}, instr[30:25], instr[11:7]};
wire [31:0] Bimm = {{20{instr[31]}}, instr[7], instr[30:25], instr[11:8], 1'b0};
wire [31:0] Uimm = {instr[31:12], 12'b0};
wire [31:0] Jimm = {{12{instr[31]}}, instr[19:12], instr[20], instr[30:21], 1'b0};

assign imm = {32{types[5]}} &amp; Iimm
           | {32{types[4]}} &amp; Simm
           | {32{types[3]}} &amp; Bimm
           | {32{types[2]}} &amp; Uimm
           | {32{types[1]}} &amp; Jimm;

endmodule
</code></pre>
<p>å‰é¢è¯‘ç æ¨¡å—å¾—åˆ°çš„æŒ‡ä»¤ä¿¡å·å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ç±»æ˜¯æŒ‡ä»¤çš„æ“ä½œç ç»è¿‡è¯‘ç åäº§ç”Ÿçš„<strong>æŒ‡ä»¤æ§åˆ¶ä¿¡å·</strong>ï¼Œå¦ä¸€ç±»æ˜¯ä»æŒ‡ä»¤æºç ä¸­æå–å‡ºæ¥çš„<strong>æ•°æ®ä¿¡æ¯</strong>ï¼Œå¦‚ç«‹å³æ•°ã€å¯„å­˜å™¨ç´¢å¼•ã€åŠŸèƒ½ç ç­‰ã€‚ä¸ºäº†èƒ½å¯¹æµæ°´çº¿æ›´å¥½åœ°å®æ–½æ§åˆ¶ï¼Œæˆ‘ä»¬æŠŠè¯‘ç åçš„æ•°æ®å’Œæ§åˆ¶ä¿¡å·åˆ†å¼€å¤„ç†ã€‚</p>
<h3 id="è¯‘ç æ§åˆ¶æ¨¡å—"><a class="header" href="#è¯‘ç æ§åˆ¶æ¨¡å—">è¯‘ç æ§åˆ¶æ¨¡å—</a></h3>
<p>å½“æŒ‡ä»¤å‘ç”Ÿå†²çªæ—¶ï¼Œéœ€è¦å¯¹æµæ°´çº¿è¿›è¡Œå†²åˆ·ï¼Œè¯‘ç é˜¶æ®µçš„æŒ‡ä»¤ä¿¡æ¯ä¹Ÿéœ€è¦æ¸…é™¤ã€‚</p>
<pre><code class="language-Verilog">module id_ex_ctrl (
  input        clk,
  input        reset,
  input        in_ex_ctrl_itype,
  input  [1:0] in_ex_ctrl_alu_ctrlop,
  input  [1:0] in_ex_ctrl_result_sel,
  input        in_ex_ctrl_alu_src,
  input        in_ex_ctrl_pc_add,
  input        in_ex_ctrl_branch,
  input  [1:0] in_ex_ctrl_jump,
  input        in_mem_ctrl_mem_read,
  input        in_mem_ctrl_mem_write,
  input  [1:0] in_mem_ctrl_mask_mode,
  input        in_mem_ctrl_sext,
  input        in_wb_ctrl_to_reg,
  input        in_wb_ctrl_reg_write,
  input        in_noflush,
  input        flush,
  input        valid,
  output       out_ex_ctrl_itype,
  output [1:0] out_ex_ctrl_alu_ctrlop,
  output [1:0] out_ex_ctrl_result_sel,
  output       out_ex_ctrl_alu_src,
  output       out_ex_ctrl_pc_add,
  output       out_ex_ctrl_branch,
  output [1:0] out_ex_ctrl_jump,
  output       out_mem_ctrl_mem_read,
  output       out_mem_ctrl_mem_write,
  output [1:0] out_mem_ctrl_mask_mode,
  output       out_mem_ctrl_sext,
  output       out_wb_ctrl_to_reg,
  output       out_wb_ctrl_reg_write,
  output       out_noflush
);

  reg  reg_ex_ctrl_itype;
  reg [1:0] reg_ex_ctrl_alu_ctrlop;
  reg [1:0] reg_ex_ctrl_result_sel;
  reg  reg_ex_ctrl_alu_src;
  reg  reg_ex_ctrl_pc_add;
  reg  reg_ex_ctrl_branch;
  reg [1:0] reg_ex_ctrl_jump;
  reg  reg_mem_ctrl_mem_read;
  reg  reg_mem_ctrl_mem_write;
  reg [1:0] reg_mem_ctrl_mask_mode;
  reg  reg_mem_ctrl_sext;
  reg  reg_wb_ctrl_to_reg;
  reg  reg_wb_ctrl_reg_write;
  reg  reg_noflush;

  assign out_ex_ctrl_itype = reg_ex_ctrl_itype;
  assign out_ex_ctrl_alu_ctrlop = reg_ex_ctrl_alu_ctrlop;
  assign out_ex_ctrl_result_sel = reg_ex_ctrl_result_sel;
  assign out_ex_ctrl_alu_src = reg_ex_ctrl_alu_src;
  assign out_ex_ctrl_pc_add = reg_ex_ctrl_pc_add;
  assign out_ex_ctrl_branch = reg_ex_ctrl_branch;
  assign out_ex_ctrl_jump = reg_ex_ctrl_jump;
  assign out_mem_ctrl_mem_read = reg_mem_ctrl_mem_read;
  assign out_mem_ctrl_mem_write = reg_mem_ctrl_mem_write;
  assign out_mem_ctrl_mask_mode = reg_mem_ctrl_mask_mode;
  assign out_mem_ctrl_sext = reg_mem_ctrl_sext;
  assign out_wb_ctrl_to_reg = reg_wb_ctrl_to_reg;
  assign out_wb_ctrl_reg_write = reg_wb_ctrl_reg_write;
  assign out_noflush = reg_noflush;

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_ex_ctrl_itype &lt;= 1'h0;
    end else if (flush) begin
      reg_ex_ctrl_itype &lt;= 1'h0;
    end else if (valid) begin
      reg_ex_ctrl_itype &lt;= in_ex_ctrl_itype;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_ex_ctrl_alu_ctrlop &lt;= 2'h0;
    end else if (flush) begin
      reg_ex_ctrl_alu_ctrlop &lt;= 2'h0;
    end else if (valid) begin
      reg_ex_ctrl_alu_ctrlop &lt;= in_ex_ctrl_alu_ctrlop;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_ex_ctrl_result_sel &lt;= 2'h0;
    end else if (flush) begin
      reg_ex_ctrl_result_sel &lt;= 2'h0;
    end else if (valid) begin
      reg_ex_ctrl_result_sel &lt;= in_ex_ctrl_result_sel;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_ex_ctrl_alu_src &lt;= 1'h0;
    end else if (flush) begin
      reg_ex_ctrl_alu_src &lt;= 1'h0;
    end else if (valid) begin
      reg_ex_ctrl_alu_src &lt;= in_ex_ctrl_alu_src;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_ex_ctrl_pc_add &lt;= 1'h0;
    end else if (flush) begin
      reg_ex_ctrl_pc_add &lt;= 1'h0;
    end else if (valid) begin
      reg_ex_ctrl_pc_add &lt;= in_ex_ctrl_pc_add;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_ex_ctrl_branch &lt;= 1'h0;
    end else if (flush) begin
      reg_ex_ctrl_branch &lt;= 1'h0;
    end else if (valid) begin
      reg_ex_ctrl_branch &lt;= in_ex_ctrl_branch;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_ex_ctrl_jump &lt;= 2'h0;
    end else if (flush) begin
      reg_ex_ctrl_jump &lt;= 2'h0;
    end else if (valid) begin
      reg_ex_ctrl_jump &lt;= in_ex_ctrl_jump;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_mem_ctrl_mem_read &lt;= 1'h0;
    end else if (flush) begin
      reg_mem_ctrl_mem_read &lt;= 1'h0;
    end else if (valid) begin
      reg_mem_ctrl_mem_read &lt;= in_mem_ctrl_mem_read;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_mem_ctrl_mem_write &lt;= 1'h0;
    end else if (flush) begin
      reg_mem_ctrl_mem_write &lt;= 1'h0;
    end else if (valid) begin
      reg_mem_ctrl_mem_write &lt;= in_mem_ctrl_mem_write;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_mem_ctrl_mask_mode &lt;= 2'h0;
    end else if (flush) begin
      reg_mem_ctrl_mask_mode &lt;= 2'h0;
    end else if (valid) begin
      reg_mem_ctrl_mask_mode &lt;= in_mem_ctrl_mask_mode;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_mem_ctrl_sext &lt;= 1'h0;
    end else if (flush) begin
      reg_mem_ctrl_sext &lt;= 1'h0;
    end else if (valid) begin
      reg_mem_ctrl_sext &lt;= in_mem_ctrl_sext;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_wb_ctrl_to_reg &lt;= 1'h0;
    end else if (flush) begin
      reg_wb_ctrl_to_reg &lt;= 1'h0;
    end else if (valid) begin
      reg_wb_ctrl_to_reg &lt;= in_wb_ctrl_to_reg;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_wb_ctrl_reg_write &lt;= 1'h0;
    end else if (flush) begin
      reg_wb_ctrl_reg_write &lt;= 1'h0;
    end else if (valid) begin
      reg_wb_ctrl_reg_write &lt;= in_wb_ctrl_reg_write;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_noflush &lt;= 1'h0;
    end else if (flush) begin
      reg_noflush &lt;= 1'h0;
    end else if (valid) begin
      reg_noflush &lt;= in_noflush;
    end
  end


endmodule
</code></pre>
<h3 id="è¯‘ç æ•°æ®é€šè·¯æ¨¡å—"><a class="header" href="#è¯‘ç æ•°æ®é€šè·¯æ¨¡å—">è¯‘ç æ•°æ®é€šè·¯æ¨¡å—</a></h3>
<p>è¯‘ç æ•°æ®é€šè·¯ä¼šæ ¹æ® CPU ç›¸å…³æ§åˆ¶æ¨¡å—äº§ç”Ÿçš„æµæ°´çº¿å†²åˆ·æ§åˆ¶ä¿¡å·ï¼Œå†³å®šè¦ä¸è¦æŠŠè¿™äº›æ•°æ®å‘é€ç»™åç»­æ¨¡å—ã€‚</p>
<pre><code class="language-Verilog">module id_ex (
  input         clk,
  input         reset,
  input  [4:0]  in_rd_addr,
  input  [6:0]  in_funct7,
  input  [2:0]  in_funct3,
  input  [31:0] in_imm,
  input  [31:0] in_rs2_data,
  input  [31:0] in_rs1_data,
  input  [31:0] in_pc,
  input  [4:0]  in_rs1_addr,
  input  [4:0]  in_rs2_addr,
  input         flush,
  input         valid,
  output [4:0]  out_rd_addr,
  output [6:0]  out_funct7,
  output [2:0]  out_funct3,
  output [31:0] out_imm,
  output [31:0] out_rs2_data,
  output [31:0] out_rs1_data,
  output [31:0] out_pc,
  output [4:0]  out_rs1_addr,
  output [4:0]  out_rs2_addr
);
  reg [4:0] reg_rd_addr;
  reg [6:0] reg_funct7;
  reg [2:0] reg_funct3;
  reg [31:0] reg_imm;
  reg [31:0] reg_rs2_data;
  reg [31:0] reg_rs1_data;
  reg [31:0] reg_pc;
  reg [4:0] reg_rs1_addr;
  reg [4:0] reg_rs2_addr;

  assign out_rd_addr = reg_rd_addr;
  assign out_funct7 = reg_funct7;
  assign out_funct3 = reg_funct3;
  assign out_imm = reg_imm;
  assign out_rs2_data = reg_rs2_data;
  assign out_rs1_data = reg_rs1_data;
  assign out_pc = reg_pc;
  assign out_rs1_addr = reg_rs1_addr;
  assign out_rs2_addr = reg_rs2_addr;

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_rd_addr &lt;= 5'h0;
    end else if (flush) begin
      reg_rd_addr &lt;= 5'h0;
    end else if (valid) begin
      reg_rd_addr &lt;= in_rd_addr;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_funct7 &lt;= 7'h0;
    end else if (flush) begin
      reg_funct7 &lt;= 7'h0;
    end else if (valid) begin
      reg_funct7 &lt;= in_funct7;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_funct3 &lt;= 3'h0;
    end else if (flush) begin
      reg_funct3 &lt;= 3'h0;
    end else if (valid) begin
      reg_funct3 &lt;= in_funct3;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_imm &lt;= 32'h0;
    end else if (flush) begin
      reg_imm &lt;= 32'h0;
    end else if (valid) begin
      reg_imm &lt;= in_imm;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_rs2_data &lt;= 32'h0;
    end else if (flush) begin
      reg_rs2_data &lt;= 32'h0;
    end else if (valid) begin
      reg_rs2_data &lt;= in_rs2_data;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_rs1_data &lt;= 32'h0;
    end else if (flush) begin
      reg_rs1_data &lt;= 32'h0;
    end else if (valid) begin
      reg_rs1_data &lt;= in_rs1_data;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_pc &lt;= 32'h0;
    end else if (flush) begin
      reg_pc &lt;= 32'h0;
    end else if (valid) begin
      reg_pc &lt;= in_pc;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_rs1_addr &lt;= 5'h0;
    end else if (flush) begin
      reg_rs1_addr &lt;= 5'h0;
    end else if (valid) begin
      reg_rs1_addr &lt;= in_rs1_addr;
    end
  end

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      reg_rs2_addr &lt;= 5'h0;
    end else if (flush) begin
      reg_rs2_addr &lt;= 5'h0;
    end else if (valid) begin
      reg_rs2_addr &lt;= in_rs2_addr;
    end
  end

endmodule
</code></pre>
<h3 id="æ‰§è¡Œæ§åˆ¶æ¨¡å—"><a class="header" href="#æ‰§è¡Œæ§åˆ¶æ¨¡å—">æ‰§è¡Œæ§åˆ¶æ¨¡å—</a></h3>
<p>åœ¨æŒ‡ä»¤æ‰§è¡Œé˜¶æ®µï¼Œå­˜å‚¨è®¿é—®æŒ‡ä»¤ç”¨ ALU è¿›è¡Œåœ°å€è®¡ç®—ï¼Œæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤ç”¨ ALU è¿›è¡Œæ¡ä»¶æ¯”è¾ƒï¼Œç®—æœ¯é€»è¾‘æŒ‡ä»¤ç”¨ ALU è¿›è¡Œé€»è¾‘è¿ç®—ã€‚</p>
<pre><code class="language-Verilog">module alu_ctrl (
    input [2:0]  funct3,
    input [6:0]  funct7,
    input [1:0]  aluCtrlOp,
    input        itype,
    output reg [3:0] aluOp
);
    always @(*) begin
      case(aluCtrlOp)
        2'b00:  aluOp &lt;= `ALU_OP_ADD;           // Load or Store
        2'b01:  begin
          if(itype &amp; funct3[1:0] != 2'b01)
            aluOp &lt;= {1'b0, funct3};
          else
            aluOp &lt;= {funct7[5], funct3};   // normal ALUI/ALUR
        end
        2'b10:  begin
         // $display(&quot;~~~aluCtrl bxx~~~%d&quot;, funct3);
          case(funct3)                    // bxx
            `BEQ_FUNCT3:  aluOp &lt;= `ALU_OP_EQ;
            `BNE_FUNCT3:  aluOp &lt;= `ALU_OP_NEQ;
            `BLT_FUNCT3:  aluOp &lt;= `ALU_OP_SLT;
            `BGE_FUNCT3:  aluOp &lt;= `ALU_OP_GE;
            `BLTU_FUNCT3: aluOp &lt;= `ALU_OP_SLTU;
            `BGEU_FUNCT3: aluOp &lt;= `ALU_OP_GEU;
            default:      aluOp &lt;= `ALU_OP_XXX;
          endcase
          end
        default: aluOp &lt;= `ALU_OP_XXX;
      endcase
    end
endmodule
</code></pre>
<h3 id="é€šç”¨å¯„å­˜å™¨æ¨¡å—"><a class="header" href="#é€šç”¨å¯„å­˜å™¨æ¨¡å—">é€šç”¨å¯„å­˜å™¨æ¨¡å—</a></h3>
<pre><code class="language-Verilog">module gen_regs (
    input  clk,
    input  reset,
    input  wen,
    input  [4:0] regRAddr1, regRAddr2, regWAddr,
    input  [31:0] regWData,
    output [31:0] regRData1,
    output [31:0] regRData2
);
    integer ii;
    reg [31:0] regs[31:0];

    // write registers
    always @(posedge clk or posedge reset) begin
        if(reset) begin
            for(ii=0; ii&lt;32; ii=ii+1)
                regs[ii] &lt;= 32'b0;
        end
        else if(wen &amp; (|regWAddr))
                regs[regWAddr] &lt;= regWData;
    end

    // read registers
    assign regRData1 = wen &amp; (regWAddr == regRAddr1) ? regWData
                    : ((regRAddr1 != 5'b0) ? regs[regRAddr1] : 32'b0);
    assign regRData2 = wen &amp; (regWAddr == regRAddr2) ? regWData
                    : ((regRAddr2 != 5'b0) ? regs[regRAddr2] : 32'b0);

endmodule
</code></pre>
<p>å†™å¯„å­˜å™¨æ˜¯è¾¹æ²¿è§¦å‘çš„ï¼Œåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…å†™å…¥çš„å­˜å‚¨å™¨æ•°æ®ï¼Œéœ€è¦åœ¨å†™ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸæ‰èƒ½æŠŠå†™å…¥çš„æ•°æ®è¯»å–å‡ºæ¥ã€‚ä¸ºäº†æé«˜è¯»å†™æ•ˆç‡ï¼Œåœ¨å¯¹åŒä¸€ä¸ªå¯„å­˜å™¨è¿›è¡Œè¯»å†™æ—¶ï¼Œå¦‚æœå†™ä½¿èƒ½ wen æœ‰æ•ˆï¼Œå°±ç›´æ¥æŠŠå†™å…¥å¯„å­˜å™¨çš„æ•°æ®é€ç»™è¯»æ•°æ®æ¥å£ã€‚</p>
<h3 id="alu-æ¨¡å—"><a class="header" href="#alu-æ¨¡å—">ALU æ¨¡å—</a></h3>
<pre><code class="language-Verilog">module alu (
  input  [31:0] alu_data1_i,
  input  [31:0] alu_data2_i,
  input  [ 3:0] alu_op_i,
  output [31:0] alu_result_o
);

  reg  [31:0] result;

  // alu_op_i çš„ç¬¬3ä½å’Œç¬¬1ä½ä¸º1æ—¶ï¼Œåšå‡æ³•è¿ç®—ï¼Œè¿™æ˜¯ä¸ºå‡æ³•æŒ‡ä»¤æˆ–è€…æ¯”è¾ƒå¤§å°è€Œå‡†å¤‡çš„
  wire [31:0] sum    = alu_data1_i + ((alu_op_i[3] | alu_op_i[1]) ? -alu_data2_i : alu_data2_i);
  // æ ¹æ®å‰é¢ä¸¤ä¸ªæ“ä½œæ•°ç›¸å‡çš„ç»“æœåˆ¤æ–­ä¸¤ä¸ªæ“ä½œæ•°æ˜¯å¦ç›¸ç­‰
  wire        neq    = |sum;
  // æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°çš„å¤§å°ï¼š
  // å¦‚æœæ“ä½œæ•°çš„ç¬¦å·ä½ç›¸åŒï¼Œåˆ™æ ¹æ®ä¸¤ä¸ªæ“ä½œæ•°ç›¸å‡çš„å·®å€¼çš„ç¬¦å·ä½å»åˆ¤æ–­
  // å¦‚æœæ“ä½œæ•°çš„ç¬¦å·ä½ä¸åŒï¼Œå…ˆæ ¹æ®alu_op_i çš„æœ€ä½ä½åˆ¤æ–­æ˜¯å¦æ˜¯æ— ç¬¦å·æ•°æ¯”è¾ƒè¿ç®—
  wire        cmp    = (alu_data1_i[31] == alu_data2_i[31]) ? sum[31]
                     : alu_op_i[0] ? alu_data2_i[31] : alu_data1_i[31];
  wire [ 4:0] shamt  = alu_data2_i[4:0];
  // åˆ¤æ–­æ˜¯å·¦ç§»è¿˜æ˜¯å³ç§»ï¼Œå¦‚æœæ˜¯å·¦ç§»ï¼Œå°±å…ˆå¯¹æºæ“ä½œæ•°åšé•œåƒå¤„ç†
  wire [31:0] shin   = alu_op_i[2] ? alu_data1_i : reverse(alu_data1_i);
  // åˆ¤æ–­æ˜¯ç®—æœ¯å³ç§»è¿˜æ˜¯é€»è¾‘å³ç§»ï¼Œå¦‚æœæ˜¯ç®—æœ¯å³ç§»ï¼Œéœ€è¦åœ¨æœ€é«˜ä½è¡¥ä¸€ä¸ªç¬¦å·ä½
  wire [32:0] shift  = {alu_op_i[3] &amp; shin[31], shin};
  // $signed() å‡½æ•°ä¼šåœ¨å³ç§»æ“ä½œå‰å…ˆæŠŠæ“ä½œæ•°çš„ç¬¦å·ä½æ‰©ä½æˆè·Ÿç»“æœç›¸åŒçš„ä½å®½
  wire [32:0] shiftt = ($signed(shift) &gt;&gt;&gt; shamt);
  wire [31:0] shiftr = shiftt[31:0];
  // å·¦ç§»çš„ç»“æœæ˜¯å³ç§»åçš„ç»“æœå†è¿›è¡Œé•œåƒå¤„ç†
  wire [31:0] shiftl = reverse(shiftr);

  always @(*) begin
    case(alu_op_i)
      `ALU_OP_ADD:    result &lt;= sum;
      `ALU_OP_SUB:    result &lt;= sum;
      `ALU_OP_SLL:    result &lt;= shiftl;
      `ALU_OP_SLT:    result &lt;= cmp;
      `ALU_OP_SLTU:   result &lt;= cmp;
      `ALU_OP_XOR:    result &lt;= (alu_data1_i ^ alu_data2_i);
      `ALU_OP_SRL:    result &lt;= shiftr;
      `ALU_OP_SRA:    result &lt;= shiftr;
      `ALU_OP_OR:     result &lt;= (alu_data1_i | alu_data2_i);
      `ALU_OP_AND:    result &lt;= (alu_data1_i &amp; alu_data2_i);

      `ALU_OP_EQ:     result &lt;= {31'b0, ~neq};
      `ALU_OP_NEQ:    result &lt;= {31'b0, neq};
      `ALU_OP_GE:     result &lt;= {31'b0, ~cmp};
      `ALU_OP_GEU:    result &lt;= {31'b0, ~cmp};
      default:        begin
                      result &lt;= 32'b0;
                      //$display(&quot;*** alu error ! ***%x&quot;, alu_op_i);
        end
    endcase
  end

  function [31:0] reverse;
    input [31:0] in;
    integer i;
    for(i=0; i&lt;32; i=i+1) begin
      reverse[i] = in[31-i];
    end
  endfunction

  assign alu_result_o = result;

endmodule
</code></pre>
<ul>
<li>å·¦ç§»è¿ç®—å¤ç”¨äº†å³ç§»è¿ç®—çš„ç”µè·¯ï¼Œæ–¹ä¾¿å®ç°</li>
</ul>
<h3 id="å®Œæ•´çš„æ•°æ®é€šè·¯"><a class="header" href="#å®Œæ•´çš„æ•°æ®é€šè·¯">å®Œæ•´çš„æ•°æ®é€šè·¯</a></h3>
<p><img src="../images/risc-v/riscv_full_data_path.png" alt="å®Œæ•´çš„æ•°æ®é€šè·¯" /></p>
<ul>
<li>è¯‘ç é˜¶æ®µï¼Œä¼šå°†æŒ‡ä»¤çš„åŠŸèƒ½ç å’Œæ“ä½œç å‘é€ç»™<strong>æ§åˆ¶å™¨</strong>ï¼Œæ¥äº§ç”Ÿç›¸åº”çš„æ§åˆ¶ä¿¡å·</li>
<li>ç«‹å³æ•°æ‰©å±•ä¿¡å·ï¼šImmSel</li>
<li>ALU åŠŸèƒ½é€‰æ‹©ä¿¡å·ï¼šALUSel</li>
</ul>
<h3 id="æ§åˆ¶å™¨çš„è®¾è®¡"><a class="header" href="#æ§åˆ¶å™¨çš„è®¾è®¡">æ§åˆ¶å™¨çš„è®¾è®¡</a></h3>
<p><img src="../images/risc-v/riscv_cpu_controller_truth_table.png" alt="æ§åˆ¶å™¨çš„è®¾è®¡" /></p>
<h3 id="r-å‹æŒ‡ä»¤æ•°æ®é€šè·¯"><a class="header" href="#r-å‹æŒ‡ä»¤æ•°æ®é€šè·¯">R å‹æŒ‡ä»¤æ•°æ®é€šè·¯</a></h3>
<p><img src="../images/risc-v/riscv_R_instruction_data_path.png" alt="Rå‹æŒ‡ä»¤æ•°æ®é€šè·¯" /></p>
<ul>
<li><code>ALUSel</code> ä¼šæ ¹æ®æŒ‡ä»¤çš„ <code>funct3</code>æ¥å–ä¸åŒçš„å€¼</li>
</ul>
<h3 id="i-å‹æŒ‡ä»¤æ•°æ®é€šè·¯"><a class="header" href="#i-å‹æŒ‡ä»¤æ•°æ®é€šè·¯">I å‹æŒ‡ä»¤æ•°æ®é€šè·¯</a></h3>
<p><img src="../images/risc-v/riscv_I_instruction_data_path.png" alt="Iå‹æŒ‡ä»¤æ•°æ®é€šè·¯" /></p>
<h3 id="load-æŒ‡ä»¤æ•°æ®é€šè·¯"><a class="header" href="#load-æŒ‡ä»¤æ•°æ®é€šè·¯">Load æŒ‡ä»¤æ•°æ®é€šè·¯</a></h3>
<p><img src="../images/risc-v/riscv_load_instruction_data_path.png" alt="LoadæŒ‡ä»¤æ•°æ®é€šè·¯" /></p>
<h3 id="store-æŒ‡ä»¤æ•°æ®é€šè·¯"><a class="header" href="#store-æŒ‡ä»¤æ•°æ®é€šè·¯">Store æŒ‡ä»¤æ•°æ®é€šè·¯</a></h3>
<p><img src="../images/risc-v/riscv_store_instruction_data_path.png" alt="StoreæŒ‡ä»¤æ•°æ®é€šè·¯" /></p>
<ul>
<li>ç«‹å³æ•°æ¥è‡ª<code>inst[31:25][11:7]</code>ï¼Œè¿™ä¸ªå’ŒLoadä¸åŒ</li>
<li>StoreæŒ‡ä»¤æ²¡æœ‰<strong>å†™å›</strong>é˜¶æ®µ</li>
</ul>
<h3 id="b-å‹æŒ‡ä»¤æ•°æ®é€šè·¯"><a class="header" href="#b-å‹æŒ‡ä»¤æ•°æ®é€šè·¯">B å‹æŒ‡ä»¤æ•°æ®é€šè·¯</a></h3>
<p><img src="../images/risc-v/riscv_B_instruction_data_path.png" alt="BæŒ‡ä»¤æ•°æ®é€šè·¯" /></p>
<ul>
<li>æ— <strong>è®¿å­˜</strong>å’Œ<strong>å†™å›</strong>é˜¶æ®µ</li>
</ul>
<h3 id="jalr-æŒ‡ä»¤æ•°æ®é€šè·¯"><a class="header" href="#jalr-æŒ‡ä»¤æ•°æ®é€šè·¯">jalr æŒ‡ä»¤æ•°æ®é€šè·¯</a></h3>
<p><img src="../images/risc-v/riscv_jalr_instruction_data_path.png" alt="jalræŒ‡ä»¤æ•°æ®é€šè·¯" /></p>
<ul>
<li>PC+4 çš„å€¼ä¼šä¿å­˜åˆ°<code>rd</code> ä¸­</li>
</ul>
<h3 id="jal-æŒ‡ä»¤æ•°æ®é€šè·¯"><a class="header" href="#jal-æŒ‡ä»¤æ•°æ®é€šè·¯">jal æŒ‡ä»¤æ•°æ®é€šè·¯</a></h3>
<p><img src="../images/risc-v/riscv_jal_instruction_data_path.png" alt="jalæŒ‡ä»¤æ•°æ®é€šè·¯" /></p>
<h2 id="cache"><a class="header" href="#cache">Cache</a></h2>
<p><img src="../images/risc-v/riscv_cache.png" alt="Cache" /></p>
<h3 id="cache-çš„ç»“æ„"><a class="header" href="#cache-çš„ç»“æ„">Cache çš„ç»“æ„</a></h3>
<p><img src="../images/risc-v/riscv_cache_structure.png" alt="Cacheçš„ç»“æ„" /></p>
<ul>
<li>å—ï¼ˆblockï¼‰ï¼šä¸¤çº§å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ä¸­å­˜å‚¨å™¨ä¿¡æ¯äº¤æ¢çš„æœ€å°å•å…ƒ</li>
<li>å‘½ä¸­ï¼ˆhitï¼‰ï¼šå¦‚æœå¤„ç†å™¨éœ€è¦çš„æ•°æ®å­˜æ”¾åœ¨é«˜å±‚å­˜å‚¨å™¨ä¸­çš„æŸä¸ªå—ä¸­ï¼Œç§°ä¸ºä¸€æ¬¡å‘½ä¸­</li>
<li>ç¼ºå¤±ï¼ˆmissï¼‰ï¼šå¦‚æœåœ¨é«˜å±‚å­˜å‚¨å™¨ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„æ•°æ®ï¼Œè¿™æ¬¡æ•°æ®è¯·æ±‚ç§°ä¸ºä¸€æ¬¡ç¼ºå¤±
<ul>
<li>ç¼ºå¤±ä»£ä»·ï¼ˆmiss penaltyï¼‰ï¼šå°†ç›¸åº”çš„å—ä»åº•å±‚å­˜å‚¨å™¨æ›¿æ¢åˆ°é«˜å±‚å­˜å‚¨å™¨çš„æ—¶é—´+å°†è¯¥ä¿¡æ¯å—ä¼ é€ç»™å¤„ç†å™¨çš„æ—¶é—´</li>
</ul>
</li>
</ul>
<h3 id="cache-ç›´æ¥æ˜ å°„"><a class="header" href="#cache-ç›´æ¥æ˜ å°„">Cache ç›´æ¥æ˜ å°„</a></h3>
<p>ç›´æ¥æ˜ å°„ï¼šä¸€ç§ cache ç»“æ„ï¼Œå…¶ä¸­æ¯ä¸ªå­˜å‚¨å™¨åœ°å€ä»…ä»…å¯¹åº”åˆ° cache ä¸­çš„ä¸€ä¸ªä½ç½®</p>
<p>æ˜ å°„æ–¹æ³•ï¼šï¼ˆå—åœ°å€ï¼‰modï¼ˆcache ä¸­çš„å—æ•°ï¼‰</p>
<p>æ ‡è®°ï¼šè¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µï¼ŒåŒ…å«äº†åœ°å€ä¿¡æ¯ï¼Œè¿™äº›åœ°å€ä¿¡æ¯å¯ä»¥ç”¨æ¥åˆ¤æ–­cacheä¸­çš„å­—æ˜¯å¦å°±æ˜¯æ‰€è¯·æ±‚çš„å­—</p>
<p>æœ‰æ•ˆä½ï¼šè¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥æ ‡è¯†ä¸€ä¸ªå—æ˜¯å¦åŒ…å«æœ‰ä¸€ä¸ªæœ‰æ•ˆæ•°æ®</p>
<p><img src="../images/risc-v/riscv_cache_direct_mapping.png" alt="Cacheç›´æ¥æ˜ å°„" /></p>
<p><img src="../images/risc-v/riscv_cache_direct_mapping_example.png" alt="Cacheç›´æ¥æ˜ å°„ç¤ºä¾‹" /></p>
<p>ç¼ºç‚¹ï¼šåˆ©ç”¨ç‡ä½ï¼Œå‘½ä¸­ç‡ä½</p>
<h3 id="cache-å…¨ç›¸è”æ˜ å°„"><a class="header" href="#cache-å…¨ç›¸è”æ˜ å°„">Cache å…¨ç›¸è”æ˜ å°„</a></h3>
<p>å…¨ç›¸è”æ˜ å°„ï¼šä¸€ä¸ªå—å¯ä»¥è¢«æ”¾ç½®åœ¨ cache ä¸­çš„ä»»ä½•ä½ç½®</p>
<p><img src="../images/risc-v/riscv_cache_full_association_mapping.png" alt="Cacheå…¨ç›¸è”æ˜ å°„" /></p>
<p><img src="../images/risc-v/riscv_cache_full_association_mapping_example.png" alt="Cacheå…¨ç›¸è”æ˜ å°„ç¤ºä¾‹" /></p>
<p>ç¼ºç‚¹ï¼šç¡¬ä»¶å¼€é”€å¤§ï¼ˆæœ‰å¤šå°‘cacheå—å°±é…æœ‰ç›¸ç­‰æ•°é‡çš„æ¯”è¾ƒå™¨ï¼‰</p>
<h3 id="cache-ç»„ç›¸è”æ˜ å°„"><a class="header" href="#cache-ç»„ç›¸è”æ˜ å°„">Cache ç»„ç›¸è”æ˜ å°„</a></h3>
<p>åœ¨ç»„ç›¸è”æ˜ å°„ä¸­ï¼Œæ¯ä¸ªå—å¯è¢«æ”¾ç½®çš„ä½ç½®æ•°æ˜¯å›ºå®šçš„ï¼Œæ¯ä¸ªå—æœ‰ n ä¸ªä½ç½®å¯æ”¾çš„ cache è¢«ç§°ä¸º n è·¯ç»„ç›¸è” Cache</p>
<p><img src="../images/risc-v/riscv_set_associative_cache.png" alt="Cacheç»„ç›¸è”æ˜ å°„" /></p>
<p><img src="../images/risc-v/riscv_set_associative_cache_example.png" alt="Cacheç»„ç›¸è”æ˜ å°„ç¤ºä¾‹" /></p>
<p>å››è·¯ç»„ç›¸è” Cacheï¼š</p>
<ul>
<li>4 ä¸ªæ¯”è¾ƒå™¨</li>
<li>1 ä¸ªå››é€‰ä¸€å¤šè·¯é€‰æ‹©å™¨</li>
</ul>
<h3 id="cache-çš„è®¾è®¡"><a class="header" href="#cache-çš„è®¾è®¡">Cache çš„è®¾è®¡</a></h3>
<ul>
<li>è¦è€ƒè™‘çš„ç»´åº¦
<ul>
<li>Cache çš„å®¹é‡</li>
<li>å—å¤§å°</li>
<li>ç»„ç»‡æ–¹å¼ï¼ˆDirectï¼ŒFully Associativeï¼ŒSet Associativeï¼‰</li>
<li>æ›¿æ¢ç®—æ³•ï¼ˆFIFOï¼ŒLRUï¼‰</li>
<li>å†™ç­–ç•¥ï¼ˆwrite-through, write-backï¼‰</li>
</ul>
</li>
</ul>
<h2 id="è™šæ‹Ÿåœ°å€"><a class="header" href="#è™šæ‹Ÿåœ°å€">è™šæ‹Ÿåœ°å€</a></h2>
<p><img src="../images/risc-v/riscv_mmu.png" alt="è™šæ‹Ÿå­˜å‚¨å™¨ç®¡ç†" /></p>
<h3 id="åˆ†æ®µç®¡ç†"><a class="header" href="#åˆ†æ®µç®¡ç†">åˆ†æ®µç®¡ç†</a></h3>
<p><img src="../images/risc-v/riscv_mmu_segment_manage.png" alt="åˆ†æ®µç®¡ç†" /></p>
<p>åˆ†æ®µç®¡ç†ï¼šå°†ä¸€ä¸ªç¨‹åºæŒ‰ç…§é€»è¾‘å•å…ƒåˆ†æˆå¤šä¸ªç¨‹åºæ®µï¼Œæ¯ä¸€ä¸ªæ®µä½¿ç”¨è‡ªå·±å•ç‹¬çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚</p>
<ul>
<li>é€»è¾‘ä¸Šç›¸äº’ç‹¬ç«‹</li>
<li>å®¹æ˜“å®ç°å…±äº«å’Œä¿æŠ¤</li>
<li>éå¸¸å®¹æ˜“äº§ç”Ÿç¢ç‰‡ï¼ˆæ®µé•¿æ˜¯ä¸ç¡®å®šçš„ï¼‰</li>
</ul>
<h3 id="åˆ†é¡µç®¡ç†"><a class="header" href="#åˆ†é¡µç®¡ç†">åˆ†é¡µç®¡ç†</a></h3>
<p><img src="../images/risc-v/riscv_mmu_page_manage.png" alt="åˆ†é¡µç®¡ç†" /></p>
<ul>
<li>å¦‚æœé¡µè¡¨é¡¹ä¸º4å­—èŠ‚ï¼Œé‚£ä¹ˆæ•´å¼ é¡µè¡¨ä¼šå æ®4MBå¤§å°çš„å†…å­˜ç©ºé—´</li>
</ul>
<h3 id="ä¸¤çº§åˆ†é¡µç®¡ç†"><a class="header" href="#ä¸¤çº§åˆ†é¡µç®¡ç†">ä¸¤çº§åˆ†é¡µç®¡ç†</a></h3>
<p><img src="../images/risc-v/riscv_mmu_two_level_page_manage.png" alt="ä¸¤çº§åˆ†é¡µç®¡ç†" /></p>
<ul>
<li>4KBçš„é¡µç›®å½•+4KBçš„é¡µè¡¨</li>
</ul>
<h3 id="å¿«é€Ÿåœ°å€è½¬æ¢-tlb"><a class="header" href="#å¿«é€Ÿåœ°å€è½¬æ¢-tlb">å¿«é€Ÿåœ°å€è½¬æ¢ TLB</a></h3>
<p><img src="../images/risc-v/riscv_tlb.png" alt="å—è¡¨" /></p>
<p>å—è¡¨ï¼ˆTranslation-Lookaside Bufferï¼‰ï¼šç”¨äºè®°å½•æœ€è¿‘ä½¿ç”¨åœ°å€çš„æ˜ å°„ä¿¡æ¯çš„é«˜é€Ÿç¼“å­˜ï¼Œä»è€Œå¯ä»¥é¿å…æ¯æ¬¡éƒ½è¦è®¿é—®é¡µè¡¨</p>
<h3 id="ä½¿ç”¨-tlb-è¿›è¡Œåœ°å€è½¬æ¢"><a class="header" href="#ä½¿ç”¨-tlb-è¿›è¡Œåœ°å€è½¬æ¢">ä½¿ç”¨ TLB è¿›è¡Œåœ°å€è½¬æ¢</a></h3>
<p><img src="../images/risc-v/riscv_tlb_location.png" alt="TLBçš„ä½ç½®" /></p>
<p><img src="../images/risc-v/riscv_tlb_translation.png" alt="TLBå®ç°åœ°å€è½¬æ¢çš„åŸç†" /></p>
<p><img src="../images/risc-v/riscv_vma_pma_translation.png" alt="TLBè™šå®åœ°å€è½¬æ¢" /></p>
<h2 id="ç‰¹æƒçº§åˆ«"><a class="header" href="#ç‰¹æƒçº§åˆ«">ç‰¹æƒçº§åˆ«</a></h2>
<p>ä¸€ä¸ª RISC-V çš„ç¡¬ä»¶çº¿ç¨‹åœ¨ä»»ä¸€æ—¶åˆ»åªèƒ½è¿è¡Œåœ¨æŸä¸€ä¸ªç‰¹æƒçº§ä¸Šï¼Œè¿™ä¸ªç‰¹æƒçº§ç”± CSR æŒ‡å®šå’Œé…ç½®ã€‚</p>
<div class="table-wrapper"><table><thead><tr><th>åç§°</th><th>çº§åˆ«</th><th>ç¼©å†™</th><th>ç¼–ç </th><th>è¯´æ˜</th></tr></thead><tbody>
<tr><td>ç”¨æˆ·åº”ç”¨ç¨‹åºç‰¹æƒçº§</td><td>0</td><td>U</td><td>00</td><td>è¿è¡Œåº”ç”¨ç¨‹åºï¼ŒåŒæ ·ä¹Ÿé€‚ç”¨äºåµŒå…¥å¼ç³»ç»Ÿ</td></tr>
<tr><td>ç®¡ç†å‘˜ç‰¹æƒçº§</td><td>1</td><td>S</td><td>01</td><td>ä¸»è¦ç”¨äºæ”¯æŒç°ä»£æ“ä½œç³»ç»Ÿï¼Œå¦‚Linux</td></tr>
<tr><td>è™šæ‹Ÿæœºç›‘è§†ç‰¹æƒçº§</td><td>2</td><td>H</td><td>10</td><td>æ”¯æŒè™šæ‹Ÿæœºç›‘è§†å™¨</td></tr>
<tr><td>æœºå™¨ç‰¹æƒçº§</td><td>3</td><td>M</td><td>11</td><td>å¯¹å†…å­˜ã€I/Oå’Œä¸€äº›å¿…è¦çš„åº•å±‚åŠŸèƒ½ï¼ˆå¯åŠ¨å’Œç³»ç»Ÿé…ç½®ï¼‰æœ‰ç€å®Œå…¨çš„æ§åˆ¶æƒ</td></tr>
</tbody></table>
</div>
<h3 id="æ ‡å‡†å¯„å­˜å™¨åˆ—è¡¨"><a class="header" href="#æ ‡å‡†å¯„å­˜å™¨åˆ—è¡¨">æ ‡å‡†å¯„å­˜å™¨åˆ—è¡¨</a></h3>
<h4 id="machine-mode"><a class="header" href="#machine-mode">Machine Mode</a></h4>
<div class="table-wrapper"><table><thead><tr><th>åç§°</th><th>åœ°å€</th><th>å±æ€§</th><th>å¤‡æ³¨</th></tr></thead><tbody>
<tr><td>mvendorid</td><td>0xF11</td><td>RO</td><td>å•†ä¸šä¾›åº”å•†ç¼–å·å¯„å­˜å™¨</td></tr>
<tr><td>marchid</td><td>0xF12</td><td>RO</td><td>æ¶æ„ç¼–å·å¯„å­˜å™¨</td></tr>
<tr><td>mimpid</td><td>0xF13</td><td>RO</td><td>ç¡¬ä»¶å®ç°ç¼–å·å¯„å­˜å™¨</td></tr>
<tr><td>mhartid</td><td>0xF14</td><td>RO</td><td>Hartç¼–å·å¯„å­˜å™¨ (Hart: Hardware Thread)</td></tr>
<tr><td>mstatus</td><td>0x300</td><td>RW</td><td>å¼‚å¸¸å¤„ç†çŠ¶æ€å¯„å­˜å™¨</td></tr>
<tr><td>misa</td><td>0x301</td><td>RO</td><td>æŒ‡ä»¤é›†æ¶æ„å¯„å­˜å™¨</td></tr>
<tr><td>mie</td><td>0x304</td><td>RW</td><td>å±€éƒ¨ä¸­æ–­å±è”½æ§åˆ¶å¯„å­˜å™¨</td></tr>
<tr><td>mtvec</td><td>0x305</td><td>RW</td><td>å¼‚å¸¸å…¥å£åŸºåœ°å€å¯„å­˜å™¨</td></tr>
<tr><td>mtvt</td><td>0x307</td><td>RW</td><td>ä¸­æ–­å‘é‡è¡¨çš„åŸºåœ°å€ï¼Œè‡³å°‘ä¸º <strong>64byte</strong> å¯¹é½</td></tr>
<tr><td>mscratch</td><td>0x340</td><td>RW</td><td>æš‚å­˜å¯„å­˜å™¨ï¼Œæ¯”å¦‚è¿›å…¥å¼‚å¸¸å¤„ç†æ¨¡å¼åï¼Œå°†åº”ç”¨ç¨‹åºçš„ç”¨æˆ·çš„ sp å¯„å­˜å™¨ä¸´æ—¶ä¿å­˜åˆ°è¿™ä¸ªå¯„å­˜å™¨ä¸­</td></tr>
<tr><td>mepc</td><td>0x341</td><td>RW</td><td>å¼‚å¸¸PCå¯„å­˜å™¨</td></tr>
<tr><td>mcause</td><td>0x342</td><td>RW</td><td>å¼‚å¸¸åŸå› å¯„å­˜å™¨</td></tr>
<tr><td>mtval</td><td>0x343</td><td>RW</td><td>å¼‚å¸¸å€¼å¯„å­˜å™¨ï¼Œä¿å­˜è¿›å…¥å¼‚å¸¸ä¹‹å‰å‡ºé”™æŒ‡ä»¤çš„ç¼–ç å€¼æˆ–è€…å­˜å‚¨å™¨è®¿é—®çš„åœ°å€å€¼</td></tr>
<tr><td>mip</td><td>0x344</td><td>RW</td><td>ä¸­æ–­ç­‰å¾…å¯„å­˜å™¨</td></tr>
<tr><td>mnxti</td><td>0x345</td><td>RW</td><td>è¯»æ“ä½œè¿”å›å€¼æ˜¯ä¸‹ä¸€ä¸ªä¸­æ–­çš„handleråœ°å€ï¼Œå†™å›æ“ä½œä¼šæ›´æ–°ä¸­æ–­ä½¿èƒ½çš„çŠ¶æ€</td></tr>
<tr><td>mintstatus</td><td>0x346</td><td>RO</td><td>ç”¨äºä¿å­˜å½“å‰ä¸­æ–­ Level</td></tr>
<tr><td>mscratchcsw</td><td>0x348</td><td>RW</td><td>ç”¨äºåœ¨ç‰¹æƒæ¨¡å¼å˜åŒ–æ—¶äº¤æ¢mscratchä¸ç›®çš„å¯„å­˜å™¨çš„å€¼</td></tr>
<tr><td>mscratchcswl</td><td>0x349</td><td>RW</td><td>ç”¨äºåœ¨ä¸­æ–­Levelå˜åŒ–æ—¶äº¤æ¢mscratchä¸ç›®çš„å¯„å­˜å™¨çš„å€¼</td></tr>
<tr><td>mcycle</td><td>0xB00</td><td>RW</td><td>å‘¨æœŸè®¡æ•°å™¨çš„ä½32ä½</td></tr>
<tr><td>mcycleh</td><td>0xB80</td><td>RW</td><td>å‘¨æœŸè®¡æ•°å™¨çš„é«˜32ä½</td></tr>
<tr><td>minstret</td><td>0xB02</td><td>RW</td><td>å®ŒæˆæŒ‡ä»¤è®¡æ•°å™¨çš„ä½32ä½ï¼Œè¯¥å¯„å­˜å™¨ç”¨äºè¡¡é‡å¤„ç†å™¨çš„æ€§èƒ½</td></tr>
<tr><td>minstrech</td><td>0xB82</td><td>RW</td><td>å®ŒæˆæŒ‡ä»¤è®¡æ•°å™¨çš„é«˜32ä½</td></tr>
</tbody></table>
</div>
<h4 id="user-mode"><a class="header" href="#user-mode">User Mode</a></h4>
<div class="table-wrapper"><table><thead><tr><th>åç§°</th><th>åœ°å€</th><th>å±æ€§</th><th>å¤‡æ³¨</th></tr></thead><tbody>
<tr><td>cycle</td><td>0xC00</td><td>RO</td><td>mcycleå¯„å­˜å™¨çš„åªè¯»å‰¯æœ¬</td></tr>
<tr><td>time</td><td>0xC01</td><td>RO</td><td>mtimeå¯„å­˜å™¨çš„åªè¯»å‰¯æœ¬</td></tr>
<tr><td>instret</td><td>0xC02</td><td>RO</td><td>minstretå¯„å­˜å™¨çš„åªè¯»å‰¯æœ¬</td></tr>
<tr><td>cycleh</td><td>0xC80</td><td>RO</td><td>mcyclehå¯„å­˜å™¨çš„åªè¯»å‰¯æœ¬</td></tr>
<tr><td>timeh</td><td>0xC81</td><td>RO</td><td>mtimehå¯„å­˜å™¨çš„åªè¯»å‰¯æœ¬</td></tr>
<tr><td>instreth</td><td>0xC82</td><td>RO</td><td>minstrethå¯„å­˜å™¨çš„åªè¯»å‰¯æœ¬</td></tr>
</tbody></table>
</div>
<h2 id="risc-v-çš„ä¸­æ–­"><a class="header" href="#risc-v-çš„ä¸­æ–­">RISC-V çš„ä¸­æ–­</a></h2>
<p><img src="../images/risc-v/riscv_interrupt_enter.png" alt="è¿›å…¥ä¸­æ–­" /></p>
<p><img src="../images/risc-v/riscv_interrupt_exit.png" alt="é€€å‡ºä¸­æ–­" /></p>
<h3 id="ä¸­æ–­å’Œå¼‚å¸¸ç›¸å…³çš„å¯„å­˜å™¨"><a class="header" href="#ä¸­æ–­å’Œå¼‚å¸¸ç›¸å…³çš„å¯„å­˜å™¨">ä¸­æ–­å’Œå¼‚å¸¸ç›¸å…³çš„å¯„å­˜å™¨</a></h3>
<p><img src="../images/risc-v/riscv_exception_csr_registers.png" alt="å¼‚å¸¸ç›¸å…³çš„CSRå¯„å­˜å™¨" /></p>
<p><img src="../images/risc-v/riscv_exception_csr_register_definitions.png" alt="å¼‚å¸¸ç›¸å…³çš„CSRå¯„å­˜å™¨å…·ä½“å®šä¹‰" /></p>
<h3 id="mstatus"><a class="header" href="#mstatus">mstatus</a></h3>
<ul>
<li>MIEï¼šä¸º1è¡¨ç¤ºä¸­æ–­çš„å…¨å±€å¼€å…³æ‰“å¼€ï¼Œä¸­æ–­èƒ½å¤Ÿè¢«æ­£å¸¸å“åº”</li>
<li>FSï¼šç»´æŠ¤æµ®ç‚¹å•å…ƒçš„çŠ¶æ€ã€‚ä¸Šç”µé»˜è®¤ä¸º0,è¡¨ç¤ºOffï¼Œä¸ºäº†èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨æµ®ç‚¹å•å…ƒï¼Œè½¯ä»¶éœ€è¦ä½¿ç”¨ CSR å†™æŒ‡ä»¤å°† FS çš„å€¼æ”¹å†™ä¸ºé 0 å€¼ä»¥æ‰“å¼€æµ®ç‚¹å•å…ƒçš„åŠŸèƒ½ã€‚æ“ä½œç³»ç»Ÿåœ¨è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡è¯¥å€¼æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦å¯¹æµ®ç‚¹å•å…ƒè¿›è¡Œä¸Šä¸‹æ–‡çš„ä¿å­˜</li>
<li>XSï¼šç»´æŠ¤ç”¨æˆ·è‡ªå®šä¹‰çš„æ‰©å±•æŒ‡ä»¤å•å…ƒçŠ¶æ€ï¼Œç±»ä¼¼ä¸ FS</li>
</ul>
<h3 id="mtvec"><a class="header" href="#mtvec">mtvec</a></h3>
<p><img src="../images/risc-v/riscv_exception_mtvec_register.png" alt="mtvecå¯„å­˜å™¨" /></p>
<h3 id="å¼‚å¸¸ä»£ç "><a class="header" href="#å¼‚å¸¸ä»£ç ">å¼‚å¸¸ä»£ç </a></h3>
<p><img src="../images/risc-v/riscv_machine_exception_codes.png" alt="å¼‚å¸¸ä»£ç " /></p>
<h3 id="ä¸­æ–­è¿”å›"><a class="header" href="#ä¸­æ–­è¿”å›">ä¸­æ–­è¿”å›</a></h3>
<p><img src="../images/risc-v/riscv_exception_return.png" alt="ä¸­æ–­è¿”å›" /></p>
<h3 id="ä¸­æ–­å±è”½ä¸ä¸­æ–­ç­‰å¾…"><a class="header" href="#ä¸­æ–­å±è”½ä¸ä¸­æ–­ç­‰å¾…">ä¸­æ–­å±è”½ä¸ä¸­æ–­ç­‰å¾…</a></h3>
<p><img src="../images/risc-v/riscv_interrupt_enable_pending.png" alt="ä¸­æ–­å±è”½å’Œç­‰å¾…ç›¸å…³é¢å¯„å­˜å™¨" /></p>
<h3 id="ä¸­æ–­ä¼˜å…ˆçº§"><a class="header" href="#ä¸­æ–­ä¼˜å…ˆçº§">ä¸­æ–­ä¼˜å…ˆçº§</a></h3>
<p><img src="../images/risc-v/riscv_interrupt_priority.png" alt="ä¸­æ–­ä¼˜å…ˆçº§" /></p>
<h3 id="å•æŒ‡ä»¤æ•°æ®é€šè·¯çš„ä¸­æ–­å“åº”ä¸é€€å‡º"><a class="header" href="#å•æŒ‡ä»¤æ•°æ®é€šè·¯çš„ä¸­æ–­å“åº”ä¸é€€å‡º">å•æŒ‡ä»¤æ•°æ®é€šè·¯çš„ä¸­æ–­å“åº”ä¸é€€å‡º</a></h3>
<p><img src="../images/risc-v/riscv_one_cycle_intruction_interrupt_enter.png" alt="ä¸­æ–­å“åº”" /></p>
<p><img src="../images/risc-v/riscv_one_cycle_intruction_interrupt_exit.png" alt="ä¸­æ–­é€€å‡º" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../about-me.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../cs/gcc-toolchains.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../about-me.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../cs/gcc-toolchains.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_line_numbers = true;
        </script>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>suda-morris ä¸ªäººåšå®¢</title>
    <meta name="description" content="è®°å½•å­¦ä¹ ç”Ÿæ´»ï¼Œæ¢ç´¢æœªçŸ¥é¢†åŸŸ">
    <link rel="icon" href="/blog/favicon.png">
  <link rel="manifest" href="/blog/manifest.json">
    
    <link rel="preload" href="/blog/assets/css/0.styles.aea52b3d.css" as="style"><link rel="preload" href="/blog/assets/js/app.4f851d87.js" as="script"><link rel="preload" href="/blog/assets/js/2.4a73e09d.js" as="script"><link rel="preload" href="/blog/assets/js/42.d8d152e7.js" as="script"><link rel="preload" href="/blog/assets/js/3.b11672f7.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.7c5a0e0a.js"><link rel="prefetch" href="/blog/assets/js/11.a452eadb.js"><link rel="prefetch" href="/blog/assets/js/12.eafb2f27.js"><link rel="prefetch" href="/blog/assets/js/13.97e9cf91.js"><link rel="prefetch" href="/blog/assets/js/14.7c716bac.js"><link rel="prefetch" href="/blog/assets/js/15.9df65885.js"><link rel="prefetch" href="/blog/assets/js/16.14c13aa7.js"><link rel="prefetch" href="/blog/assets/js/17.64f168e6.js"><link rel="prefetch" href="/blog/assets/js/18.a4a6131f.js"><link rel="prefetch" href="/blog/assets/js/19.63e41b50.js"><link rel="prefetch" href="/blog/assets/js/20.a8acc48c.js"><link rel="prefetch" href="/blog/assets/js/21.e9d74a75.js"><link rel="prefetch" href="/blog/assets/js/22.1d1b0861.js"><link rel="prefetch" href="/blog/assets/js/23.60e2ca35.js"><link rel="prefetch" href="/blog/assets/js/24.b2f0fb97.js"><link rel="prefetch" href="/blog/assets/js/25.a341545f.js"><link rel="prefetch" href="/blog/assets/js/26.34d6247d.js"><link rel="prefetch" href="/blog/assets/js/27.0b0ef00c.js"><link rel="prefetch" href="/blog/assets/js/28.f195fcbd.js"><link rel="prefetch" href="/blog/assets/js/29.5617b2e3.js"><link rel="prefetch" href="/blog/assets/js/30.e8ac104a.js"><link rel="prefetch" href="/blog/assets/js/31.594ebd8d.js"><link rel="prefetch" href="/blog/assets/js/32.e1b42b06.js"><link rel="prefetch" href="/blog/assets/js/33.08d00d32.js"><link rel="prefetch" href="/blog/assets/js/34.1fa7fd87.js"><link rel="prefetch" href="/blog/assets/js/35.de170958.js"><link rel="prefetch" href="/blog/assets/js/36.e42233c4.js"><link rel="prefetch" href="/blog/assets/js/37.ee8fa185.js"><link rel="prefetch" href="/blog/assets/js/38.a7eda2dc.js"><link rel="prefetch" href="/blog/assets/js/39.0a11c877.js"><link rel="prefetch" href="/blog/assets/js/4.7131e971.js"><link rel="prefetch" href="/blog/assets/js/40.dab93db9.js"><link rel="prefetch" href="/blog/assets/js/41.c49f0714.js"><link rel="prefetch" href="/blog/assets/js/43.298829b8.js"><link rel="prefetch" href="/blog/assets/js/44.72f73c9d.js"><link rel="prefetch" href="/blog/assets/js/45.cc847329.js"><link rel="prefetch" href="/blog/assets/js/46.547cb6b8.js"><link rel="prefetch" href="/blog/assets/js/47.bfcb0e3a.js"><link rel="prefetch" href="/blog/assets/js/48.330503ec.js"><link rel="prefetch" href="/blog/assets/js/49.b1a7da02.js"><link rel="prefetch" href="/blog/assets/js/5.2a354d3d.js"><link rel="prefetch" href="/blog/assets/js/50.a59bf0bc.js"><link rel="prefetch" href="/blog/assets/js/51.c79c032d.js"><link rel="prefetch" href="/blog/assets/js/52.8b58fef8.js"><link rel="prefetch" href="/blog/assets/js/53.9adb2093.js"><link rel="prefetch" href="/blog/assets/js/54.8894c8ed.js"><link rel="prefetch" href="/blog/assets/js/55.b566089f.js"><link rel="prefetch" href="/blog/assets/js/56.882fb1be.js"><link rel="prefetch" href="/blog/assets/js/57.8ea4c730.js"><link rel="prefetch" href="/blog/assets/js/58.93b2d8a5.js"><link rel="prefetch" href="/blog/assets/js/59.050e95a5.js"><link rel="prefetch" href="/blog/assets/js/6.a0364a73.js"><link rel="prefetch" href="/blog/assets/js/60.4a6ecf36.js"><link rel="prefetch" href="/blog/assets/js/61.df439b23.js"><link rel="prefetch" href="/blog/assets/js/62.44c4e09b.js"><link rel="prefetch" href="/blog/assets/js/63.be9cc438.js"><link rel="prefetch" href="/blog/assets/js/64.db688e6d.js"><link rel="prefetch" href="/blog/assets/js/65.1b048635.js"><link rel="prefetch" href="/blog/assets/js/66.04e0afae.js"><link rel="prefetch" href="/blog/assets/js/67.56920b76.js"><link rel="prefetch" href="/blog/assets/js/68.da13ed57.js"><link rel="prefetch" href="/blog/assets/js/69.cd56f349.js"><link rel="prefetch" href="/blog/assets/js/7.307c6a5e.js"><link rel="prefetch" href="/blog/assets/js/8.b41aa53d.js"><link rel="prefetch" href="/blog/assets/js/9.32775705.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.aea52b3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">suda-morris ä¸ªäººåšå®¢</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/cs/" class="nav-link">CS</a></div><div class="nav-item"><a href="/blog/ee/" class="nav-link">EE</a></div><div class="nav-item"><a href="/blog/others/" class="nav-link router-link-active">Others</a></div> <a href="https://github.com/suda-morris/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/cs/" class="nav-link">CS</a></div><div class="nav-item"><a href="/blog/ee/" class="nav-link">EE</a></div><div class="nav-item"><a href="/blog/others/" class="nav-link router-link-active">Others</a></div> <a href="https://github.com/suda-morris/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog/others/" class="sidebar-link">Home</a></li><li><a href="/blog/others/markdown.html" class="sidebar-link">Hello VuePress! ğŸ‰ ğŸ’¯</a></li></ul> </aside> <main class="page"> <div class="content default"><p>title: LwIP Introduction---Based on ESP32
tags:</p> <ul><li>LwIP
categories:</li> <li>Geek Hobbies
author: suda-morris
date: 2018-07-30 13:20:23</li></ul> <hr> <h2 id="tcp-ipåè®®æ ˆ"><a href="#tcp-ipåè®®æ ˆ" aria-hidden="true" class="header-anchor">#</a> TCP/IPåè®®æ ˆ</h2> <p><img src="https://s1.ax1x.com/2018/08/02/P0JwdJ.png" alt="TCP/IPåè®®æ ˆ"></p> <h2 id="lwipæ¶æ„"><a href="#lwipæ¶æ„" aria-hidden="true" class="header-anchor">#</a> LwIPæ¶æ„</h2> <p><img src="https://s1.ax1x.com/2018/08/09/PyrZkR.png" alt="LwIPæ¶æ„"></p> <h2 id="è¿›ç¨‹æ¨¡å‹"><a href="#è¿›ç¨‹æ¨¡å‹" aria-hidden="true" class="header-anchor">#</a> è¿›ç¨‹æ¨¡å‹</h2> <blockquote><p>è¿›ç¨‹æ¨¡å‹æ˜¯æŒ‡TCP/IPåè®®æ ˆçš„å„åè®®å…¥IPåè®®ã€TCPåè®®ã€ICMPåè®®ç­‰æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p></blockquote> <ul><li>TCP/IPåè®®æ ˆçš„æ¯ä¸ªåè®®éƒ½é€šè¿‡ä¸€ä¸ªä¸åŒçš„è¿›ç¨‹å®ç°ã€‚åœ¨è¯¥æ¨¡å‹ä¸‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½ä¸¥æ ¼åœ°ä¸ä¸€ä¸ªåè®®ç›¸å¯¹åº”ã€‚è¿™ç§è¿›ç¨‹æ¨¡å‹çš„ä¼˜ç‚¹æ˜¯ç½‘ç»œåè®®çš„æ¯ä¸€å±‚éƒ½å¾ˆæ¸…æ™°ï¼Œæ¯ä¸€å±‚éƒ½å¯ä»¥éšæ—¶å‚ä¸ç³»ç»Ÿè¿è¡Œã€‚è¯¥æ¨¡å‹çš„ç¼ºç‚¹æ˜¯è¿›ç¨‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”è¾ƒé¢‘ç¹ï¼Œç³»ç»Ÿå°†ä¸ºé¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä»˜å‡ºè¾ƒå¤§çš„ä»£ä»·ã€‚</li> <li>TCP/IPåè®®æ ˆé©»ç•™åœ¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸ä¸­ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨ä¸TCP/IPåè®®æ ˆé€šä¿¡ã€‚è¯¥æ¨¡å‹ä¸‹ï¼Œå„åè®®æ ˆå¹¶éä¸¥æ ¼åœ°ä¸ä¸€ä¸ªè¿›ç¨‹ç›¸å¯¹åº”ã€‚</li> <li>TCP/IPåè®®æ ˆé©»ç•™åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œç‹¬ç«‹äºæ“ä½œç³»ç»Ÿå†…æ ¸ç©ºé—´ã€‚LwIPé‡‡ç”¨æ­£æ˜¯è¿™ç§æ–¹å¼ï¼ŒLwIPä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´å†…ï¼Œå…¶ä¼˜ç‚¹æ˜¯å¯ä»¥æ–¹ä¾¿åœ°ç§»æ¤åˆ°ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­è¿è¡Œã€‚</li></ul> <h2 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" aria-hidden="true" class="header-anchor">#</a> å†…å­˜ç®¡ç†</h2> <blockquote><p>LwIPçš„åŠ¨æ€å†…å­˜ç®¡ç†æœºåˆ¶å¤§è‡´ä¸Šå¯ä»¥åˆ†æˆä¸‰ç§ï¼šæ ‡å‡†Cè¿è¡Œåº“è‡ªå¸¦çš„å†…å­˜åˆ†é…ç­–ç•¥ã€LwIPçš„åŠ¨æ€å†…å­˜å †åˆ†é…ç­–ç•¥ã€LwIPçš„åŠ¨æ€å†…å­˜æ± åˆ†é…ç­–ç•¥ã€‚</p></blockquote> <p><img src="https://s1.ax1x.com/2018/08/01/PwhSgK.png" alt="LwIPå†…å­˜ç®¡ç†"></p> <ul><li>å°†MEM_LIBC_MALLOCè®¾ç½®ä¸º1ï¼Œè¡¨æ˜ä½¿ç”¨æ ‡å‡†Cåº“è‡ªå¸¦çš„å†…å­˜åˆ†é…ç­–ç•¥</li> <li>å°†MEMP_MEM_MALLOCè®¾ç½®ä¸º1ï¼Œè¡¨æ˜ä½¿ç”¨LwIPè‡ªå·±çš„åŠ¨æ€å†…å­˜å †åˆ†é…ç­–ç•¥</li> <li>LwIPè¿˜æ”¯æŒå†…å­˜æ± ï¼Œä¸è¿‡åœ¨ESP-IDFä¸­å¹¶æ²¡æœ‰è¢«ä½¿èƒ½ã€‚ç›¸è¾ƒäºå†…å­˜å †çš„åŠ¨æ€åˆ†é…ï¼Œå†…å­˜æ± æ•ˆç‡æ›´é«˜ï¼Œç¢ç‰‡å°‘ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜</li></ul> <h2 id="ç¼“å†²ç®¡ç†"><a href="#ç¼“å†²ç®¡ç†" aria-hidden="true" class="header-anchor">#</a> ç¼“å†²ç®¡ç†</h2> <blockquote><p>LwIPçš„ç¼“å†²ç®¡ç†æœºåˆ¶çš„åŠŸèƒ½æ˜¯å°½é‡é¿å…å†…å­˜æ‹·è´ï¼Œå°½é‡è¾ƒå°‘å¯¹å†…å­˜å’Œç©ºé—´çš„éœ€æ±‚ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚LwIPä½¿ç”¨æ•°æ®ç»“æ„pbufæ¥æè¿°å†…å­˜çš„ç¼“å†²æ•°æ®åŒ…ã€‚</p></blockquote> <p><img src="https://s1.ax1x.com/2018/08/01/Pw4Mz6.png" alt="pbufç»“æ„ä½“"></p> <ul><li>ç”±äºå®é™…å‘é€æˆ–æ¥æ”¶çš„æ•°æ®åŒ…é•¿åº¦ä¸ä¸€ï¼Œè€Œæ¯ä¸ªpbufåªèƒ½ç®¡ç†ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå› æ­¤å¯¹äºå¤§å®¹é‡çš„æ•°æ®åŒ…ï¼Œå°±å¿…é¡»ä½¿ç”¨å¤šä¸ªpbufæ‰èƒ½å®Œæ•´åœ°æè¿°å®ƒ</li> <li>typeè¡¨æ˜äº†è¯¥pbufçš„ç±»å‹ï¼Œç›®å‰LwIPå®šä¹‰äº†å››ç§ç±»å‹çš„pbufï¼Œåˆ†åˆ«æ˜¯ï¼š<code>PBUF_RAM</code>ï¼Œ<code>PBUF_ROM</code>ï¼Œ<code>PBUF_REF</code>ï¼Œ<code>PBUF_POOL</code></li></ul> <p><img src="https://s1.ax1x.com/2018/08/01/Pw4RWq.png" alt="pbufç±»å‹å®šä¹‰"></p> <ul><li>PBUF_RAMç±»å‹çš„pbufæ˜¯é€šè¿‡å†…å­˜å †åˆ†é…å¾—åˆ°çš„ï¼ŒLwIPåè®®æ ˆå’Œåº”ç”¨ç¨‹åºè¦ä¼ é€’çš„æ•°æ®ä¸€èˆ¬éƒ½ä½¿ç”¨è¯¥ç±»å‹çš„pbufã€‚</li> <li>PBUF_POOLç±»å‹çš„pbufæ˜¯é€šè¿‡å†…å­˜æ± åˆ†é…å¾—åˆ°çš„ï¼Œç”±äºåˆ†é…æ­¤ç±»å‹çš„pbufå¯ä»¥å¿«é€Ÿå®Œæˆï¼Œé€‚åˆä¸­æ–­å¤„ç†ï¼Œå› æ­¤å®ƒæ›´å¤šåœ°åº”ç”¨åœ¨ç½‘ç»œè®¾å¤‡é©±åŠ¨å±‚ã€‚</li> <li>PBUF_REFå’ŒPBUF_ROMç±»å‹çš„pbufåŸºæœ¬ç›¸åŒï¼Œä»–ä»¬éƒ½æ˜¯ä»å†…å­˜æ± ä¸­ç”³è¯·åˆ†é…pbufç»“æ„é¦–éƒ¨ç©ºé—´ï¼Œè€Œä¸ç”³è¯·æ•°æ®åŒºçš„ç©ºé—´ã€‚ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼Œå‰è€…æŒ‡å‘RAMç©ºé—´å†…çš„æŸæ®µæ•°æ®ï¼Œåè€…æŒ‡å‘ROMç©ºé—´å†…çš„æŸæ®µæ•°æ®ã€‚</li></ul> <p><img src="https://s1.ax1x.com/2018/08/10/P63kMq.png" alt="pbufç»“æ„"></p> <h3 id="pbufç®¡ç†api"><a href="#pbufç®¡ç†api" aria-hidden="true" class="header-anchor">#</a> pbufç®¡ç†API</h3> <blockquote><p>å½“ä½¿ç”¨Netconn APIæ—¶ï¼Œåˆ™ä½¿ç”¨netbufï¼ˆç½‘ç»œç¼“å†²ï¼‰å‘é€/æ¥æ”¶æ•°æ®ï¼Œnetbufåªæ˜¯pbufç»“æ„çš„å°è£…ï¼Œå®ƒå¯å®¹çº³åˆ†é…çš„æˆ–å¼•ç”¨çš„æ•°æ®ã€‚</p></blockquote> <p><img src="https://s1.ax1x.com/2018/08/10/P61IaD.png" alt="pbufç®¡ç†API"></p> <h2 id="ç½‘ç»œæ¥å£å±‚"><a href="#ç½‘ç»œæ¥å£å±‚" aria-hidden="true" class="header-anchor">#</a> ç½‘ç»œæ¥å£å±‚</h2> <blockquote><p>åœ¨LwIPä¸­ï¼Œç‰©ç†ç½‘ç»œç¡¬ä»¶çš„è®¾å¤‡é©±åŠ¨é€šè¿‡ç½‘ç»œæ¥å£ç»“æ„ä½“netifæ¥æè¿°ä¸€ä¸ªç¡¬ä»¶ç½‘ç»œæ¥å£ï¼Œå¹¶é€šè¿‡<code>netif_add</code>å‡½æ•°å‘å…¨å±€å˜é‡netifé“¾è¡¨ç»“æ„å¢åŠ ä¸€ä¸ªç¡¬ä»¶ç½‘ç»œæ¥å£ã€‚</p></blockquote> <p><img src="https://s1.ax1x.com/2018/08/09/Pys12V.png" alt="ç½‘ç»œæ¥å£"></p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/** Generic data structure used for all lwIP network interfaces.
 *  The following fields should be filled in by the initialization
 *  function for the device driver: hwaddr_len, hwaddr[], mtu, flags */</span>
<span class="token keyword">struct</span> <span class="token class-name">netif</span> <span class="token punctuation">{</span>
  <span class="token comment">/** pointer to next in linked list */</span>
  <span class="token keyword">struct</span> <span class="token class-name">netif</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_IPV4</span>
  <span class="token comment">/** IP address configuration in network byte order */</span>
  ip_addr_t ip_addr<span class="token punctuation">;</span>
  ip_addr_t netmask<span class="token punctuation">;</span>
  ip_addr_t gw<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_IPV4 */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_IPV6</span>
  <span class="token comment">/** Array of IPv6 addresses for this netif. */</span>
  ip_addr_t ip6_addr<span class="token punctuation">[</span>LWIP_IPV6_NUM_ADDRESSES<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/** The state of each IPv6 address (Tentative, Preferred, etc).
   * @see ip6_addr.h */</span>
  u8_t ip6_addr_state<span class="token punctuation">[</span>LWIP_IPV6_NUM_ADDRESSES<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">if</span> ESP_LWIP</span>
  <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>ipv6_addr_cb<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">netif</span><span class="token operator">*</span> netif<span class="token punctuation">,</span> u8_t ip_idex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* callback for ipv6 addr states changed */</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_IPV6 */</span>
  <span class="token comment">/** This function is called by the network device driver
   *  to pass a packet up the TCP/IP stack. */</span>
  netif_input_fn input<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_IPV4</span>
  <span class="token comment">/** This function is called by the IP module when it wants
   *  to send a packet on the interface. This function typically
   *  first resolves the hardware address, then sends the packet. */</span>
  netif_output_fn output<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_IPV4 */</span>
  <span class="token comment">/** This function is called by the ARP module when it wants
   *  to send a packet on the interface. This function outputs
   *  the pbuf as-is on the link medium. */</span>
  netif_linkoutput_fn linkoutput<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_IPV6</span>
  <span class="token comment">/** This function is called by the IPv6 module when it wants
   *  to send a packet on the interface. This function typically
   *  first resolves the hardware address, then sends the packet. */</span>
  netif_output_ip6_fn output_ip6<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_IPV6 */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_NETIF_STATUS_CALLBACK</span>
  <span class="token comment">/** This function is called when the netif state is set to up or down
   */</span>
  netif_status_callback_fn status_callback<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_NETIF_STATUS_CALLBACK */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_NETIF_LINK_CALLBACK</span>
  <span class="token comment">/** This function is called when the netif link is set to up or down
   */</span>
  netif_status_callback_fn link_callback<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_NETIF_LINK_CALLBACK */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_NETIF_REMOVE_CALLBACK</span>
  <span class="token comment">/** This function is called when the netif has been removed */</span>
  netif_status_callback_fn remove_callback<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_NETIF_REMOVE_CALLBACK */</span>
  <span class="token comment">/** This field can be set by the device driver and could point
   *  to state information for the device. */</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>state<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_DHCP</span>
  <span class="token comment">/** the DHCP client state information for this netif */</span>
  <span class="token keyword">struct</span> <span class="token class-name">dhcp</span> <span class="token operator">*</span>dhcp<span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">if</span> ESP_LWIP</span>
  <span class="token keyword">struct</span> <span class="token class-name">udp_pcb</span> <span class="token operator">*</span>dhcps_pcb<span class="token punctuation">;</span>	
  dhcp_event_fn dhcp_event<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span>  </span>

<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_DHCP */</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_AUTOIP</span>
  <span class="token comment">/** the AutoIP client state information for this netif */</span>
  <span class="token keyword">struct</span> <span class="token class-name">autoip</span> <span class="token operator">*</span>autoip<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_IPV6_AUTOCONFIG</span>
  <span class="token comment">/** is this netif enabled for IPv6 autoconfiguration */</span>
  u8_t ip6_autoconfig_enabled<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_IPV6_AUTOCONFIG */</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_IPV6_SEND_ROUTER_SOLICIT</span>
  <span class="token comment">/** Number of Router Solicitation messages that remain to be sent. */</span>
  u8_t rs_count<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_IPV6_SEND_ROUTER_SOLICIT */</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_IPV6_DHCP6</span>
  <span class="token comment">/** the DHCPv6 client state information for this netif */</span>
  <span class="token keyword">struct</span> <span class="token class-name">dhcp6</span> <span class="token operator">*</span>dhcp6<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_IPV6_DHCP6 */</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_NETIF_HOSTNAME</span>
  <span class="token comment">/* the hostname for this netif, NULL is a valid value */</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span>  hostname<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_NETIF_HOSTNAME */</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_CHECKSUM_CTRL_PER_NETIF</span>
  u16_t chksum_flags<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_CHECKSUM_CTRL_PER_NETIF*/</span>

  <span class="token comment">/** maximum transfer unit (in bytes) */</span>
  u16_t mtu<span class="token punctuation">;</span>
  <span class="token comment">/** number of bytes used in hwaddr */</span>
  u8_t hwaddr_len<span class="token punctuation">;</span>
  <span class="token comment">/** link level hardware address of this interface */</span>
  u8_t hwaddr<span class="token punctuation">[</span>NETIF_MAX_HWADDR_LEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/** flags (see NETIF_FLAG_ above) */</span>
  u8_t flags<span class="token punctuation">;</span>
  <span class="token comment">/** descriptive abbreviation */</span>
  <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/** number of this interface */</span>
  u8_t num<span class="token punctuation">;</span>
  
<span class="token macro property">#<span class="token directive keyword">if</span> MIB2_STATS</span>
  <span class="token comment">/** link type (from &quot;snmp_ifType&quot; enum from snmp_mib2.h) */</span>
  u8_t link_type<span class="token punctuation">;</span>
  <span class="token comment">/** (estimate) link speed */</span>
  u32_t link_speed<span class="token punctuation">;</span>
  <span class="token comment">/** timestamp at last change made (up/down) */</span>
  u32_t ts<span class="token punctuation">;</span>
  <span class="token comment">/** counters */</span>
  <span class="token keyword">struct</span> <span class="token class-name">stats_mib2_netif_ctrs</span> mib2_counters<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* MIB2_STATS */</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_IPV4 &amp;&amp; LWIP_IGMP</span>
  <span class="token comment">/** This function could be called to add or delete an entry in the multicast
      filter table of the ethernet MAC.*/</span>
  netif_igmp_mac_filter_fn igmp_mac_filter<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_IPV4 &amp;&amp; LWIP_IGMP */</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_IPV6 &amp;&amp; LWIP_IPV6_MLD</span>
  <span class="token comment">/** This function could be called to add or delete an entry in the IPv6 multicast
      filter table of the ethernet MAC. */</span>
  netif_mld_mac_filter_fn mld_mac_filter<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_IPV6 &amp;&amp; LWIP_IPV6_MLD */</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_NETIF_HWADDRHINT</span>
  u8_t <span class="token operator">*</span>addr_hint<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_NETIF_HWADDRHINT */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> ENABLE_LOOPBACK</span>
  <span class="token comment">/* List of packets to be queued for ourselves. */</span>
  <span class="token keyword">struct</span> <span class="token class-name">pbuf</span> <span class="token operator">*</span>loop_first<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">pbuf</span> <span class="token operator">*</span>loop_last<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_LOOPBACK_MAX_PBUFS</span>
  u16_t loop_cnt_current<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_LOOPBACK_MAX_PBUFS */</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* ENABLE_LOOPBACK */</span>

<span class="token macro property">#<span class="token directive keyword">if</span> ESP_LWIP</span>
  <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>l2_buffer_free_notify<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>user_buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Allows LWIP to notify driver when a L2-supplied pbuf can be freed */</span>
  ip_addr_t last_ip_addr<span class="token punctuation">;</span> <span class="token comment">/* Store last non-zero ip address */</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br></div></div><ul><li><img src="https://s1.ax1x.com/2018/08/09/PysfPI.png" alt="IPä¿¡æ¯"></li> <li>ip_addrï¼Œnetmaskï¼Œgwåˆ†åˆ«è¡¨ç¤ºäº†IPåœ°å€ã€å­ç½‘æ©ç ã€ç½‘å…³ï¼Œå»ºè®®è¿™æ ·å­è®¾å®šï¼š<code>IP4_ADDR(&amp;ipaddr,192,168,1,100)</code></li> <li><img src="https://s1.ax1x.com/2018/08/09/Pysqaj.png" alt="ç¡¬ä»¶ä¿¡æ¯"></li> <li>mtuè¡¨æ˜æœ€å¤§çš„ç½‘ç»œä¼ è¾“ä¸ªæ•°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½</li> <li>hwaddrå­˜æ”¾äº†ç¡¬ä»¶æ¥å£çš„åœ°å€ï¼Œå¯¹äºä»¥å¤ªç½‘è€Œè¨€ï¼Œå°±æ˜¯MACåœ°å€</li> <li>flagsæ˜¯ç¡¬ä»¶æ¥å£çŠ¶æ€ä¿¡æ¯æ ‡å¿—ä½ï¼Œå¦‚æ˜¯å¦å»ºç«‹è¿æ¥çŠ¶æ€ï¼Œæ˜¯å¦å…è®¸å¹¿æ’­åŠŸèƒ½ç­‰</li> <li>nameç”¨æ¥è¡¨ç¤ºç¡¬ä»¶æ¥å£ä½¿ç”¨çš„é©±åŠ¨ç±»å‹ï¼Œç¼©å†™ï¼Œ2ä¸ªå­—èŠ‚ï¼Œæ¯”å¦‚è“ç‰™è®¾å¤‡ä¸ºâ€œbl&quot;ï¼Œwifiè®¾å¤‡ä¸º&quot;wl&quot;</li> <li>numç”¨æ¥è¡¨ç¤ºç¡¬ä»¶æ¥å£çš„ç¼–å·ï¼Œå½“ä¸¤ä¸ªç¡¬ä»¶æ¥å£çš„nameå­—æ®µç›¸åŒæ—¶ï¼Œè¯¥å­—æ®µå¯ä»¥ç”¨æ¥åŒºåˆ†æ˜¯å“ªä¸€ä¸ªç¡¬ä»¶æ¥å£</li> <li><img src="https://s1.ax1x.com/2018/08/09/PysXin.png" alt="é©±åŠ¨åŠŸèƒ½"></li> <li>inputæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘çš„å‡½æ•°ç”¨äºå°†ç½‘ç»œç¡¬ä»¶æ¥å£æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ä¼ é€’ç»™ä¸Šå±‚TCP/IPåè®®æ ˆ</li> <li>outputæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå®ƒæ‰€æŒ‡å‘çš„å‡½æ•°ç”¨äºå°†IPå±‚çš„æ•°æ®åŒ…å‘é€åˆ°ç½‘ç»œç¡¬ä»¶æ¥å£ä¸Š</li> <li>linkoutputæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œåœ¨ARPæ¨¡å—ä¸­è°ƒç”¨ï¼ŒoutputæŒ‡å‘çš„å‡½æ•°ä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨linkoutputæŒ‡å‘çš„å‡½æ•°å®ç°æ•°æ®æŠ¥å‘é€çš„</li></ul> <h2 id="arpå¤„ç†"><a href="#arpå¤„ç†" aria-hidden="true" class="header-anchor">#</a> ARPå¤„ç†</h2> <blockquote><p>ARPåè®®æ˜¯TCP/IPåè®®çš„åŸºç¡€ï¼Œæœ¬è´¨æ˜¯å®ç°IPåœ°å€ä¸åº•å±‚ç‰©ç†åœ°å€çš„ç›¸äº’è½¬æ¢ã€‚ARPåè®®çš„æ ¸å¿ƒæ˜¯ARPç¼“å­˜è¡¨ï¼Œè€ŒARPåè®®çš„å®è´¨å°±æ˜¯å¯¹ç¼“å­˜è¡¨çš„å»ºç«‹ã€æ›´æ–°ã€æŸ¥è¯¢ç­‰æ“ä½œã€‚ARPç¼“å­˜è¡¨æ˜¯ç”±è‹¥å¹²ç¼“å­˜è¡¨é¡¹ç»„æˆï¼Œåœ¨LwIPä¸­ï¼Œæè¿°ç¼“å­˜è¡¨é¡¹çš„æ•°æ®ç»“æ„å«etharp_entryã€‚</p></blockquote> <p><img src="https://s1.ax1x.com/2018/08/02/P0CQUA.png" alt="ARPåè®®æ•°æ®åŒ…æ ¼å¼"></p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">etharp_entry</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">if</span> ARP_QUEUEING</span>
  <span class="token comment">/** Pointer to queue of pending outgoing packets on this ARP entry. */</span>
  <span class="token keyword">struct</span> <span class="token class-name">etharp_q_entry</span> <span class="token operator">*</span>q<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span> </span><span class="token comment">/* ARP_QUEUEING */</span>
  <span class="token comment">/** Pointer to a single pending outgoing packet on this ARP entry. */</span>
  <span class="token keyword">struct</span> <span class="token class-name">pbuf</span> <span class="token operator">*</span>q<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* ARP_QUEUEING */</span>
  ip4_addr_t ipaddr<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">netif</span> <span class="token operator">*</span>netif<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">eth_addr</span> ethaddr<span class="token punctuation">;</span>
  u16_t ctime<span class="token punctuation">;</span>
  u8_t state<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>ipaddrå­˜æ”¾IPåœ°å€ï¼Œethaddrå­˜æ”¾ç‰©ç†åœ°å€ï¼Œstateè¡¨ç¤ºç¼“å­˜é¡¹çš„çŠ¶æ€ï¼ˆä¾‹å¦‚æ˜¯å¦ä¸ºç©ºï¼Œæ˜¯å¦ç¨³å®šï¼‰ï¼Œctimeè®°å½•ARPç¼“å­˜é¡¹å¤„äºæŸä¸ªçŠ¶æ€çš„æ—¶é—´ï¼Œå½“æŸè¡¨é¡¹çš„ctimeå€¼å¤§äºè§„å®šçš„è¡¨é¡¹æœ€å¤§ç”Ÿå­˜å€¼æ—¶ï¼ŒLwIPå†…æ ¸ä¼šåˆ é™¤è¯¥è¡¨é¡¹ã€‚å› æ­¤ä½¿ç”¨ARPåŠŸèƒ½æ—¶ï¼Œå¿…é¡»è®¾ç½®ä¸€ä¸ªARPè¶…æ—¶äº‹ä»¶ï¼Œè¯¥è¶…æ—¶äº‹ä»¶çš„åŸºæœ¬åŠŸèƒ½å°±æ˜¯å¯¹æ¯ä¸ªè¡¨é¡¹çš„ctimeå­—æ®µå€¼åŠ 1ï¼Œç„¶ååˆ é™¤é‚£äº›ç”Ÿå­˜æ—¶é—´å¤§äºæœ€å¤§ç”Ÿå­˜å€¼çš„è¡¨é¡¹</li></ul> <p><img src="https://s1.ax1x.com/2018/08/02/P0PcWt.jpg" alt="ARPå¤„ç†æµç¨‹"></p> <ul><li>å‡½æ•°ethernet_inputæ ¹æ®æŠ¥æ–‡é¦–éƒ¨çš„å¸§ç±»å‹å­—æ®µåˆ¤æ–­æ¥æ”¶åˆ°çš„æŠ¥æ–‡ç±»å‹ï¼Œå¦‚æœæ˜¯IPåŒ…ï¼Œåˆ™å°†è¯¥åŒ…ä¼ é€’ç»™etharp_ip_inputï¼Œå¦‚æœæ˜¯ARPåŒ…ï¼Œåˆ™å°†è¯¥åŒ…é€’äº¤ç»™etharp_arp_input</li> <li>å‡½æ•°etharp_ip_inputè°ƒç”¨å‡½æ•°update_arp_entryï¼Œå®ƒæ˜¯å°†æŠ¥æ–‡é¦–éƒ¨çš„MACåœ°å€å’ŒIPåœ°å€æ›´æ–°åˆ°ARPç¼“å­˜ä¸­</li> <li>å‡½æ•°etharp_arp_inputé¦–å…ˆåˆ¤æ–­æ¥æ”¶åˆ°çš„ARPæ•°æ®åŒ…çš„ç±»å‹ï¼Œå¦‚æœæ˜¯ARPè¯·æ±‚åŒ…ï¼Œé‚£ä¹ˆé¦–å…ˆåˆ¤æ–­è¿™ä¸ªåŒ…æ˜¯å¦æ˜¯ç»™è‡ªå·±çš„ï¼Œå¦‚æœæ˜¯ç»™è‡ªå·±çš„ï¼Œå°±åœ¨åŸæœ‰åŒ…çš„åŸºç¡€ä¸Šé‡ç»„ä¸€ä¸ªARPåº”ç­”åŒ…å‘é€å‡ºå»ï¼›å¦‚æœä¸æ˜¯ç»™è‡ªå·±çš„ï¼Œåˆ™ç›´æ¥å¿½ç•¥è€Œå¦‚æœæ¥æ”¶åˆ°çš„æ•°æ®åŒ…æ˜¯ARPåº”ç­”åŒ…ï¼Œé‚£ä¹ˆå°±è°ƒç”¨update_arp_entryæ›´æ–°ARPç¼“å­˜è¡¨</li></ul> <h2 id="ipå¤„ç†"><a href="#ipå¤„ç†" aria-hidden="true" class="header-anchor">#</a> IPå¤„ç†</h2> <p><img src="https://s1.ax1x.com/2018/08/02/P0CUbQ.png" alt="IPåè®®æ•°æ®åŒ…æ ¼å¼"></p> <h4 id="lwipè½¯ä»¶å¤§è‡´æ¡†æ¶"><a href="#lwipè½¯ä»¶å¤§è‡´æ¡†æ¶" aria-hidden="true" class="header-anchor">#</a> LwIPè½¯ä»¶å¤§è‡´æ¡†æ¶</h4> <p><img src="https://s1.ax1x.com/2018/08/02/P0keJA.jpg" alt="LwIPæ•´ä½“æ¡†æ¶å›¾"></p> <ul><li>ip_inputä¼šåšå„é¡¹æ£€æŸ¥ï¼ŒåŒ…æ‹¬åè®®ç‰ˆæœ¬å·ï¼ŒIPé¦–éƒ¨çš„æ ¡éªŒå€¼ï¼ŒæºIPåœ°å€æ˜¯å¦æœ‰æ•ˆç­‰ï¼Œç„¶åæ£€æµ‹IPæ•°æ®åŒ…ä¸­çš„ç›®çš„IPåœ°å€æ˜¯å¦ä¸æœ¬èŠ‚ç‚¹çš„IPåœ°å€ç›¸ç¬¦ï¼Œå¦‚æœæ˜¯æœ¬èŠ‚ç‚¹çš„IPåœ°å€ï¼Œåˆ™æ ¹æ®è¯¥IPæ•°æ®åŒ…é¦–éƒ¨çš„åè®®å­—æ®µåˆ¤æ–­è¯¥æ•°æ®åŒ…åº”è¯¥è¢«é€’äº¤åˆ°å“ªä¸ªä¸Šå±‚åè®®ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚å¦‚æœæ˜¯UDPåè®®ï¼Œåˆ™è°ƒç”¨udp_inputå‡½æ•°ï¼›å¦‚æœæ˜¯TCPåè®®ï¼Œåˆ™è°ƒç”¨tcp_inputå‡½æ•°ï¼›å¦‚æœæ˜¯ICMPåè®®ï¼Œåˆ™è°ƒç”¨icmp_inputå‡½æ•°ï¼›å¦‚æœæ˜¯IGMPåè®®ï¼Œåˆ™è°ƒç”¨igmp_inputå‡½æ•°ï¼›å¦‚æœéƒ½ä¸æ˜¯ï¼Œåˆ™è°ƒç”¨å‡½æ•°icmp_dest_unreachè¿”å›ä¸€ä¸ªåè®®ä¸å¯è¾¾ICMPæ•°æ®åŒ…ç»™æºä¸»æœºã€‚å¦‚æœä¸æ˜¯æœ¬èŠ‚ç‚¹çš„IPåœ°å€ï¼Œåˆ™é€šè¿‡è°ƒç”¨å‡½æ•°ip_forwardå¯¹æ•°æ®åŒ…è¿›è¡Œè½¬å‘ã€‚éœ€è¦æ³¨æ„ï¼Œç”±äºä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½å«æœ‰å¤šä¸ªIPåœ°å€ï¼Œå› æ­¤ip_inputå‡½æ•°ä¼šéå†ç½‘ç»œæ¥å£é“¾è¡¨netif_listä¸Šçš„netifç»“æ„å˜é‡ï¼Œæ¥æŸ¥æ‰¾ä¸IPæ•°æ®åŒ…ä¸­ç›¸åŒ¹é…çš„IPåœ°å€ã€‚</li> <li>ip_outputä½¿ç”¨ip_routeå‡½æ•°æŸ¥æ‰¾ç›®æ ‡ç½‘ç»œæ¥å£netifæ¥å‘é€IPæ•°æ®åŒ…ã€‚å½“ç½‘ç»œæ¥å£netifç¡®å®šåï¼ŒIPæ•°æ®åŒ…é€šè¿‡å‡½æ•°ip_output_ifå‘é€å‡ºå»ã€‚è‹¥ip_routeæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ç½‘ç»œæ¥å£ï¼Œåˆ™ä¸¢å¼ƒè¯¥æŠ¥æ–‡ï¼Œç»ˆæ­¢æœ¬æ¬¡å‘é€ã€‚å‡½æ•°ip_routeé€šè¿‡éå†ç½‘ç»œæ¥å£é“¾è¡¨netif_listï¼ŒæŸ¥æ‰¾ä¸ç›®çš„IIPåœ°å€åœ¨åŒä¸€ä¸ªå­ç½‘ä¸­çš„ç½‘ç»œæ¥å£ï¼Œå¹¶å°†è¯¥ç½‘ç»œæ¥å£è¿”å›ç»™å˜é‡netifã€‚</li></ul> <h2 id="icmpå¤„ç†"><a href="#icmpå¤„ç†" aria-hidden="true" class="header-anchor">#</a> ICMPå¤„ç†</h2> <p><img src="https://s1.ax1x.com/2018/08/02/P0AVmT.jpg" alt="ICMPåè®®æ•°æ®åŒ…æ ¼å¼"></p> <ul><li>icmp_inputåœ¨ip_inputä¸­è¢«è°ƒç”¨ï¼Œå®ƒå¤„ç†æ¥æ”¶åˆ°çš„ICMPæ•°æ®åŒ…ï¼Œå¹¶æ ¹æ®åŒ…ç±»å‹åšç›¸åº”çš„å¤„ç†ã€‚åœ¨LwIPåè®®æ ˆä¸­ï¼Œå®ƒåªå¤„ç†ICMPå›æ˜¾è¯·æ±‚åŒ…ï¼Œå¯¹å…¶ä»–ç±»å‹çš„ICMPåŒ…ä¸ä½œå“åº”ã€‚icmp_inputåœ¨å¤„ç†ICMPå›æ˜¾è¯·æ±‚æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­è¯¥æ•°æ®åŒ…æ˜¯å¦ä¸ºå¹¿æ’­æˆ–è€…ç»„æ’­åŒ…ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸å†ç»§ç»­å¤„ç†ï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™ç»§ç»­åˆ¤æ–­è¯¥æ•°æ®åŒ…é•¿åº¦æ˜¯å¦å°äºICMPå›æ˜¾è¯·æ±‚å¤´éƒ¨é•¿åº¦ï¼Œå¦‚æœæ˜¯åˆ™ä¸¢å¼ƒæ•°æ®åŒ…ï¼›å¦‚æœä¸æ˜¯åˆ™å°†è¯¥ICMPæŠ¥æ–‡ç±»å‹å­—æ®µå˜ä¸º0ï¼Œé‡æ–°è®¡ç®—æ ¡éªŒå’Œï¼Œå¹¶å°†IPæŠ¥æ–‡é¦–éƒ¨çš„æºIPåœ°å€å’Œç›®çš„IPåœ°å€äº¤æ¢ä½ç½®ï¼Œå¹¶é€šè¿‡è°ƒç”¨å‡½æ•°ip_output_ifå°†æ•°æ®åŒ…å‘é€å‡ºå»ã€‚</li> <li>å‡½æ•°icmp_dest_unreachåœ¨ip_inputã€udp_inputä¸­è¢«è°ƒç”¨ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯é€šè¿‡è°ƒç”¨å‡½æ•°icmp_send_responseå‘é€ä¸€ä¸ªâ€œç›®çš„ä¸å¯åˆ°è¾¾â€ç±»å‹çš„icmpæŠ¥æ–‡ã€‚åœ¨å‡½æ•°ip_inputä¸­ï¼Œå½“æ‰€æ¥æ”¶çš„IPæŠ¥æ–‡åè®®å­—æ®µä¸å¯è¯†åˆ«æ—¶ï¼Œicmp_dest_unreachå°±è¢«è°ƒç”¨ã€‚è€Œåœ¨UDPå¤„ç†å™¨ä¸­ï¼Œè‹¥ä¸èƒ½æ‰¾åˆ°ä¸æ¥æ”¶çš„æŠ¥æ–‡ç›¸å¯¹åº”çš„ç«¯å£å·ï¼Œåˆ™icmp_dest_unreachä¹Ÿå°†è¢«è°ƒç”¨ã€‚</li> <li>å‡½æ•°icmp_time_exceededåœ¨ip_forwardä¸­è¢«è°ƒç”¨ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯é€šè¿‡è°ƒç”¨å‡½æ•°icmp_send_responseå‘é€ä¸€ä¸ªâ€œè¶…æ—¶â€ç±»å‹çš„ICMPæŠ¥æ–‡ã€‚åœ¨å‡½æ•°ip_forwardä¸­ï¼Œå½“TTLå‡å°ä¸º0æ—¶ï¼Œè°ƒç”¨è¯¥å‡½æ•°ã€‚</li></ul> <h2 id="udpå¤„ç†"><a href="#udpå¤„ç†" aria-hidden="true" class="header-anchor">#</a> UDPå¤„ç†</h2> <p><img src="https://s1.ax1x.com/2018/08/02/P0JfdH.png" alt="UDPåè®®æ•°æ®åŒ…"></p> <ul><li>å‡½æ•°udp_inputå°†æ£€æŸ¥æŠ¥æ–‡çš„UDPæ ¡éªŒï¼Œæœ€ç»ˆè°ƒç”¨å‡½æ•°recvï¼Œå°†æ”¶åˆ°çš„æŠ¥æ–‡ä¼ é€’ç»™åº”ç”¨å±‚ç¨‹åº</li> <li>å½“åº”ç”¨å±‚ç¨‹åºè¦é€šè¿‡UDPåè®®å‘å¤–å‘é€IPæŠ¥æ–‡æ—¶ï¼Œå°†é€šè¿‡è°ƒç”¨å‡½æ•°udp_sendå®ç°ï¼Œå‡½æ•°udp_sendé€šè¿‡è°ƒç”¨IPå±‚çš„å‡½æ•°ip_output_ifå®ç°æŠ¥æ–‡çš„å‘é€</li> <li>LwIPä½¿ç”¨é“¾è¡¨ç»“æ„ä½“udp_pcbæ¥ä¿å­˜æ¯ä¸€ä¸ªUDPä¼šè¯çš„çŠ¶æ€</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">udp_pcb</span> <span class="token punctuation">{</span>
<span class="token comment">/* Common members of all PCB types */</span>
  IP_PCB<span class="token punctuation">;</span>

<span class="token comment">/* Protocol specific PCB members */</span>

  <span class="token keyword">struct</span> <span class="token class-name">udp_pcb</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>

  u8_t flags<span class="token punctuation">;</span>
  <span class="token comment">/** ports are in host byte order */</span>
  u16_t local_port<span class="token punctuation">,</span> remote_port<span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_MULTICAST_TX_OPTIONS</span>
  <span class="token comment">/** outgoing network interface for multicast packets */</span>
  ip_addr_t multicast_ip<span class="token punctuation">;</span>
  <span class="token comment">/** TTL for outgoing multicast packets */</span>
  u8_t mcast_ttl<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_MULTICAST_TX_OPTIONS */</span>

<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_UDPLITE</span>
  <span class="token comment">/** used for UDP_LITE only */</span>
  u16_t chksum_len_rx<span class="token punctuation">,</span> chksum_len_tx<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_UDPLITE */</span>

  <span class="token comment">/** receive callback function */</span>
  udp_recv_fn recv<span class="token punctuation">;</span>
  <span class="token comment">/** user-supplied argument for the recv callback */</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>recv_arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="tcpå¤„ç†"><a href="#tcpå¤„ç†" aria-hidden="true" class="header-anchor">#</a> TCPå¤„ç†</h2> <p><img src="https://s1.ax1x.com/2018/08/02/P0JULF.png" alt="TCPåè®®æ•°æ®åŒ…"></p> <ul><li>TCPçš„æ»‘åŠ¨çª—å£åè®®æ˜¯ç”¨äºå®ç°æµé‡æ§åˆ¶çš„</li> <li>TCPçš„è¶…æ—¶å’Œé‡ä¼ æœºåˆ¶æé«˜äº†æ•°æ®ä¼ è¾“çš„å¯é æ€§</li> <li>æ‹¥å¡æ§åˆ¶æ˜¯é€šè¿‡æ…¢å¯åŠ¨ç®—æ³•å’Œæ‹¥å¡é¿å…ç®—æ³•æ¥å®ç°çš„</li> <li>LwIPä¸­å«æœ‰ä¸¤ä¸ªå®šæ—¶å™¨å‡½æ•°ï¼štcp_fasttmrå’Œtcp_slowtmrï¼Œtcp_fasttmræ¯250msè°ƒç”¨ä¸€æ¬¡ï¼Œtcp_slowtmræ¯500msè°ƒç”¨ä¸€æ¬¡ã€‚å¿«é€Ÿå®šæ—¶å™¨ä¸»è¦åšä¸¤ä¸ªæ–¹é¢çš„äº‹æƒ…ï¼šå‘ä¸Šå±‚é€’äº¤ä¸Šå±‚ä¸€ç›´æœªæ¥æ”¶çš„æ•°æ®ï¼ŒäºŒæ˜¯å‘é€è¯¥è¿æ¥ä¸Šçš„å»¶è¿ŸACKè¯·æ±‚æ•°æ®æ®µã€‚æ…¢é€Ÿå®šæ—¶å™¨å‚ä¸äº†è¾ƒå¤šåŠŸèƒ½ï¼Œå¦‚è¶…æ—¶ä¸é‡ä¼ ã€æ‹¥å¡æ§åˆ¶ç­‰ã€‚</li></ul> <h2 id="å¸¸ç”¨apiæ¥å£"><a href="#å¸¸ç”¨apiæ¥å£" aria-hidden="true" class="header-anchor">#</a> å¸¸ç”¨APIæ¥å£</h2> <blockquote><p>LwIPæä¾›äº†3ç§åº”ç”¨ç¨‹åºæ¥å£ï¼š</p> <ol><li>ç›´æ¥è°ƒç”¨åè®®æ ˆå„æ¨¡å—çš„å‡½æ•°ï¼Œå®ƒæ˜¯åŸºäºå›è°ƒå‡½æ•°çš„APIæ¥å£ï¼Œä¹Ÿæˆä¸ºRAW APIæ¥å£ï¼Œå›è°ƒå‡½æ•°ç›´æ¥è¢«åè®®æ ˆä»£ç è°ƒç”¨ï¼Œå› æ­¤åº”ç”¨ç¨‹åºä»£ç å’ŒTCP/IPåè®®æ ˆè¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œï¼Œæ— éœ€ä½¿ç”¨æ“ä½œç³»ç»Ÿï¼Œä¸¤è€…ä¹‹é—´è¿™ç§è‰¯å¥½çš„ç»“åˆå¯ä»¥ä½¿å¾—ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡æ›´é«˜ï¼Œè€Œä¸”åœ¨è¿è¡Œä¸­å®ƒå ç”¨æ›´å°‘çš„å†…å­˜èµ„æº</li> <li>ä½¿ç”¨LwIPæä¾›çš„ä¸“ç”¨APIæ¥å£ï¼Œä¹Ÿç§°ä¸ºSequential APIæ¥å£ï¼Œç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹åŸºäºopen-read-write-closeæ¨¡å‹ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿçš„æ”¯æŒï¼Œå¦å¤–éœ€è¦åœ¨æ–‡ä»¶lwipopts.hä¸­æŠŠå®å®šä¹‰<code>NO_SYS</code>å®šä¹‰ä¸º0ã€‚Sequential APIè¢«åˆ†æˆä¸¤éƒ¨åˆ†å®ç°ï¼Œä¸€éƒ¨åˆ†é©»ç•™åœ¨åº”ç”¨ç¨‹åºè¿›ç¨‹ä¸­ï¼Œå¦ä¸€éƒ¨åˆ†åœ¨TCP/IPåè®®æ ˆè¿›ç¨‹å†…å®ç°ã€‚è¿™ä¸¤éƒ¨åˆ†APIä¹‹é—´é‡‡ç”¨ç”±æ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿå±‚æä¾›çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶è¿›è¡Œé€šä¿¡ã€‚åœ¨LwIPä¸­ï¼Œæ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿå±‚æ˜¯LwIPåè®®æ ˆçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå­˜åœ¨çš„ç›®çš„æ˜¯æ–¹é¢LwIPçš„ç§»æ¤ï¼Œå®ƒåœ¨åº•å±‚æ“ä½œç³»ç»Ÿå’ŒLwIPåè®®æ ˆä¹‹é—´æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œå½“ç”¨æˆ·ç§»æ¤LwIPåˆ°ä¸€ä¸ªæ–°çš„ç›®æ ‡ç³»ç»Ÿçš„æ—¶å€™ï¼Œåªéœ€è¦ä¿®æ”¹è¿™ä¸ªæ¥å£å†…çš„å‡½æ•°å³å¯ã€‚é©»ç•™åœ¨åº”ç”¨ç¨‹åºè¿›ç¨‹ä¸­çš„APIæ¥å£ä¸TCP/IPåè®®æ ˆè¿›ç¨‹ä¸­çš„APIä¹‹é—´é€šè¿‡å…±äº«å†…å­˜ä¼ é€’æ•°æ®ï¼Œå¯¹è¯¥å…±äº«å†…å­˜åŒºçš„æè¿°æ˜¯é‡‡ç”¨netbufç»“æ„ä½“</li> <li>BSD Socketå…¼å®¹çš„Socketå‡½æ•°æ¥å£ï¼Œä½†æ˜¯BSDå¥—æ¥å­—éœ€è¦å°†å‘é€çš„æ•°æ®ä»åº”ç”¨ç¨‹åºå¤åˆ¶åˆ°TCP/IPåè®®æ ˆçš„å†…éƒ¨ç¼“å†²åŒºï¼Œå°†ä¼šæ¶ˆè€—ç³»ç»Ÿæœ‰é™çš„èµ„æº</li></ol></blockquote> <h3 id="tcp-raw-api"><a href="#tcp-raw-api" aria-hidden="true" class="header-anchor">#</a> TCP RAW API</h3> <p><img src="https://s1.ax1x.com/2018/08/10/P6l7j0.png" alt="TCP RAW API"></p> <table><thead><tr><th>å‡½æ•°</th> <th>è¯´æ˜</th></tr></thead> <tbody><tr><td>struct tcp_pcb* tcp_new()</td> <td>æ–°å»ºtcpåè®®æ§åˆ¶å—</td></tr> <tr><td>ert_t tcp_bind(struct tcp_pcb* pcb,struct ip_addr* ipaddr,u16_t port)</td> <td>ç»‘å®šæœ¬åœ°IPåœ°å€å’Œç«¯å£å·ï¼Œå¦‚æœipaddrä¸ºIP_ADDR_ANYï¼Œåˆ™å°†è¿æ¥ç»‘å®šåˆ°æ‰€æœ‰çš„æœ¬åœ°IPåœ°å€ä¸Š</td></tr> <tr><td>struct tcp_pcb* tcp_listen(struct tcp_pcb* pcb)</td> <td>ä½¿æŒ‡å®šçš„è¿æ¥å¼€å§‹è¿›å…¥ç›‘å¬çŠ¶æ€ï¼Œå¦‚æœç›‘å¬æˆåŠŸï¼Œå°±è¿”å›ä¸€ä¸ªæ–°çš„è¿æ¥æ§åˆ¶å—pcb</td></tr> <tr><td>void tcp_accepted(struct tcp_pcb* pcb)</td> <td>é€šçŸ¥LwIPä¸€ä¸ªæ–°æ¥çš„è¿æ¥å·²ç»è¢«æ¥æ”¶ï¼Œè¿™ä¸ªå‡½æ•°é€šå¸¸åœ¨ç”±tcp_acceptæŒ‡å®šçš„å›è°ƒå‡½æ•°ä¸­è¢«è°ƒç”¨</td></tr> <tr><td>void tcp_accept(struct tcp_pcb* pcb,err_t (*accept)(void* arg,struct tcp_pcb* newpcb,err_t err))</td> <td>æŒ‡å®šå¤„äºç›‘å¬çŠ¶æ€çš„è¿æ¥ï¼Œåœ¨æˆåŠŸå»ºç«‹è¿æ¥åè¦è°ƒç”¨çš„å›è°ƒæ–¹æ³•</td></tr> <tr><td>err_t tcp_connect(struct tcp_pcb* pcb,struct ip_addr* ipaddr,u16_t port,err_t (* connected)(void* arg,struct tcp_pcb* tpcb,err_t err))</td> <td>è¯·æ±‚è¿æ¥åˆ°æ‰§è¡Œçš„è¿œç¨‹ä¸»æœº</td></tr> <tr><td>err_t tcp_write(struct tcp_pcb* pcb,void* dataptr,u16_t len,u8_t copy)</td> <td>å‘é€TCPæ•°æ®ï¼Œå°†è¦å‘é€çš„æ•°æ®æ”¾å…¥å‘é€é˜Ÿåˆ—ä¸­ï¼Œç”±åè®®æ ˆå†…æ ¸å‘é€ï¼Œcopyä¸º0åˆ™ä¸ä¼šä¸ºå‘é€çš„æ•°æ®åˆ†é…æ–°çš„å†…å­˜ç©ºé—´</td></tr> <tr><td>void tcp_sent(struct tcp_pcb* pcb,err_t (*sent)(void* arg,struct tcp_pcb* tpcb,u16_t len))</td> <td>æŒ‡å®šå½“è¿œç¨‹ä¸»æœºæˆåŠŸæ¥æ”¶æ•°æ®åï¼Œåº”ç”¨ç¨‹åºè°ƒç”¨çš„å›è°ƒå‡½æ•°</td></tr> <tr><td>void tcp_recv(struct tcp_pcb* pcb,err_t (* recv)(void* arg,struct tcp_pcb* tpcb,struct pbuf* p,err_t err))</td> <td>æŒ‡å®šæ¥æ”¶æ•°æ®æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°</td></tr> <tr><td>void tcp_recved(struct tcp_pcb* pcb,u16_t len)</td> <td>ç”¨äºè·å–æ¥æ”¶åˆ°çš„æ•°æ®çš„é•¿åº¦ï¼Œå¿…é¡»åœ¨tcp_recvæŒ‡å®šçš„å›è°ƒå‡½æ•°ä¸­è¢«è°ƒç”¨</td></tr> <tr><td>err_t tcp_close(struct tcp_pcb* pcb)</td> <td>å…³é—­ä¸€ä¸ªæŒ‡å®šçš„TCPè¿æ¥ï¼Œè°ƒç”¨è¯¥å‡½æ•°åå°†ä¼šé‡Šæ”¾pcbæ§åˆ¶å—æ‰€å ç”¨çš„å†…å­˜ç©ºé—´</td></tr> <tr><td>void tcp_abort(struct tcp_pcb* pcb)</td> <td>ç»ˆæ­¢ä¸€ä¸ªæŒ‡å®šçš„è¿æ¥ï¼Œè°ƒç”¨è¯¥å‡½æ•°åï¼Œpcbæ§åˆ¶å—æ‰€å ç”¨çš„å†…å­˜ç©ºé—´å°†è¢«é‡Šæ”¾</td></tr> <tr><td>void tcp_err(struct tcp_pcb* pcb,void (*err)(void* arg,err_t err))</td> <td>æŒ‡å®šå¤„ç†é”™è¯¯çš„å›è°ƒå‡½æ•°</td></tr></tbody></table> <h3 id="tcp-raw-api-2"><a href="#tcp-raw-api-2" aria-hidden="true" class="header-anchor">#</a> TCP RAW API</h3> <p><img src="https://s1.ax1x.com/2018/08/10/P6lLHU.png" alt="UDP RAW API"></p> <h3 id="netconn-api"><a href="#netconn-api" aria-hidden="true" class="header-anchor">#</a> Netconn API</h3> <ul><li>æ•°æ®ç»“æ„netconnæè¿°äº†åº”ç”¨ç¨‹åºè¦ä½¿ç”¨APIå‡½æ•°æœºé‚£é‡Œä¸€ä¸ªè¿æ¥çš„å„ç§å±æ€§ï¼ŒåŒ…æ‹¬äº†è¿æ¥çš„ç±»å‹ã€æœ€è¿‘çš„æ•…éšœä»£ç ã€å›è°ƒå‡½æ•°ç­‰ã€‚</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/** A netconn descriptor */</span>
<span class="token keyword">struct</span> <span class="token class-name">netconn</span> <span class="token punctuation">{</span>
  <span class="token comment">/** type of the netconn (TCP, UDP or RAW) */</span>
  <span class="token keyword">enum</span> <span class="token class-name">netconn_type</span> type<span class="token punctuation">;</span>
  <span class="token comment">/** current state of the netconn */</span>
  <span class="token keyword">enum</span> <span class="token class-name">netconn_state</span> state<span class="token punctuation">;</span>
  <span class="token comment">/** the lwIP internal protocol control block */</span>
  <span class="token keyword">union</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">ip_pcb</span>  <span class="token operator">*</span>ip<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">tcp_pcb</span> <span class="token operator">*</span>tcp<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">udp_pcb</span> <span class="token operator">*</span>udp<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">raw_pcb</span> <span class="token operator">*</span>raw<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> pcb<span class="token punctuation">;</span>
  <span class="token comment">/** the last error this netconn had */</span>
  err_t last_err<span class="token punctuation">;</span>
  
<span class="token macro property">#<span class="token directive keyword">if</span> !LWIP_NETCONN_SEM_PER_THREAD</span>
  <span class="token comment">/** sem that is used to synchronously execute functions in the core context */</span>
  sys_sem_t op_completed<span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>

  <span class="token comment">/** mbox where received packets are stored until they are fetched
      by the netconn application thread (can grow quite big) */</span>
  sys_mbox_t recvmbox<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_TCP</span>
  <span class="token comment">/** mbox where new connections are stored until processed
      by the application thread */</span>
  sys_mbox_t acceptmbox<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_TCP */</span>
  <span class="token comment">/** only used for socket layer */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_SOCKET</span>
  <span class="token keyword">int</span> socket<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_SOCKET */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_SO_SNDTIMEO</span>
  <span class="token comment">/** timeout to wait for sending data (which means enqueueing data for sending
      in internal buffers) in milliseconds */</span>
  s32_t send_timeout<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_SO_RCVTIMEO */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_SO_RCVTIMEO</span>
  <span class="token comment">/** timeout in milliseconds to wait for new data to be received
      (or connections to arrive for listening netconns) */</span>
  <span class="token keyword">int</span> recv_timeout<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_SO_RCVTIMEO */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_SO_RCVBUF</span>
  <span class="token comment">/** maximum amount of bytes queued in recvmbox
      not used for TCP: adjust TCP_WND instead! */</span>
  <span class="token keyword">int</span> recv_bufsize<span class="token punctuation">;</span>
  <span class="token comment">/** number of bytes currently in recvmbox to be received,
      tested against recv_bufsize to limit bytes on recvmbox
      for UDP and RAW, used for FIONREAD */</span>
  <span class="token keyword">int</span> recv_avail<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_SO_RCVBUF */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_SO_LINGER</span>
   <span class="token comment">/** values &lt;0 mean linger is disabled, values &gt; 0 are seconds to linger */</span>
  s16_t linger<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_SO_LINGER */</span>
  <span class="token comment">/** flags holding more netconn-internal state, see NETCONN_FLAG_* defines */</span>
  u8_t flags<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LWIP_TCP</span>
  <span class="token comment">/** TCP: when data passed to netconn_write doesn't fit into the send buffer,
      this temporarily stores how much is already sent. */</span>
  size_t write_offset<span class="token punctuation">;</span>
  <span class="token comment">/** TCP: when data passed to netconn_write doesn't fit into the send buffer,
      this temporarily stores the message.
      Also used during connect and close. */</span>
  <span class="token keyword">struct</span> <span class="token class-name">api_msg_msg</span> <span class="token operator">*</span>current_msg<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* LWIP_TCP */</span>
  <span class="token comment">/** A callback function that is informed about events for this netconn */</span>
  netconn_callback callback<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p><img src="https://s1.ax1x.com/2018/08/10/P61AED.png" alt="Netconn API"></p> <table><thead><tr><th>å‡½æ•°</th> <th>è¯´æ˜</th></tr></thead> <tbody><tr><td>struct netconn* netconn_new_with_proto_and_callback(enum netconn_type t,u8_t proto,netconn_callback callback)</td> <td>å»ºç«‹ä¸€ä¸ªæ–°çš„netconnè¿æ¥</td></tr> <tr><td>err_t netconn_delete(struct netconn* conn)</td> <td>åˆ é™¤netconnæ‰€æŒ‡å‘çš„è¿æ¥</td></tr> <tr><td>err_t netconn_getaddr(struct netconn* conn,struct ip_addr* addr,u16_t* port,u8_t local)</td> <td>è·å–connè¿æ¥çš„ä¸»æœºIPåœ°å€å’Œç«¯å£å·</td></tr> <tr><td>err_t netconn_bind(struct netconn* conn,struct ip_addr* addr,u16_t port)</td> <td>å°†ä¸€ä¸ªIPåœ°å€åŠç«¯å£å·ä¸connæŒ‡å‘çš„è€Œè¿æ¥ç»‘å®š</td></tr> <tr><td>err_t netconn_connect(struct netconn* conn,struct ip_addr* addr,u16_t port)</td> <td>å°†æœåŠ¡å™¨ç«¯çš„IPåœ°å€å’Œç«¯å£å·ä¸connæŒ‡å‘çš„è¿æ¥ç»‘å®š</td></tr> <tr><td>err_t netconn_disconnect(struct netconn* conn)</td> <td>æ–­å¼€connæŒ‡å‘çš„è¿æ¥</td></tr> <tr><td>err_t netconn_listen_with_backlog(struct netconn* connï¼Œu8_t backlog)</td> <td>å°†connæŒ‡å‘çš„è¿æ¥è®¾å®šä¸ºç›‘å¬çŠ¶æ€</td></tr> <tr><td>struct netconn* netconn_accept(struct netconn* conn)</td> <td>æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œè¯¥å‡½æ•°ä¼šé˜»å¡åœ¨acceptmboxé‚®ç®±ä¸Š</td></tr> <tr><td>struct netbuf* netconn_recv(struct netconn* conn)</td> <td>æ¥æ”¶æ•°æ®ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®è¢«å°è£…ä¸ºnetbufç»“æ„</td></tr> <tr><td>err_t netconn_sendto(struct netconn* conn,struct netbuf* buf,struct ip_addr* addr,u16_t port)</td> <td>å‘ä¸€ä¸ªæŒ‡å®šçš„IPåœ°å€å’Œç«¯å£å·å‘é€æ•°æ®ï¼Œè¿™ä¸ªå‡½æ•°åªèƒ½ç”¨åœ¨connç±»å‹ä¸ºUDPæˆ–è€…RAWçš„è¿æ¥ä¸­</td></tr> <tr><td>err_t netconn_write(struct netconn* conn,const void* dataptr,size_t size,u8_t apiflag)</td> <td>å‘ç›¸åº”çš„TCPè¿æ¥ä¸Šå‘é€æ•°æ®ï¼Œè¿™ä¸ªå‡½æ•°åªèƒ½ç”¨äºå‘é€TCPçš„æŠ¥æ–‡</td></tr> <tr><td>err_t nnetconn_close(struct netconn* conn)</td> <td>å…³é—­connæŒ‡å‘çš„è¿æ¥</td></tr></tbody></table> <ul><li>netconn_new_with_proto_and_callbacké¦–å…ˆè°ƒç”¨netconn_allocå‡½æ•°åˆ†é…å¹¶åˆå§‹åŒ–ä¸€ä¸ªnetconnç»“æ„ï¼Œæ¥ä¸‹æ¥è¯¥å‡½æ•°ä¼šæ„å»ºä¸€ä¸ªapi_msgæ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯è¦æ±‚å†…æ ¸æ‰§è¡Œå‡½æ•°do_newconnï¼Œæœ€åè°ƒç”¨å‡½æ•°tcpip_apimsgæ¥å°†æ¶ˆæ¯åŒ…è£…æˆtcpip_msgç»“æ„å¹¶å‘é€å‡ºå»ã€‚tcpip_threadå‡½æ•°è§£æè¯¥æ¶ˆæ¯å¹¶è°ƒç”¨å‡½æ•°do_newconnï¼Œdo_newconnæ ¹æ®å‚æ•°çš„ç±»å‹è°ƒç”¨å‡½æ•°tcp_newåˆ›å»ºä¸€ä¸ªTCPæ§åˆ¶å—</li> <li>tcpip_threadæ˜¯å¤„ç†TCP/IPçš„å†…æ ¸åè®®æ ˆè¿›ç¨‹ï¼Œå®ƒåªæ¥æ”¶tcpip_msgç»“æ„å°è£…çš„æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®æ¶ˆæ¯çš„ç±»å‹æ¥åˆ¤å®šè¯¥æ¶ˆæ¯æ¥è‡ªç‰©ç†ç½‘å¡æˆ–åº”ç”¨å±‚ç¨‹åºã€‚å¦‚æœæ¥æ”¶åˆ°ç½‘å¡çš„IPæŠ¥æ–‡ï¼Œåˆ™å°†è¯¥æŠ¥æ–‡é€’äº¤ç»™ip_inputå‡½æ•°ï¼›å¦‚æœæ˜¯åº”ç”¨å±‚ç¨‹åºå‘é€çš„æ¶ˆæ¯ï¼Œåˆ™é€šè¿‡è°ƒç”¨æ¶ˆæ¯æŒ‡å®šçš„å†…æ ¸å¤„ç†å‡½æ•°æ¥å®Œæˆç›¸åº”çš„åŠŸèƒ½</li></ul> <h3 id="socket-api"><a href="#socket-api" aria-hidden="true" class="header-anchor">#</a> Socket API</h3> <blockquote><p>LwIPæä¾›äº†æ ‡å‡†BSDå¥—æ¥å­—APIï¼Œå®ƒä¹Ÿæ˜¯æœ‰åºAPIï¼Œåœ¨å†…å­˜æ„å»ºäºNetconn APIä¹‹ä¸Šã€‚æ‰€è°“â€œæœ‰åºâ€æ˜¯æŒ‡å…¶æ‰§è¡Œæ¨¡å‹åŸºäºå…¸å‹çš„é˜»å¡å¼æ‰“å¼€-è¯»-å†™-å…³é—­æœºåˆ¶ã€‚</p></blockquote> <p><img src="https://s1.ax1x.com/2018/08/10/P61V4H.png" alt="Socket API"></p> <h2 id="lwipç§»æ¤"><a href="#lwipç§»æ¤" aria-hidden="true" class="header-anchor">#</a> LwIPç§»æ¤</h2> <blockquote><ol><li>ä»¥å¤ªç½‘æ¥å£ä»»åŠ¡ç”¨äºæ¥æ”¶æ¥è‡ªç‰©ç†ç½‘å¡çš„æ•°æ®æŠ¥æ–‡ï¼ŒåŒæ—¶å°†æ”¶åˆ°çš„æŠ¥æ–‡é€šè¿‡FreeRTOSæä¾›çš„é‚®ç®±ä¼ é€’ç»™TCP/IPåè®®æ ˆä»»åŠ¡ã€‚ä»¥å¤ªç½‘æ¥å£ä»»åŠ¡å¹³æ—¶å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œå½“ç¡¬ä»¶æ”¶åˆ°æŠ¥æ–‡æ—¶ï¼Œå°†äº§ç”Ÿæ¥æ”¶æŠ¥æ–‡ä¸­æ–­ï¼Œè¯¥ç»ˆç«¯ä»¥ä¿¡å·é‡çš„æ–¹å¼å°†ä»¥å¤ªç½‘æ¥å£ä»»åŠ¡æ¿€æ´»</li> <li>åº”ç”¨ç¨‹åºä½¿ç”¨TCP/IPåè®®æ ˆæä¾›çš„Sequential APIæ¥å£è®¿é—®LwIPï¼ŒåŒæ—¶è¿™ä¸¤ä¸ªç‹¬ç«‹çš„ä»»åŠ¡éœ€è¦ä½¿ç”¨FreeRTOSæä¾›çš„é‚®ç®±æœºåˆ¶å®ç°å½¼æ­¤ä¹‹é—´ä¿¡æ¯çš„äº¤äº’ã€‚Sequential APIæ¥å£å‡½æ•°åœ¨FreeRTOSæ“ä½œç³»ç»Ÿè¿è¡Œç¯å¢ƒä¸‹æ˜¯â€œé˜»å¡â€å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´åº”ç”¨ç¨‹åºä»»åŠ¡åœ¨è°ƒç”¨Sequential APIæ¥å£å‡½æ•°æ—¶ï¼Œå°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°æ¥è‡ªTCP/IPåè®®æ ˆè¿”å›çš„æ¶ˆæ¯åº”ç­”</li> <li>åŸºäºLwIPçš„TCP/IPåè®®æ ˆä¸åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ä¸¤ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ä¸­</li></ol></blockquote> <p><img src="https://s1.ax1x.com/2018/08/09/PyyVRx.jpg" alt="ç½‘å¡é©±åŠ¨ç§»æ¤"></p> <ol><li>ä»¥å¤ªç½‘æ¥å£æ–‡ä»¶ethernetif.cçš„ç§»æ¤ï¼Œä¸»è¦åŒ…å«<code>ethernet_low_level_init</code>ï¼Œ<code>ethernet_low_level_output</code>ï¼Œ<code>ethernetif_input</code>ï¼Œ<code>ethernetif_init</code>è¿™å‡ ä¸ªå‡½æ•°çš„åŠŸèƒ½
<ul><li><code>ethernetif_input</code>å‡½æ•°ç”¨äºä»åº•å±‚ç‰©ç†ç½‘å¡è¯»å–æŠ¥æ–‡ï¼Œå¹¶å°†è¯¥æŠ¥æ–‡å‘ä¸Šä¼ é€’ç»™LwIPåè®®æ ˆå‡½æ•°ethernet_inputè¿›è¡Œå¤„ç†</li> <li><code>ethernetif_init</code>å‡½æ•°æŒ‡å®šäº†ç½‘ç»œæ¥å£netifå¯¹åº”çš„ä¸»æœºååŠç½‘å¡æè¿°ï¼Œå¹¶æŒ‡å®šäº†è¯¥ç½‘å¡çš„MACåœ°å€ï¼ŒåŒäº‹è¿˜æŒ‡å®šäº†netifçš„å‘é€æ•°æ®æŠ¥æ–‡å‡½æ•°</li></ul></li> <li>æ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿå±‚æ–‡ä»¶sys_arch.cçš„ç§»æ¤ï¼Œæ€»çš„æ¥æ—¶æ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿå±‚ä¸»è¦å®Œæˆäº†ä¸ä¿¡å·é‡ã€æ¶ˆæ¯é‚®ç®±æœºåˆ¶ã€çº¿ç¨‹ç›¸å…³çš„åŠŸèƒ½
<ul><li>åœ¨sys_arch.hæ–‡ä»¶ä¸­å¯¹ä¿¡å·é‡ã€é‚®ç®±ã€çº¿ç¨‹å¯¹è±¡è¿›è¡Œé‡å®šä¹‰</li> <li>sys_mbox_newå‡½æ•°ï¼Œä½¿ç”¨FreeRTOSæä¾›çš„æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶åˆ›å»ºä¸€ä¸ªç©ºçš„æ¶ˆæ¯é˜Ÿåˆ—</li> <li>sys_mbox_freeå‡½æ•°ï¼Œåˆ é™¤ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå½“è¯¥é˜Ÿåˆ—ä¸­è¿˜æœ‰æœªè¢«å–å‡ºçš„æ¶ˆæ¯æ—¶ï¼Œè¯¥å‡½æ•°åº”å½“æŠ¥é”™ï¼Œå¹¶é€šçŸ¥åº”ç”¨ç¨‹åº</li> <li>sys_mbox_postå‡½æ•°ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œè¯¥å‡½æ•°æ˜¯ä¸€ä¸ªé˜»å¡å‡½æ•°ï¼Œå½“æ¶ˆæ¯è¢«å‘é€è‡³é˜Ÿåˆ—åï¼Œè¯¥å‡½æ•°æ‰ä¼šé€€å‡ºé˜»å¡çŠ¶æ€</li> <li>sys_mbox_trypostå‡½æ•°ï¼Œç”¨äºå°è¯•å°†æŸä¸ªæ¶ˆæ¯å‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå½“æ¶ˆæ¯è¢«æˆåŠŸæŠ•é€’åï¼Œåˆ™è¿”å›æˆåŠŸï¼Œå¦åˆ™è¿”å›å¤±è´¥</li> <li>sys_arch_mbox_fetchå‡½æ•°ï¼Œç”¨äºä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºä¸€æ¡æ¶ˆæ¯ï¼Œè¯¥å‡½æ•°æ˜¯ä¸€ä¸ªé˜»å¡å‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹è‹¥æœªå–åˆ°æ¶ˆæ¯ï¼Œåˆ™åœ¨å½¢å‚timeoutæ‰€æŒ‡å®šçš„æ—¶é—´å†…ï¼Œè¯¥çº¿ç¨‹è¢«é˜»å¡ã€‚å½“è¶…è¿‡timeoutæ‰€æŒ‡å®šçš„æ—¶é—´åï¼Œè¯¥çº¿ç¨‹æ¢å¤è‡³å°±ç»ªçŠ¶æ€ã€‚è‹¥timeoutä¸º0ï¼Œåˆ™è°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹ä¸€ç›´è¢«é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°æ¶ˆæ¯</li> <li>sys_arch_mbox_tryfetchå‡½æ•°å°è¯•ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªéé˜»å¡å‡½æ•°ï¼Œå½“å–åˆ°æ¶ˆæ¯æ—¶ï¼Œåˆ™è¿”å›æˆåŠŸï¼Œå¦åˆ™ç«‹å³é€€å‡ºï¼Œè¿”å›é˜Ÿåˆ—ç©º</li> <li>sys_sem_newå‡½æ•°åˆ›å»ºä¸€ä¸ªä¿¡å·é‡ï¼Œå¹¶æ ¹æ®å½¢å‚çš„å€¼æŒ‡å®šå¥½å½“å‰ä¿¡å·é‡çš„çŠ¶æ€</li> <li>sys_arch_sem_waitå‡½æ•°åœ¨å½¢å‚timeoutæŒ‡å®šçš„æ—¶é—´è¢«é˜»å¡ï¼Œè‹¥timeoutä¸º0ï¼Œåˆ™è°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹å°†ä¸€ç›´è¢«é˜»å¡ï¼Œç›´åˆ°ç­‰å¾…çš„ä¿¡å·é‡è¢«é‡Šæ”¾ã€‚ä½†è¯¥å‡½æ•°å–åˆ°ä¿¡å·é‡æ—¶ï¼Œå®ƒå°†è¿”å›å–åˆ°çš„è¯¥ä¿¡å·é‡æ‰€å çš„æ—¶é—´</li> <li>sys_sem_signalå‡½æ•°ç”¨äºé‡Šæ”¾ä¸€ä¸ªä¿¡å·é‡</li> <li>sys_sem_freeå‡½æ•°ç”¨äºåˆ é™¤ä¸€ä¸ªä¿¡å·é‡</li> <li>sys_thread_newå‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹</li> <li>sys_initå‡½æ•°æ˜¯æ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿå±‚çš„åˆå§‹åŒ–å‡½æ•°ï¼Œä¸»è¦å¯¹å®šæ—¶å™¨ç®¡ç†æ•°ç»„è¿›è¡Œäº†åˆå§‹åŒ–</li> <li>sys_zrch_timeoutså‡½æ•°ç”¨äºè¿”å›å½“å‰ä»»åŠ¡çš„å®šæ—¶å™¨ç®¡ç†é“¾è¡¨é¦–åœ°å€</li> <li>sys_arch_protectå‡½æ•°å’Œsys_arch_unprotectå‡½æ•°åœ¨è®¿é—®ä¸´ç•ŒåŒºèµ„æºæ—¶æˆå¯¹ä½¿ç”¨</li></ul></li> <li>ethernet_inputå‡½æ•°çš„å®ç°åœ¨ç‹¬ç«‹æ¨¡å¼å’ŒRTOSæ¨¡å¼æ—¶æ˜¯ä¸åŒçš„ï¼š
<ul><li>åœ¨ç‹¬ç«‹åº”ç”¨ä¸­ï¼Œæ­¤å‡½æ•°å¿…é¡»è¢«æ’å…¥åˆ°åº”ç”¨çš„ä¸»å¾ªç¯ä¸­ï¼Œä»¥ä¾¿è½®è¯¢ä»»ä½•æ”¶åˆ°çš„åŒ…</li> <li>åœ¨RTOSåº”ç”¨ä¸­ï¼Œæ­¤å‡½æ•°ä¸ºä¸€ä¸ªé˜»å¡çº¿ç¨‹ï¼Œåªæœ‰å½“å¾—åˆ°æ‰€ç­‰å¾…çš„ä¿¡å·é‡æ—¶æ‰å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ã€‚å½“ä»¥å¤ªç½‘å¤–è®¾æ”¶åˆ°æ•°æ®å¹¶äº§ç”Ÿä¸­æ–­æ—¶ï¼Œä¼šåœ¨ä¸­æ–­å¤„ç†å‡½æ•°ä¸­é‡Šæ”¾æ­¤ä¿¡å·é‡</li></ul></li></ol> <h2 id="lwipé…ç½®"><a href="#lwipé…ç½®" aria-hidden="true" class="header-anchor">#</a> LwIPé…ç½®</h2> <blockquote><p>LwIPæä¾›äº†åä¸ºlwipopts.hçš„æ–‡ä»¶ï¼Œå®ƒå…è®¸ç”¨æˆ·å……åˆ†é…ç½®æ ˆåŠå…¶æ‰€æœ‰æ¨¡å—ã€‚ç”¨æˆ·ä¸éœ€è¦å®šä¹‰æ‰€æœ‰LwIPé€‰é¡¹ï¼šå¦‚æœæœªå®šä¹‰æŸé€‰é¡¹ï¼Œåˆ™ä½¿ç”¨opt.hæ–‡ä»¶ä¸­å®šä¹‰çš„é»˜è®¤å€¼</p></blockquote> <ul><li>å†…å­˜é…ç½®</li></ul> <p><img src="https://s1.ax1x.com/2018/08/10/P6GG5D.png" alt="LwIPå†…å­˜é…ç½®"></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/suda-morris/blog/edit/master/docs/others/lwip.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘æ­¤é¡µé¢</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°: </span> <span class="time">4/29/2019, 1:16:38 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.4f851d87.js" defer></script><script src="/blog/assets/js/2.4a73e09d.js" defer></script><script src="/blog/assets/js/42.d8d152e7.js" defer></script><script src="/blog/assets/js/3.b11672f7.js" defer></script>
  </body>
</html>

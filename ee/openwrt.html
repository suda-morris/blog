<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>𝙊𝙥𝙚𝙣𝙒𝙧𝙩 基础 | suda-morris 个人博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/favicon.png">
    <link rel="manifest" href="/blog/manifest.json">
    <meta name="description" content="记录学习生活，探索未知领域">
    
    <link rel="preload" href="/blog/assets/css/0.styles.6d8afabb.css" as="style"><link rel="preload" href="/blog/assets/js/app.f7371fc1.js" as="script"><link rel="preload" href="/blog/assets/js/4.86db7451.js" as="script"><link rel="preload" href="/blog/assets/js/40.7af103e2.js" as="script"><link rel="preload" href="/blog/assets/js/13.4f481eb8.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d57735f5.js"><link rel="prefetch" href="/blog/assets/js/11.32df3512.js"><link rel="prefetch" href="/blog/assets/js/12.4034ef2f.js"><link rel="prefetch" href="/blog/assets/js/14.59cf0e7f.js"><link rel="prefetch" href="/blog/assets/js/15.c8959e95.js"><link rel="prefetch" href="/blog/assets/js/16.ffd1339b.js"><link rel="prefetch" href="/blog/assets/js/17.7b5dae56.js"><link rel="prefetch" href="/blog/assets/js/18.8697be37.js"><link rel="prefetch" href="/blog/assets/js/19.7515aa84.js"><link rel="prefetch" href="/blog/assets/js/2.f785d2c1.js"><link rel="prefetch" href="/blog/assets/js/20.675d2d6b.js"><link rel="prefetch" href="/blog/assets/js/21.5b1ed3ba.js"><link rel="prefetch" href="/blog/assets/js/22.b0f3c0c2.js"><link rel="prefetch" href="/blog/assets/js/23.e85250c5.js"><link rel="prefetch" href="/blog/assets/js/24.e25d5894.js"><link rel="prefetch" href="/blog/assets/js/25.ab70bdf8.js"><link rel="prefetch" href="/blog/assets/js/26.30c40f25.js"><link rel="prefetch" href="/blog/assets/js/27.98475093.js"><link rel="prefetch" href="/blog/assets/js/28.a550e4dc.js"><link rel="prefetch" href="/blog/assets/js/29.046f7e94.js"><link rel="prefetch" href="/blog/assets/js/3.0f1a8f79.js"><link rel="prefetch" href="/blog/assets/js/30.fced83cb.js"><link rel="prefetch" href="/blog/assets/js/31.6928eb70.js"><link rel="prefetch" href="/blog/assets/js/32.b6a3f81d.js"><link rel="prefetch" href="/blog/assets/js/33.bf2721b1.js"><link rel="prefetch" href="/blog/assets/js/34.56c51ffd.js"><link rel="prefetch" href="/blog/assets/js/35.6c1d065e.js"><link rel="prefetch" href="/blog/assets/js/36.c1e95b2c.js"><link rel="prefetch" href="/blog/assets/js/37.2f057b97.js"><link rel="prefetch" href="/blog/assets/js/38.2506f779.js"><link rel="prefetch" href="/blog/assets/js/39.ae17cd2e.js"><link rel="prefetch" href="/blog/assets/js/41.7e0c4fd2.js"><link rel="prefetch" href="/blog/assets/js/42.b7df5389.js"><link rel="prefetch" href="/blog/assets/js/43.ce0c76ac.js"><link rel="prefetch" href="/blog/assets/js/44.74acb7f6.js"><link rel="prefetch" href="/blog/assets/js/45.209d70ba.js"><link rel="prefetch" href="/blog/assets/js/46.446b24cf.js"><link rel="prefetch" href="/blog/assets/js/47.cc7c15cb.js"><link rel="prefetch" href="/blog/assets/js/48.d8003d98.js"><link rel="prefetch" href="/blog/assets/js/49.d8a0e817.js"><link rel="prefetch" href="/blog/assets/js/5.cc2c00ae.js"><link rel="prefetch" href="/blog/assets/js/50.28bf0451.js"><link rel="prefetch" href="/blog/assets/js/51.29f7f8e6.js"><link rel="prefetch" href="/blog/assets/js/52.2663a05a.js"><link rel="prefetch" href="/blog/assets/js/53.9ce47afe.js"><link rel="prefetch" href="/blog/assets/js/54.e187ec7a.js"><link rel="prefetch" href="/blog/assets/js/55.2eda951a.js"><link rel="prefetch" href="/blog/assets/js/56.49fca5f7.js"><link rel="prefetch" href="/blog/assets/js/57.57168edc.js"><link rel="prefetch" href="/blog/assets/js/58.aa2bd46e.js"><link rel="prefetch" href="/blog/assets/js/59.cbfa961c.js"><link rel="prefetch" href="/blog/assets/js/6.cc76698f.js"><link rel="prefetch" href="/blog/assets/js/60.56cb85bf.js"><link rel="prefetch" href="/blog/assets/js/61.3b05db21.js"><link rel="prefetch" href="/blog/assets/js/62.a253c43f.js"><link rel="prefetch" href="/blog/assets/js/63.665b3419.js"><link rel="prefetch" href="/blog/assets/js/64.81d19861.js"><link rel="prefetch" href="/blog/assets/js/65.4a6980eb.js"><link rel="prefetch" href="/blog/assets/js/66.1d662c87.js"><link rel="prefetch" href="/blog/assets/js/67.2fa6ac31.js"><link rel="prefetch" href="/blog/assets/js/68.755cdf7f.js"><link rel="prefetch" href="/blog/assets/js/69.3035c303.js"><link rel="prefetch" href="/blog/assets/js/7.3616dd49.js"><link rel="prefetch" href="/blog/assets/js/70.d9d4a8ee.js"><link rel="prefetch" href="/blog/assets/js/71.73cc51c4.js"><link rel="prefetch" href="/blog/assets/js/72.efd94039.js"><link rel="prefetch" href="/blog/assets/js/73.059d55ba.js"><link rel="prefetch" href="/blog/assets/js/74.4ad46ecd.js"><link rel="prefetch" href="/blog/assets/js/75.34c15c92.js"><link rel="prefetch" href="/blog/assets/js/76.1b725aa4.js"><link rel="prefetch" href="/blog/assets/js/77.50e92786.js"><link rel="prefetch" href="/blog/assets/js/78.e8947189.js"><link rel="prefetch" href="/blog/assets/js/79.0f0918b7.js"><link rel="prefetch" href="/blog/assets/js/8.25f08ec4.js"><link rel="prefetch" href="/blog/assets/js/80.66771e2f.js"><link rel="prefetch" href="/blog/assets/js/81.9de4e215.js"><link rel="prefetch" href="/blog/assets/js/82.7d56175f.js"><link rel="prefetch" href="/blog/assets/js/83.fa751f46.js"><link rel="prefetch" href="/blog/assets/js/84.5039ce08.js"><link rel="prefetch" href="/blog/assets/js/85.29f3100c.js"><link rel="prefetch" href="/blog/assets/js/86.f2989267.js"><link rel="prefetch" href="/blog/assets/js/87.d8d55a52.js"><link rel="prefetch" href="/blog/assets/js/88.151d8cdc.js"><link rel="prefetch" href="/blog/assets/js/89.7bd0925d.js"><link rel="prefetch" href="/blog/assets/js/9.51fef0b5.js"><link rel="prefetch" href="/blog/assets/js/90.af7f69c8.js"><link rel="prefetch" href="/blog/assets/js/91.22eec426.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.6d8afabb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">suda-morris 个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/cs/" class="nav-link">
  CS
</a></div><div class="nav-item"><a href="/blog/ee/" class="nav-link router-link-active">
  EE
</a></div><div class="nav-item"><a href="/blog/others/" class="nav-link">
  Others
</a></div> <a href="https://github.com/suda-morris/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/cs/" class="nav-link">
  CS
</a></div><div class="nav-item"><a href="/blog/ee/" class="nav-link router-link-active">
  EE
</a></div><div class="nav-item"><a href="/blog/others/" class="nav-link">
  Others
</a></div> <a href="https://github.com/suda-morris/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/blog/ee/about.html" class="sidebar-link">关于本栏目</a></li><li><a href="/blog/ee/chisel.html" class="sidebar-link">𝘾𝙝𝙞𝙨𝙚𝙡 3 基础</a></li><li><a href="/blog/ee/esp32.html" class="sidebar-link">𝙀𝙎𝙋 32 功能介绍</a></li><li><a href="/blog/ee/infrared_remote.html" class="sidebar-link">𝙄𝙣𝙛𝙧𝙖𝙧𝙚𝙙 𝙍𝙚𝙢𝙤𝙩𝙚 基础</a></li><li><a href="/blog/ee/motor_control.html" class="sidebar-link">电机基础</a></li><li><a href="/blog/ee/openwrt.html" aria-current="page" class="active sidebar-link">𝙊𝙥𝙚𝙣𝙒𝙧𝙩 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#flash-分区" class="sidebar-link">Flash 分区</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#文件系统" class="sidebar-link">文件系统</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#软件包管理器-opkg" class="sidebar-link">软件包管理器 OPKG</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#uci-命令系统" class="sidebar-link">UCI 命令系统</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#常用配置操作" class="sidebar-link">常用配置操作</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#防火墙" class="sidebar-link">防火墙</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#ntp" class="sidebar-link">NTP</a></li><li class="sidebar-sub-header"><a href="/blog/ee/openwrt.html#服务管理" class="sidebar-link">服务管理</a></li></ul></li><li><a href="/blog/ee/usb.html" class="sidebar-link">𝑼𝑺𝑩 基础</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="openwrt-基础"><a href="#openwrt-基础" class="header-anchor">#</a> 𝙊𝙥𝙚𝙣𝙒𝙧𝙩 基础</h1> <h2 id="flash-分区"><a href="#flash-分区" class="header-anchor">#</a> Flash 分区</h2> <p>Linux系统对闪存类存储器是采用MTD设备驱动实现的。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>    <span class="token number">0.290000</span><span class="token punctuation">]</span> spi-mt7621 10000b00.spi: sys_freq: <span class="token number">193333333</span>
<span class="token punctuation">[</span>    <span class="token number">0.300000</span><span class="token punctuation">]</span> m25p80 spi32766.0: w25q256 <span class="token punctuation">(</span><span class="token number">32768</span> Kbytes<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.300000</span><span class="token punctuation">]</span> m25p80 spi32766.0: using chunked io
<span class="token punctuation">[</span>    <span class="token number">0.310000</span><span class="token punctuation">]</span> <span class="token number">4</span> ofpart partitions found on MTD device spi32766.0
<span class="token punctuation">[</span>    <span class="token number">0.310000</span><span class="token punctuation">]</span> Creating <span class="token number">4</span> MTD partitions on <span class="token string">&quot;spi32766.0&quot;</span><span class="token builtin class-name">:</span>
<span class="token punctuation">[</span>    <span class="token number">0.320000</span><span class="token punctuation">]</span> 0x000000000000-0x000000030000 <span class="token builtin class-name">:</span> <span class="token string">&quot;u-boot&quot;</span>
<span class="token punctuation">[</span>    <span class="token number">0.320000</span><span class="token punctuation">]</span> 0x000000030000-0x000000040000 <span class="token builtin class-name">:</span> <span class="token string">&quot;u-boot-env&quot;</span>
<span class="token punctuation">[</span>    <span class="token number">0.330000</span><span class="token punctuation">]</span> 0x000000040000-0x000000050000 <span class="token builtin class-name">:</span> <span class="token string">&quot;factory&quot;</span>
<span class="token punctuation">[</span>    <span class="token number">0.340000</span><span class="token punctuation">]</span> 0x000000050000-0x000002000000 <span class="token builtin class-name">:</span> <span class="token string">&quot;firmware&quot;</span>
<span class="token punctuation">[</span>    <span class="token number">0.410000</span><span class="token punctuation">]</span> <span class="token number">2</span> uimage-fw partitions found on MTD device firmware
<span class="token punctuation">[</span>    <span class="token number">0.410000</span><span class="token punctuation">]</span> 0x000000050000-0x000000168da1 <span class="token builtin class-name">:</span> <span class="token string">&quot;kernel&quot;</span>
<span class="token punctuation">[</span>    <span class="token number">0.420000</span><span class="token punctuation">]</span> 0x000000168da1-0x000002000000 <span class="token builtin class-name">:</span> <span class="token string">&quot;rootfs&quot;</span>
<span class="token punctuation">[</span>    <span class="token number">0.420000</span><span class="token punctuation">]</span> mtd: device <span class="token number">5</span> <span class="token punctuation">(</span>rootfs<span class="token punctuation">)</span> <span class="token builtin class-name">set</span> to be root filesystem
<span class="token punctuation">[</span>    <span class="token number">0.430000</span><span class="token punctuation">]</span> <span class="token number">1</span> squashfs-split partitions found on MTD device rootfs
<span class="token punctuation">[</span>    <span class="token number">0.440000</span><span class="token punctuation">]</span> 0x000000620000-0x000002000000 <span class="token builtin class-name">:</span> <span class="token string">&quot;rootfs_data&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>系统在SPI设备上创建了4个MTD分区</p></div> <table><thead><tr><th>分区名</th> <th>分区作用</th></tr></thead> <tbody><tr><td>u-boot</td> <td>引导程序</td></tr> <tr><td>u-boot-env</td> <td>引导程序的配置数据</td></tr> <tr><td>factory</td> <td>路由器芯片的初始化参数</td></tr> <tr><td>firmware</td> <td>固件分区</td></tr> <tr><td>kernel</td> <td>固件分区<br>Linux 内核</td></tr> <tr><td>rootfs</td> <td>固件分区<br>文件系统子集</td></tr> <tr><td>rootfs_rom</td> <td>固件分区<br>文件系统子集<br>只读分区子集</td></tr> <tr><td>rootfs_data</td> <td>固件分区<br>文件系统子集<br>可写分区子集</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>分区存在子分区，kernel和rootfs就是firmware的子分区，rootfs_rom和rootfs_data就是rootfs的子分区。</p></div> <h3 id="查看系统-mtd-分配"><a href="#查看系统-mtd-分配" class="header-anchor">#</a> 查看系统 MTD 分配</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># cat /proc/mtd</span>
dev:    size   erasesize  name
mtd0: 00030000 00010000 <span class="token string">&quot;u-boot&quot;</span>
mtd1: 00010000 00010000 <span class="token string">&quot;u-boot-env&quot;</span>
mtd2: 00010000 00010000 <span class="token string">&quot;factory&quot;</span>
mtd3: 01fb0000 00010000 <span class="token string">&quot;firmware&quot;</span>
mtd4: 00118da1 00010000 <span class="token string">&quot;kernel&quot;</span>
mtd5: 01e9725f 00010000 <span class="token string">&quot;rootfs&quot;</span>
mtd6: 019e0000 00010000 <span class="token string">&quot;rootfs_data&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="查看系统-mtd-分配-2"><a href="#查看系统-mtd-分配-2" class="header-anchor">#</a> 查看系统 MTD 分配</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># cat /proc/partitions</span>
major   minor  <span class="token comment">#blocks    name</span>
<span class="token number">31</span>       <span class="token number">0</span>        <span class="token number">192</span>   mtdblock0
<span class="token number">31</span>       <span class="token number">1</span>         <span class="token number">64</span>   mtdblock1
<span class="token number">31</span>       <span class="token number">2</span>         <span class="token number">64</span>   mtdblock2
<span class="token number">31</span>       <span class="token number">3</span>      <span class="token number">32448</span>   mtdblock3
<span class="token number">31</span>       <span class="token number">4</span>       <span class="token number">1123</span>   mtdblock4
<span class="token number">31</span>       <span class="token number">5</span>      <span class="token number">31324</span>   mtdblock5
<span class="token number">31</span>       <span class="token number">6</span>      <span class="token number">26496</span>   mtdblock6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="读取-备份-factory-分区"><a href="#读取-备份-factory-分区" class="header-anchor">#</a> 读取/备份 factory 分区</h3> <p>factory 分区（位于 /dev/mtd2）保存了重要的配置参数（如MAC地址，天线匹配参数等）。</p> <h4 id="查看分区内容"><a href="#查看分区内容" class="header-anchor">#</a> 查看分区内容</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># hexdump /dev/mtd2</span>
0000000 <span class="token number">7628</span> 0001 ef0c d2af b8a9 0000 0000 0000
0000010 ffff ffff ffff ffff ffff ffff ffff ffff
0000020 0000 0000 0020 0000 ef0c d2af b8a9 ef0c
0000030 d2af b9a9 <span class="token number">3422</span> <span class="token number">2000</span> ffff 0100 0000 0000
0000040 0000 0022 0000 0000 0030 0000 0000 0000
0000050 0081 <span class="token number">9400</span> b040 c640 c31a c2c3 c5c0 0027
0000060 ffff ffff ffff ffff ffff ffff ffff ffff
*
00000a0 c6c6 c4c4 c0c4 c4c0 c4c4 c0c4 c0c0 0000
00000b0 ffff ffff ffff ffff ffff ffff ffff ffff
*
00000f0 0000 0000 00d1 <span class="token number">8800</span> 0000 0000 0000 0000
0000100 ffff ffff ffff ffff ffff ffff ffff ffff
*
0000120 0000 0000 0000 0000 0000 0000 0000 0077
0000130 1d11 1d11 7f15 7f15 7f17 7f17 3b10 3b10
0000140 ffff ffff ffff ffff ffff ffff ffff ffff
*
0010000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="备份分区"><a href="#备份分区" class="header-anchor">#</a> 备份分区</h4> <p>使用 <code>dd</code> 命令将分区读到一个文件中，然后使用浏览器下载到本地。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># dd if=/dev/mtd2 of=/www/art.bin</span>
<span class="token number">128</span>+0 records <span class="token keyword">in</span>
<span class="token number">128</span>+0 records out
root@Widora:~<span class="token comment"># ls -l /www/art.bin</span>
-rw-r--r--    <span class="token number">1</span> root     root         <span class="token number">65536</span> Apr <span class="token number">27</span> <span class="token number">18</span>:26 /www/art.bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="文件系统"><a href="#文件系统" class="header-anchor">#</a> 文件系统</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># df</span>
Filesystem           1K-blocks      Used Available Use% Mounted on
rootfs                   <span class="token number">26496</span>       <span class="token number">752</span>     <span class="token number">25744</span>   <span class="token number">3</span>% /
/dev/root                 <span class="token number">4864</span>      <span class="token number">4864</span>         <span class="token number">0</span> <span class="token number">100</span>% /rom
tmpfs                    <span class="token number">63232</span>        <span class="token number">84</span>     <span class="token number">63148</span>   <span class="token number">0</span>% /tmp
/dev/mtdblock6           <span class="token number">26496</span>       <span class="token number">752</span>     <span class="token number">25744</span>   <span class="token number">3</span>% /overlay
overlayfs:/overlay       <span class="token number">26496</span>       <span class="token number">752</span>     <span class="token number">25744</span>   <span class="token number">3</span>% /
tmpfs                      <span class="token number">512</span>         <span class="token number">0</span>       <span class="token number">512</span>   <span class="token number">0</span>% /dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol><li>引导程序启动内核完成后，由内核加载 <code>rootfs_rom</code> 只读分区来完成系统的初步启动。<code>rootfs_rom</code> 只读分区采用的是 Linux 内核支持的 <strong>squashFS</strong> 文件系统，加载完毕后将其挂载到 <code>/rom</code> 目录，同时也挂载为 <code>/</code> 目录。</li> <li>系统将使用 <strong>JFFS2</strong> 文件系统格式化的 <code>rootfs_data</code> 可写文件分区并将这部分挂载到 <code>/overlay</code> 目录。</li> <li>系统再将 <code>/overlay</code> 透明挂载为 <code>/</code> 根目录。</li> <li>最后将一部分内存挂载为<code>/tmp</code> 目录。</li></ol> <h3 id="透明挂载根目录"><a href="#透明挂载根目录" class="header-anchor">#</a> 透明挂载根目录 /</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>OpenWrt 设计的一个特点是：系统先将 <code>rootfs_rom</code> 挂载为 <code>/</code> 根目录，这样就具备了一个完整的系统，然后再将 <code>rootfs_data</code> 以透明方式挂载在 <code>/</code> 根目录上。</p></div> <ul><li>最终呈现的根文件系统是由 <code>rootfs_rom</code> 和 <code>rootfs_data</code> 两个分区组合在一起的效果。</li> <li>对任何文件的修改（增、删、改）都会记录在 <code>rootfs_data</code> 分区中。</li> <li>读取文件内容时，首先检测 <code>rootfs_data</code> 里的状态，再检测 <code>roots_rom</code> 里的内容，最后输出结果。</li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果修改了一个名为 abc 的文件，那么在 <code>/rom</code> 里还会保留修改之前的那个 abc 文件，同时在 <code>/overlay</code> 里有修改后的 abc 文件，因此所占的空间将会倍增。这样带来的一个好处是，在任何时候，只要删除 <code>/overlay</code> 里所有的文件，就能达到恢复出厂的效果。</p></div> <h3 id="常用文件夹"><a href="#常用文件夹" class="header-anchor">#</a> 常用文件夹</h3> <table><thead><tr><th>文件夹路径</th> <th>作用</th></tr></thead> <tbody><tr><td>/etc/</td> <td>存放系统所有的配置文件</td></tr> <tr><td>/etc/init.d/</td> <td>存放启动的服务脚本</td></tr> <tr><td>/etc/config/</td> <td>存放 OpenWrt 的配置文件，包括网络</td></tr> <tr><td>/tmp/</td> <td>存放临时文件和动态的配置文件</td></tr> <tr><td>/tmp/TZ</td> <td>系统启动后所使用的时区参数</td></tr></tbody></table> <h2 id="软件包管理器-opkg"><a href="#软件包管理器-opkg" class="header-anchor">#</a> 软件包管理器 OPKG</h2> <h3 id="配置-opkg"><a href="#配置-opkg" class="header-anchor">#</a> 配置 OPKG</h3> <p><code>/etc/opkg.conf</code> 文件保存 OPKG 相关设置：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># cat /etc/opkg.conf</span>
dest root /
dest <span class="token function">ram</span> /tmp
lists_dir ext /var/opkg-lists
option overlay_root /overlay
option check_signature <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><table><thead><tr><th>配置选项</th> <th>说明</th></tr></thead> <tbody><tr><td>dest root</td> <td>安装目标的跟路径</td></tr> <tr><td>dest ram</td> <td>内存临时文件路径</td></tr> <tr><td>lists_dir ext</td> <td>软件包列表文件</td></tr> <tr><td>option overlay_root</td> <td>可写分区挂载位置</td></tr></tbody></table> <h3 id="常用命令搭配"><a href="#常用命令搭配" class="header-anchor">#</a> 常用命令搭配</h3> <table><thead><tr><th>命令</th> <th>说明</th></tr></thead> <tbody><tr><td>opkg update</td> <td>下载服务器上可用的软件包列表</td></tr> <tr><td>opkg upgrade &lt;package&gt;</td> <td>升级软件包</td></tr> <tr><td>opkg install &lt;package&gt;</td> <td>安装软件包</td></tr> <tr><td>opkg configure &lt;package&gt;</td> <td>配置某一个软件包</td></tr> <tr><td>opkg remove &lt;package&gt;</td> <td>卸载软件包</td></tr> <tr><td>opkg list</td> <td>列出全部可用的软件包</td></tr> <tr><td>opkg list-installed</td> <td>列出已安装的软件包</td></tr> <tr><td>opkg list-upgradable</td> <td>列出可以升级的软件包</td></tr> <tr><td>opkg info [package|regexp]</td> <td>显示指定软件包的信息</td></tr> <tr><td>opkg status [package|regexp]</td> <td>显示指定软件包的状态</td></tr> <tr><td>opkg download &lt;package&gt;</td> <td>下载一个软件包到当前目录，但不安装</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>软件包列表可能会比较大，因此并不保存在系统中，每次启动需要首先执行 <code>opkg update</code> 取得最新的软件包。</p></div> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># opkg update</span>
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/base/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_base.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/base/Packages.sig.
Signature check passed.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/luci/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_luci.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/luci/Packages.sig.
Signature check passed.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/management/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_management.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/management/Packages.sig.
Signature check passed.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/packages/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_packages.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/packages/Packages.sig.
Signature check passed.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/routing/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_routing.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/routing/Packages.sig.
Signature check passed.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/telephony/Packages.gz.
Updated list of available packages <span class="token keyword">in</span> /var/opkg-lists/chaos_calmer_telephony.
Downloading http://downloads.openwrt.org/chaos_calmer/15.05.1/ramips/mt7688/packages/telephony/Packages.sig.
Signature check passed.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="uci-命令系统"><a href="#uci-命令系统" class="header-anchor">#</a> UCI 命令系统</h2> <p>UCI (Unified Configuration Interface) 是 OpenWrt 中配置参数管理系统，UCI 中已经包含了网络配置、无线配置、系统信息配置等基本路由器所需的主要配置参数。</p> <p>UCI 配置文件全部存储在 <code>/etc/config</code> 目录下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># ls /etc/config/</span>
dhcp           fstab          mountd         shairport      uhttpd
dropbear       luci           network        system         wireless
firewall       mjpg-streamer  rpcd           ucitrack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>常见的 UCI 配置：</p> <table><thead><tr><th>配置文件</th> <th>作用</th></tr></thead> <tbody><tr><td>/etc/config/dhcp</td> <td>面向 LAN 口提供的 IP 地址分配服务配置</td></tr> <tr><td>/etc/config/dropbear</td> <td>SSH 服务配置</td></tr> <tr><td>/etc/config/firewall</td> <td>路由转发，端口转发，防火墙规则</td></tr> <tr><td>/etc/config/network</td> <td>自身网络接口配置</td></tr> <tr><td>/etc/config/system</td> <td>时间服务器时区配置</td></tr> <tr><td>/etc/config/wireless</td> <td>无线网络配置</td></tr></tbody></table> <p>支持 UCI 管理模式的软件包是这样完成启动的（以 <strong>samba</strong> 软件为例）：</p> <ol><li>启动脚本 <code>/etc/init.d/samba</code></li> <li>启动脚本通过 UCI 分析库从 <code>/etc/config/samba</code> 获得启动参数</li> <li>启动脚本完成正常启动</li></ol> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>UCI 配置文件既可以使用 UCI 命令进行修改，也可以使用文本编辑器直接修改。但如果两种方式都使用，需要注意 UCI 命令修改会产生缓存，每次修改好要尽快保存确认，以免出现冲突。</p></div> <h3 id="uci-文件格式"><a href="#uci-文件格式" class="header-anchor">#</a> UCI 文件格式</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>config 'section-type' 'section'
	option 'key' 'value'
	option 'list_key' 'list_value1'
	option 'list_key' 'list_value2'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>UCI 允许只有 <strong>section-type</strong> 的匿名配置节点。</p></div> <h3 id="uci-命令读写配置"><a href="#uci-命令读写配置" class="header-anchor">#</a> UCI 命令读写配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>uci <span class="token punctuation">[</span><span class="token operator">&lt;</span>option<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>arguments<span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="读取类语法"><a href="#读取类语法" class="header-anchor">#</a> 读取类语法</h4> <table><thead><tr><th>命令</th> <th>说明</th></tr></thead> <tbody><tr><td>uci get &lt;config&gt;.&lt;section&gt;</td> <td>获取节点类型</td></tr> <tr><td>uci get &lt;config&gt;.&lt;section&gt;.&lt;option&gt;</td> <td>获取取得一个值</td></tr> <tr><td>uci show</td> <td>显示全部 UCI 配置</td></tr> <tr><td>uci show &lt;config&gt;</td> <td>显示指定文件配置</td></tr> <tr><td>uci show &lt;config&gt;.&lt;section&gt;</td> <td>显示指定节点的配置</td></tr> <tr><td>uci show &lt;config&gt;.&lt;section&gt;.&lt;option&gt;</td> <td>显示指定选项配置</td></tr> <tr><td>uci changes &lt;config&gt;</td> <td>显示尚未生效的修改记录</td></tr> <tr><td>uci show -X &lt;config&gt;.&lt;section&gt;.&lt;option&gt;</td> <td>显示匿名节点</td></tr></tbody></table> <h4 id="写入类语法"><a href="#写入类语法" class="header-anchor">#</a> 写入类语法</h4> <table><thead><tr><th>命令</th> <th>说明</th></tr></thead> <tbody><tr><td>uci add &lt;config&gt; &lt;section-type&gt;</td> <td>增加一个匿名节点</td></tr> <tr><td>uci set &lt;config&gt;.&lt;section&gt; = &lt;section-type&gt;</td> <td>增加一个节点/修改节点类型</td></tr> <tr><td>uci set &lt;config&gt;.&lt;section&gt;.&lt;option&gt; = &lt;value&gt;</td> <td>增加一个选项值/修改一个选项值</td></tr> <tr><td>uci add_list &lt;config&gt;.&lt;section&gt;.&lt;option&gt; = &lt;value&gt;</td> <td>在列表中增加一个值</td></tr> <tr><td>uci delete &lt;config&gt;.&lt;section&gt;</td> <td>删除指定节点</td></tr> <tr><td>uci delete &lt;config&gt;.&lt;section&gt;.&lt;option&gt;</td> <td>删除指定选项</td></tr> <tr><td>uci delete &lt;config&gt;.&lt;section&gt;.&lt;list&gt;</td> <td>删除列表</td></tr> <tr><td>uci del_list &lt;config&gt;.&lt;section&gt;.&lt;option&gt; = &lt;string&gt;</td> <td>删除列表中的一个值</td></tr> <tr><td>uci commit &lt;config&gt;</td> <td>使修改生效</td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>UCI 读取总是先读取内存中的缓存，然后再读取文件中的。进行过增删改操作后要执行生效指令，否则所有的修改只留存在缓存中。</p></div> <h2 id="常用配置操作"><a href="#常用配置操作" class="header-anchor">#</a> 常用配置操作</h2> <h3 id="查看-system-配置"><a href="#查看-system-配置" class="header-anchor">#</a> 查看 system 配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># cat /etc/config/system</span>
config system
	option <span class="token function">hostname</span>	Widora
	option timezone	CST-8

config timeserver ntp
	list server	<span class="token number">0</span>.openwrt.pool.ntp.org
	list server	<span class="token number">1</span>.openwrt.pool.ntp.org
	list server	<span class="token number">2</span>.openwrt.pool.ntp.org
	list server	<span class="token number">3</span>.openwrt.pool.ntp.org
	option enabled <span class="token number">1</span>
	option enable_server <span class="token number">0</span>
root@Widora:/<span class="token comment"># uci show system</span>
system.@system<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>system
system.@system<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.hostname<span class="token operator">=</span><span class="token string">'Widora'</span>
system.@system<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.timezone<span class="token operator">=</span><span class="token string">'CST-8'</span>
system.ntp<span class="token operator">=</span>timeserver
system.ntp.server<span class="token operator">=</span><span class="token string">'0.openwrt.pool.ntp.org'</span> <span class="token string">'1.openwrt.pool.ntp.org'</span> <span class="token string">'2.openwrt.pool.ntp.org'</span> <span class="token string">'3.openwrt.pool.ntp.org'</span>
system.ntp.enabled<span class="token operator">=</span><span class="token string">'1'</span>
system.ntp.enable_server<span class="token operator">=</span><span class="token string">'0'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="查看网络配置"><a href="#查看网络配置" class="header-anchor">#</a> 查看网络配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># cat /etc/config/network</span>

config interface <span class="token string">'loopback'</span>
	option ifname <span class="token string">'lo'</span>
	option proto <span class="token string">'static'</span>
	option ipaddr <span class="token string">'127.0.0.1'</span>
	option netmask <span class="token string">'255.0.0.0'</span>

config globals <span class="token string">'globals'</span>
	option ula_prefix <span class="token string">'fdff:c5b2:821c::/48'</span>

config interface <span class="token string">'lan'</span>
	option force_link <span class="token string">'1'</span>
	option macaddr <span class="token string">'0c:ef:af:d2:a9:b9'</span>
	option <span class="token builtin class-name">type</span> <span class="token string">'bridge'</span>
	option proto <span class="token string">'static'</span>
	option ipaddr <span class="token string">'192.168.8.1'</span>
	option netmask <span class="token string">'255.255.255.0'</span>
	option ip6assign <span class="token string">'60'</span>
	option ifname <span class="token string">'eth0.1'</span>

config interface <span class="token string">'wan'</span>
	option force_link <span class="token string">'1'</span>
	option macaddr <span class="token string">'0c:ef:af:d2:a9:b8'</span>
	option proto <span class="token string">'dhcp'</span>
	option ifname <span class="token string">'eth0.2'</span>

config interface <span class="token string">'wan6'</span>
	option proto <span class="token string">'dhcpv6'</span>
	option ifname <span class="token string">'eth0.2'</span>

config switch
	option name <span class="token string">'switch0'</span>
	option reset <span class="token string">'1'</span>
	option enable_vlan <span class="token string">'1'</span>

config switch_vlan
	option device <span class="token string">'switch0'</span>
	option vlan <span class="token string">'1'</span>
	option ports <span class="token string">'1 2 3 4 6t'</span>

config switch_vlan
	option device <span class="token string">'switch0'</span>
	option vlan <span class="token string">'2'</span>
	option ports <span class="token string">'0 6t'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="重启网络使配置生效"><a href="#重启网络使配置生效" class="header-anchor">#</a> 重启网络使配置生效</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># /etc/init.d/network restart</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="开启-wi-fi"><a href="#开启-wi-fi" class="header-anchor">#</a> 开启 Wi-Fi</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>uci <span class="token builtin class-name">set</span> wireless.radio0.disabled<span class="token operator">=</span><span class="token number">0</span> <span class="token comment"># 使能 Wi-Fi</span>
uci commit wireless <span class="token comment"># 使配置生效</span>
wifi <span class="token comment"># 启动 Wi-Fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="查看当前网络"><a href="#查看当前网络" class="header-anchor">#</a> 查看当前网络</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># ifconfig</span>
br-lan    Link encap:Ethernet  HWaddr 0C:EF:AF:D2:A9:B9
          inet addr:192.168.8.1  Bcast:192.168.8.255  Mask:255.255.255.0
          inet6 addr: fe80::eef:afff:fed2:a9b9/64 Scope:Link
          inet6 addr: fdff:c5b2:821c::1/60 Scope:Global
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:574264 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1217669 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:48102567 <span class="token punctuation">(</span><span class="token number">45.8</span> MiB<span class="token punctuation">)</span>  TX bytes:1634912136 <span class="token punctuation">(</span><span class="token number">1.5</span> GiB<span class="token punctuation">)</span>

eth0      Link encap:Ethernet  HWaddr 0C:EF:AF:D2:A9:B8
          inet6 addr: fe80::eef:afff:fed2:a9b8/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1225320 errors:0 dropped:0 overruns:0 frame:0
          TX packets:579507 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1641989813 <span class="token punctuation">(</span><span class="token number">1.5</span> GiB<span class="token punctuation">)</span>  TX bytes:59132909 <span class="token punctuation">(</span><span class="token number">56.3</span> MiB<span class="token punctuation">)</span>
          Interrupt:5

eth0.1    Link encap:Ethernet  HWaddr 0C:EF:AF:D2:A9:B8
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1 errors:0 dropped:1 overruns:0 frame:0
          TX packets:3544 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:46 <span class="token punctuation">(</span><span class="token number">46.0</span> B<span class="token punctuation">)</span>  TX bytes:244206 <span class="token punctuation">(</span><span class="token number">238.4</span> KiB<span class="token punctuation">)</span>

eth0.2    Link encap:Ethernet  HWaddr 0C:EF:AF:D2:A9:B8
          inet addr:192.168.1.5  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::eef:afff:fed2:a9b8/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1176423 errors:0 dropped:10706 overruns:0 frame:0
          TX packets:575928 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1617670919 <span class="token punctuation">(</span><span class="token number">1.5</span> GiB<span class="token punctuation">)</span>  TX bytes:56565373 <span class="token punctuation">(</span><span class="token number">53.9</span> MiB<span class="token punctuation">)</span>

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:294 errors:0 dropped:0 overruns:0 frame:0
          TX packets:294 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:41961 <span class="token punctuation">(</span><span class="token number">40.9</span> KiB<span class="token punctuation">)</span>  TX bytes:41961 <span class="token punctuation">(</span><span class="token number">40.9</span> KiB<span class="token punctuation">)</span>

ra0       Link encap:Ethernet  HWaddr 0C:EF:AF:D2:A9:B8
          inet6 addr: fe80::eef:afff:fed2:a9b8/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:641847 errors:830 dropped:0 overruns:0 frame:0
          TX packets:1228723 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:70965355 <span class="token punctuation">(</span><span class="token number">67.6</span> MiB<span class="token punctuation">)</span>  TX bytes:1630822247 <span class="token punctuation">(</span><span class="token number">1.5</span> GiB<span class="token punctuation">)</span>
          Interrupt:6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><table><thead><tr><th>网络设备名</th> <th>说明</th></tr></thead> <tbody><tr><td>br-lan</td> <td>虚拟设备，LAN 口桥接设备，包含通过 LAN 口和 WAN 口连入系统的设备统一桥接</td></tr> <tr><td>eth0</td> <td>真实设备，CPU 内部到交换机芯片之间只有一个接口</td></tr> <tr><td>eth0.1</td> <td>虚拟设备，由 VLAN 划分的有线的 LAN 口，VLAN 编号为 1</td></tr> <tr><td>eth0.2</td> <td>虚拟设备，由 VLAN 划分的有线的 LAN 口，VLAN编号为 2</td></tr> <tr><td>lo</td> <td>虚拟设备，回环设备</td></tr> <tr><td>ra0</td> <td>真实设备，启动 Wi-Fi 后将会产生此无线设备</td></tr> <tr><td>pppoe-wan</td> <td>虚拟设备，是 PPPoE 拨号上网成功后产生的</td></tr></tbody></table> <h3 id="查看-br-lan-桥状态"><a href="#查看-br-lan-桥状态" class="header-anchor">#</a> 查看 br-lan 桥状态</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># brctl show</span>
bridge name	bridge <span class="token function">id</span>			STP enabled	interfaces
br-lan		7fff.0cefafd2a9b9	no			eth0.1
											ra0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="查看内核日志"><a href="#查看内核日志" class="header-anchor">#</a> 查看内核日志</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># logread</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="查看当前-vlan-划分"><a href="#查看当前-vlan-划分" class="header-anchor">#</a> 查看当前 VLAN 划分</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># swconfig dev switch0 show</span>
Global attributes:
	enable_vlan: <span class="token number">1</span>
	alternate_vlan_disable: <span class="token number">0</span>
	bc_storm_protect: <span class="token number">0</span>
	led_frequency: <span class="token number">0</span>
Port <span class="token number">0</span>:
	disable: <span class="token number">0</span>
	doubletag: <span class="token number">0</span>
	untag: <span class="token number">1</span>
	led: <span class="token number">5</span>
	lan: <span class="token number">1</span>
	recv_bad: <span class="token number">0</span>
	recv_good: <span class="token number">2205</span>
	tr_bad: <span class="token number">0</span>
	tr_good: <span class="token number">52155</span>
	pvid: <span class="token number">2</span>
	link: port:0 link:up speed:100baseT full-duplex
Port <span class="token number">1</span>:
	disable: <span class="token number">0</span>
	doubletag: <span class="token number">0</span>
	untag: <span class="token number">1</span>
	led: <span class="token number">5</span>
	lan: <span class="token number">1</span>
	recv_bad: <span class="token number">0</span>
	recv_good: <span class="token number">0</span>
	tr_bad: <span class="token number">0</span>
	tr_good: <span class="token number">0</span>
	pvid: <span class="token number">1</span>
	link: port:1 link:down
Port <span class="token number">2</span>:
	disable: <span class="token number">0</span>
	doubletag: <span class="token number">0</span>
	untag: <span class="token number">1</span>
	led: <span class="token number">5</span>
	lan: <span class="token number">1</span>
	recv_bad: <span class="token number">0</span>
	recv_good: <span class="token number">0</span>
	tr_bad: <span class="token number">0</span>
	tr_good: <span class="token number">0</span>
	pvid: <span class="token number">1</span>
	link: port:2 link:down
Port <span class="token number">3</span>:
	disable: <span class="token number">0</span>
	doubletag: <span class="token number">0</span>
	untag: <span class="token number">1</span>
	led: <span class="token number">5</span>
	lan: <span class="token number">1</span>
	recv_bad: <span class="token number">0</span>
	recv_good: <span class="token number">0</span>
	tr_bad: <span class="token number">0</span>
	tr_good: <span class="token number">0</span>
	pvid: <span class="token number">1</span>
	link: port:3 link:down
Port <span class="token number">4</span>:
	disable: <span class="token number">0</span>
	doubletag: <span class="token number">0</span>
	untag: <span class="token number">1</span>
	led: <span class="token number">5</span>
	lan: <span class="token number">1</span>
	recv_bad: <span class="token number">0</span>
	recv_good: <span class="token number">0</span>
	tr_bad: <span class="token number">0</span>
	tr_good: <span class="token number">0</span>
	pvid: <span class="token number">1</span>
	link: port:4 link:down
Port <span class="token number">5</span>:
	disable: <span class="token number">1</span>
	doubletag: <span class="token number">0</span>
	untag: <span class="token number">0</span>
	led: ???
	lan: <span class="token number">1</span>
	recv_bad: <span class="token number">0</span>
	recv_good: <span class="token number">0</span>
	tr_bad: <span class="token number">0</span>
	tr_good: <span class="token number">0</span>
	pvid: <span class="token number">0</span>
	link: port:5 link:down
Port <span class="token number">6</span>:
	disable: <span class="token number">0</span>
	doubletag: <span class="token number">0</span>
	untag: <span class="token number">0</span>
	led: ???
	lan: ???
	recv_bad: ???
	recv_good: ???
	tr_bad: ???
	tr_good: ???
	pvid: <span class="token number">0</span>
	link: port:6 link:up speed:1000baseT full-duplex
VLAN <span class="token number">1</span>:
	ports: <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> 6t
VLAN <span class="token number">2</span>:
	ports: <span class="token number">0</span> 6t
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>哪个网口是 LAN， 哪个是 WAN， 是由 VLAN 划分的。VLAN1 为 LAN 口，包含 1、2、3、4 接口；VLAN2 为 WAN 口，包含了 0 接口。</p></div> <h3 id="配置-wan-口外网"><a href="#配置-wan-口外网" class="header-anchor">#</a> 配置 WAN 口外网</h3> <h4 id="查看-wan-口配置"><a href="#查看-wan-口配置" class="header-anchor">#</a> 查看 WAN 口配置</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:/<span class="token comment"># uci show network.wan</span>
network.wan<span class="token operator">=</span>interface
network.wan.force_link<span class="token operator">=</span><span class="token string">'1'</span>
network.wan.macaddr<span class="token operator">=</span><span class="token string">'0c:ef:af:d2:a9:b8'</span>
network.wan.proto<span class="token operator">=</span><span class="token string">'dhcp'</span>
network.wan.ifname<span class="token operator">=</span><span class="token string">'eth0.2'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><table><thead><tr><th>选项</th> <th>说明</th> <th>可选值</th></tr></thead> <tbody><tr><td>ifname</td> <td>设备接口名</td> <td>eth0.2</td></tr> <tr><td>proto</td> <td>协议类型</td> <td>static：静态 IP 地址<br>dhcp：动态获取 IP 地址<br>pppoe：拨号上网<br>pptp：远程 VPN 服务器<br>3g：连接 3G/4G 无线电话网络</td></tr> <tr><td>macaddr</td> <td>WAN 口 MAC 地址，修改该地址即可实现 MAC 地址克隆</td> <td>首次数据根据 factory 分区内参数自动生成</td></tr></tbody></table> <h4 id="动态获取-ip-选项"><a href="#动态获取-ip-选项" class="header-anchor">#</a> 动态获取 IP 选项</h4> <table><thead><tr><th>选项</th> <th>说明</th> <th>可选值及说明</th></tr></thead> <tbody><tr><td>proto</td> <td>协议类型</td> <td>dhcp</td></tr> <tr><td>ifname</td> <td>设备名称</td> <td>eth0.2</td></tr> <tr><td>macaddr</td> <td>MAC 地址</td> <td>根据 factory 分区自动生成的值</td></tr> <tr><td>mtu</td> <td>最大数据包大小，默认不用设置</td> <td>数值</td></tr> <tr><td>reqopts</td> <td>在向 DHCP 服务器发出请求时增加附加的 DHCP 信息</td> <td>字符串</td></tr> <tr><td>dns</td> <td>使用指定的 DNS 服务器地址替代获得的 DNS</td> <td>字符串</td></tr></tbody></table> <h4 id="指定静态-ip-选项"><a href="#指定静态-ip-选项" class="header-anchor">#</a> 指定静态 IP 选项</h4> <table><thead><tr><th>选项</th> <th>说明</th> <th>可选值及说明</th></tr></thead> <tbody><tr><td>proto</td> <td>协议类型</td> <td>static</td></tr> <tr><td>ifname</td> <td>设备名称</td> <td>eth0.2</td></tr> <tr><td>macaddr</td> <td>MAC 地址</td> <td>根据 factory 分区自动生成的值</td></tr> <tr><td>mtu</td> <td>最大数据包大小，默认不用设置</td> <td>数值</td></tr> <tr><td>ipaddr</td> <td>WAN 口的 IP 地址</td> <td>字符串</td></tr> <tr><td>netmask</td> <td>WAN 口的子网掩码</td> <td>字符串</td></tr> <tr><td>gateway</td> <td>默认网关</td> <td>字符串</td></tr> <tr><td>broadcast</td> <td>广播地址</td> <td>字符串</td></tr> <tr><td>dns</td> <td>使用指定的 DNS 服务器地址替代获得的 DNS</td> <td>字符串</td></tr></tbody></table> <h4 id="pppoe-拨号上网选项"><a href="#pppoe-拨号上网选项" class="header-anchor">#</a> PPPOE 拨号上网选项</h4> <table><thead><tr><th>选项</th> <th>说明</th> <th>可选值及说明</th></tr></thead> <tbody><tr><td>proto</td> <td>协议类型</td> <td>pppoe</td></tr> <tr><td>ifname</td> <td>设备名称</td> <td>eth0.2</td></tr> <tr><td>macaddr</td> <td>MAC 地址</td> <td>根据 factory 分区自动生成的值</td></tr> <tr><td>mtu</td> <td>最大数据包大小，默认不用设置</td> <td>数值</td></tr> <tr><td>username</td> <td>拨号使用的帐号</td> <td>字符串</td></tr> <tr><td>password</td> <td>拨号使用的密码</td> <td>字符串</td></tr> <tr><td>ac</td> <td>使用指定的访问集中器进行连接</td> <td>字符串</td></tr> <tr><td>service</td> <td>连接的服务名称</td> <td>字符串</td></tr> <tr><td>connect</td> <td>连接时候执行的外部脚本</td> <td>字符串</td></tr> <tr><td>disconnect</td> <td>断开连接时执行的外部脚本</td> <td>字符串</td></tr> <tr><td>demand</td> <td>等待多久没有活动就断开 PPPOE 连接</td> <td>数字，单位秒</td></tr> <tr><td>dns</td> <td>DNS 服务器地址</td> <td>字符串</td></tr> <tr><td>pppd_options</td> <td>用于 pppd 进程执行时候的附加参数</td> <td>字符串</td></tr></tbody></table> <h3 id="配置-lan-口服务"><a href="#配置-lan-口服务" class="header-anchor">#</a> 配置 LAN 口服务</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>LAN 口下的设备可以通过 WAN 口接入网络，也可以直接访问设备上的各项功能（系统防火墙对 LAN 口默认不做任何拦截）。</p></div> <h4 id="查看-lan-口配置"><a href="#查看-lan-口配置" class="header-anchor">#</a> 查看 LAN 口配置</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># uci show network.lan</span>
network.lan<span class="token operator">=</span>interface
network.lan.force_link<span class="token operator">=</span><span class="token string">'1'</span>
network.lan.macaddr<span class="token operator">=</span><span class="token string">'0c:ef:af:d2:a9:b9'</span>
network.lan.type<span class="token operator">=</span><span class="token string">'bridge'</span>
network.lan.proto<span class="token operator">=</span><span class="token string">'static'</span>
network.lan.ipaddr<span class="token operator">=</span><span class="token string">'192.168.8.1'</span>
network.lan.netmask<span class="token operator">=</span><span class="token string">'255.255.255.0'</span>
network.lan.ip6assign<span class="token operator">=</span><span class="token string">'60'</span>
network.lan.ifname<span class="token operator">=</span><span class="token string">'eth0.1'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><table><thead><tr><th>选项</th> <th>说明</th> <th>可选值及说明</th></tr></thead> <tbody><tr><td>ifname</td> <td>设备名称</td> <td>eth0.1</td></tr> <tr><td>proto</td> <td>协议类型</td> <td>static</td></tr> <tr><td>macaddr</td> <td>MAC 地址</td> <td>根据 factory 分区自动生成的值</td></tr> <tr><td>type</td> <td>网络类型</td> <td>bridge，桥模式（这样才有交换机功能）</td></tr> <tr><td>ipaddr</td> <td>LAN 口的 IP 地址，用于局域网内其它设备访问路由器</td> <td>字符串</td></tr> <tr><td>netmask</td> <td>LAN 口的子网掩码</td> <td>字符串</td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>修改过 LAN 口的配置后要重启网络以及 DHCP 服务。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># /etc/init.d/network restart</span>
root@Widora:~<span class="token comment"># /etc/odhcpd restart</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <h3 id="配置无线网络"><a href="#配置无线网络" class="header-anchor">#</a> 配置无线网络</h3> <h4 id="查看无线网络配置"><a href="#查看无线网络配置" class="header-anchor">#</a> 查看无线网络配置</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># cat /etc/config/wireless</span>

config wifi-device <span class="token string">'radio0'</span>
	option <span class="token builtin class-name">type</span> <span class="token string">'ralink'</span>
	option variant <span class="token string">'mt7628'</span>
	option country <span class="token string">'CN'</span>
	option hwmode <span class="token string">'11bgn'</span>
	option htmode <span class="token string">'HT40'</span>
	option channel <span class="token string">'auto'</span>
	option disabled <span class="token string">'0'</span>

config wifi-iface <span class="token string">'ap'</span>
	option device <span class="token string">'radio0'</span>
	option mode <span class="token string">'ap'</span>
	option network <span class="token string">'lan'</span>
	option ifname <span class="token string">'ra0'</span>
	option ssid <span class="token string">'Widora-A9B8'</span>
	option hidden <span class="token string">'0'</span>
	option encryption <span class="token string">'psk2'</span>
	option key <span class="token string">'passworkd'</span>

config wifi-iface <span class="token string">'sta'</span>
	option device <span class="token string">'radio0'</span>
	option disabled <span class="token string">'1'</span>
	option mode <span class="token string">'sta'</span>
	option network <span class="token string">'wwan'</span>
	option ifname <span class="token string">'apcli0'</span>
	option ssid <span class="token string">'UplinkAp'</span>
	option key <span class="token string">'SecretKey'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="wifi-device-选项参数"><a href="#wifi-device-选项参数" class="header-anchor">#</a> wifi-device 选项参数</h4> <table><thead><tr><th>选项</th> <th>说明</th> <th>可选值及说明</th></tr></thead> <tbody><tr><td>type</td> <td>设备类型</td> <td>ralink</td></tr> <tr><td>channel</td> <td>无线信道，不同的国家支持的信道不同</td> <td>auto 或 1～13</td></tr> <tr><td>hwmode</td> <td>无线协议类型</td> <td>11bgn: IEEE802.11b + IEEE802.11g + IEEE802.11n</td></tr> <tr><td>htmode</td> <td>无线频宽</td> <td>HT20、HT40</td></tr> <tr><td>disable</td> <td>关闭无线设备</td> <td>0：启用；1：禁用</td></tr> <tr><td>country</td> <td>国家类型，跟支持的频道有关，中国为 CN，支持 1～13</td> <td>CN：中国</td></tr></tbody></table> <h4 id="wifi-iface-选项参数"><a href="#wifi-iface-选项参数" class="header-anchor">#</a> wifi-iface 选项参数</h4> <table><thead><tr><th>选项</th> <th>说明</th> <th>可选值及说明</th></tr></thead> <tbody><tr><td>device</td> <td>关联的无线设备</td> <td>radio0</td></tr> <tr><td>network</td> <td>关联网络设备类型</td> <td>lan：表示桥接到 LAN 网上<br>wwan：表示启用无线中继</td></tr> <tr><td>mode</td> <td>无线工作模式</td> <td>ap：热点模式<br>sta：客户端模式</td></tr> <tr><td>ssid</td> <td>无线的名称</td> <td>字符串</td></tr> <tr><td>hidden</td> <td>隐藏无线名称</td> <td>0：显示名称<br>1：隐藏名称</td></tr> <tr><td>encryption</td> <td>无线加密方式</td> <td>none：不加密<br>psk：WPA-PSK 模式<br>psk2：WPA-PSK2 模式<br>psk-mixed：WPA-PSK / WPA-PSK2 混合模式</td></tr> <tr><td>key</td> <td>无线密钥</td> <td>字符串，长度为 8～64 个 ASCII 字符</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>修改过无线配置后需要使用命令 <code>wifi</code> 使之生效</p></div> <h4 id="查看无线网络状态"><a href="#查看无线网络状态" class="header-anchor">#</a> 查看无线网络状态</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># iwinfo</span>
ra0       ESSID: <span class="token string">&quot;Widora-A9B8&quot;</span>
          Access Point: 0C:EF:AF:D2:A9:B8
          Mode: Client  Channel: <span class="token number">7</span> <span class="token punctuation">(</span><span class="token number">2.442</span> GHz<span class="token punctuation">)</span>
          Tx-Power: <span class="token number">18</span> dBm  Link Quality: <span class="token number">10</span>/100
          Signal: -256 dBm  Noise: -82 dBm
          Bit Rate: <span class="token number">150.0</span> MBit/s
          Encryption: unknown
          Type: wext  HW Mode<span class="token punctuation">(</span>s<span class="token punctuation">)</span>: <span class="token number">802</span>.11bg
          Hardware: unknown <span class="token punctuation">[</span>Generic WEXT<span class="token punctuation">]</span>
          TX power offset: unknown
          Frequency offset: unknown
          Supports VAPs: no  PHY name: ra0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="搜索范围内的其它无线设备"><a href="#搜索范围内的其它无线设备" class="header-anchor">#</a> 搜索范围内的其它无线设备</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># iwinfo ra0 scan</span>
Cell 01 - Address: <span class="token number">50</span>:64:2B:4B:02:4E
          ESSID: <span class="token string">&quot;Xiaomi_024D&quot;</span>
          Mode: Master  Channel: <span class="token number">11</span>
          Signal: -256 dBm  Quality: <span class="token number">55</span>/100
          Encryption: WPA2 PSK <span class="token punctuation">(</span>TKIP, AES-OCB<span class="token punctuation">)</span>

Cell 02 - Address: <span class="token number">44</span>:97:5A:EC:C5:14
          ESSID: <span class="token string">&quot;FAST_C514&quot;</span>
          Mode: Master  Channel: <span class="token number">1</span>
          Signal: -256 dBm  Quality: <span class="token number">47</span>/100
          Encryption: WPA2 PSK <span class="token punctuation">(</span>AES-OCB<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="防火墙"><a href="#防火墙" class="header-anchor">#</a> 防火墙</h2> <p>防火墙、DMZ（独立隔离区）、NAT 转发在 OpenWrt 系统中都是由 /etc/config/firewall 配置文件管理的。</p> <h3 id="防火墙命令"><a href="#防火墙命令" class="header-anchor">#</a> 防火墙命令</h3> <h4 id="重置防火墙"><a href="#重置防火墙" class="header-anchor">#</a> 重置防火墙</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># /etc/init.d/firewall reload</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="重启防火墙"><a href="#重启防火墙" class="header-anchor">#</a> 重启防火墙</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># /etc/init.d/firewall restart</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查看防火墙完整策略"><a href="#查看防火墙完整策略" class="header-anchor">#</a> 查看防火墙完整策略</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># iptables -L</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="防火墙-defaults-配置"><a href="#防火墙-defaults-配置" class="header-anchor">#</a> 防火墙 defaults 配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>config defaults
	option syn_flood	<span class="token number">1</span>			<span class="token comment"># 启用防洪水攻击</span>
	option input		ACCEPT		<span class="token comment"># INPUT 链过滤策略</span>
	option output		ACCEPT		<span class="token comment"># OUTPUT 链过滤策略</span>
	option forward		REJECT		<span class="token comment"># FORWARD 链过滤策略</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="防火墙-zone-域配置"><a href="#防火墙-zone-域配置" class="header-anchor">#</a> 防火墙 zone 域配置</h3> <p>系统将 LAN 和 WAN 分为两个不同的 zone，它们之间是隔离的。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>config zone
	option name			lan			<span class="token comment"># zone 节点名</span>
	list   network		<span class="token string">'lan'</span>		<span class="token comment"># 指定绑定到该 zone 上的设备</span>
	option input		ACCEPT
	option output		ACCEPT
	option forward		ACCEPT

config zone
	option name			wan
	list   network		<span class="token string">'wan'</span>
	list   network		<span class="token string">'wan6'</span>
	list   network		<span class="token string">'wwan'</span>
	option input		ACCEPT
	option output		ACCEPT
	option forward		REJECT
	option masq			<span class="token number">1</span>			<span class="token comment"># 传输伪装开关，WAN 必须设为 1</span>
	option mtu_fix		<span class="token number">1</span>			<span class="token comment"># 数据输出时开启 MSS 钳制，WAN 必须设为 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="防火墙-forwarding-转发配置"><a href="#防火墙-forwarding-转发配置" class="header-anchor">#</a> 防火墙 forwarding 转发配置</h3> <p>forwarding 配置可以实现两个不同 zone 域之间的数据发送</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>config forwarding
	option src		lan			<span class="token comment"># 来源 zone</span>
	option dest		wan			<span class="token comment"># 目标 zone</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="防火墙-rule-规则"><a href="#防火墙-rule-规则" class="header-anchor">#</a> 防火墙 rule 规则</h3> <p>默认情况下，所有进入 WAN 口的请求都会被拒绝，如果希望有例外，那么要通过 rule 来实现许可。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Allow IPv4 ping</span>
config rule
	option name			Allow-Ping
	option src			wan					<span class="token comment"># 数据源的 zone 域</span>
	option proto		icmp				<span class="token comment"># 数据源的协议类型</span>
	option icmp_type	echo-request
	option family		ipv4				<span class="token comment"># IP 协议类型</span>
	option target		ACCEPT				<span class="token comment"># 规则动作</span>

<span class="token comment"># 禁止 LAN 口的某个 IP 访问 WAN 口</span>
config rule
	option src		lan						<span class="token comment"># 数据源的 zone 域</span>
	option src_ip	<span class="token number">192.168</span>.45.2			<span class="token comment"># 数据源的 IP 地址</span>
	option dest		wan						<span class="token comment"># 目的地的 zone 域</span>
	option proto	tcp
	option target	REJECT

<span class="token comment"># 禁止某个 MAC 地址访问 WAN</span>
config rule
	option dest		wan
	option src_mac	00:11:22:33:44:66		<span class="token comment"># 数据源的 MAC 地址</span>
	option target	REJECT

<span class="token comment"># 阻塞某个 zone 上的 ICMP 流量</span>
config rule
	option src		lan
	option proto	ICMP
	option target	DROP
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="防火墙-redirect-端口转发"><a href="#防火墙-redirect-端口转发" class="header-anchor">#</a> 防火墙 redirect 端口转发</h3> <p>端口转发允许访问者通过 WAN 口访问 LAN 口中的一个特定端口，并将结果转发回给访问者。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 将 LAN 口的 80 端口开放到 WAN 口上</span>
config redirect
	option src			wan				<span class="token comment"># 被转发来源 zone 域</span>
	option src_dport	<span class="token number">80</span>				<span class="token comment"># 被转发的端口</span>
	option dest			lan				<span class="token comment"># 转发到哪个 zone 域</span>
	option dest_ip		<span class="token number">192.168</span>.16.235 	<span class="token comment"># 转发到哪个 IP 地址</span>
	option dest_port	<span class="token number">80</span>				<span class="token comment"># 转发到哪个端口</span>
	option proto		tcp				<span class="token comment"># 协议类型</span>

<span class="token comment"># 将所有来自 WAN 口的 TCP 协议访问 22001 的请求都转发给 LAN 中的一台 80 端口的计算机</span>
config redirect
	option src			wan
	option src_dport	<span class="token number">22001</span>
	option dest			lan
	option dest_port	<span class="token number">22</span>
	option proto		tcp

<span class="token comment"># 将 IP 地址 192.168.1.2 设置到 DMZ 隔离区</span>
config redirect
	option src			wan
	option proto		all
	option dest_ip		<span class="token number">192.168</span>.1.2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="ntp"><a href="#ntp" class="header-anchor">#</a> NTP</h2> <p>NTP 用来使网络中的各个计算机时间同步的一种协议，它的用途是把系统的时钟同步到 UTC 时区，其精度在局域网内可达到 0.1ms，在互联网上绝大多数情况其精度可以达到1～50ms。</p> <p>配置内容如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># cat /etc/config/system</span>
config system
	option <span class="token function">hostname</span>	Widora				<span class="token comment"># 主机名</span>
	option timezone	CST-8				<span class="token comment"># 时区</span>

config timeserver ntp
	list server	<span class="token number">0</span>.openwrt.pool.ntp.org	<span class="token comment"># NTP 服务器地址</span>
	list server	<span class="token number">1</span>.openwrt.pool.ntp.org
	list server	<span class="token number">2</span>.openwrt.pool.ntp.org
	list server	<span class="token number">3</span>.openwrt.pool.ntp.org
	option enabled <span class="token number">1</span>					<span class="token comment"># 开启 NTP 功能</span>
	option enable_server <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>阿里云提供了 NTP 服务功能：</p> <p>ntp1.aliyun.com</p> <p>ntp2.aliyun.com</p> <p>ntp3.aliyun.com</p></div> <h2 id="服务管理"><a href="#服务管理" class="header-anchor">#</a> 服务管理</h2> <h3 id="查看系统服务命令"><a href="#查看系统服务命令" class="header-anchor">#</a> 查看系统服务命令</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Widora:~<span class="token comment"># ls /etc/init.d/</span>
avahi-daemon   dbus           dropbear       led            mountd         rpcd           sysctl         system         <span class="token function">umount</span>
boot           dnsmasq        firewall       log            network        setnetmode     sysfixtime     telnet
<span class="token function">cron</span>           <span class="token keyword">done</span>           fstab          mjpg-streamer  odhcpd         shairport      sysntpd        uhttpd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="服务命令的语法格式"><a href="#服务命令的语法格式" class="header-anchor">#</a> 服务命令的语法格式</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>服务的语法格式：/etc/init.d/服务名称 [命令]
可用命令：
		start	临时开启这个服务
		stop	临时关闭这个服务
		restart 重启当前已开启的服务，如果没有开启就开启它
		reload 	重新读取该服务的配置信息（如果服务支持的话）
		enable	设置该服务随系统一同启动
		disable	禁止该服务随系统一同启动
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/suda-morris/blog/edit/master/docs/ee/openwrt.md" target="_blank" rel="noopener noreferrer">编辑此页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/7/13 15:19:54</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/ee/motor_control.html" class="prev">
        电机基础
      </a></span> <span class="next"><a href="/blog/ee/usb.html">
        𝑼𝑺𝑩 基础
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.f7371fc1.js" defer></script><script src="/blog/assets/js/4.86db7451.js" defer></script><script src="/blog/assets/js/40.7af103e2.js" defer></script><script src="/blog/assets/js/13.4f481eb8.js" defer></script>
  </body>
</html>
